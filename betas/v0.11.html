<meta charset="utf8" />
<html>
<script src='https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.6.2/sql-wasm.js'></script>
<script>
  config = {
    locateFile: (filename, prefix) => {
      return 'https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.6.2/sql-wasm.wasm';
    }
  }
  
  var SQL;
  var db;
  async function start() {
    SQL = await initSqlJs(config)
    console.debug("Initialized SQL Module!")
  }
  start();
  
</script>

</html> 

<html>
  
  <div id="memTracker">
  
  <head>
    <meta name="viewport" content="width=320, initial-scale=1">
    <meta charset="utf-8">
    <script src="https://rxcodes.github.io/hyperPad-Project-Modder/JSZip.js"></script>
    <script src="https://rxcodes.github.io/hyperPad-Project-Modder/LZString.js"></script>
    
    <style>
      body, html {
        min-width: 100%;
        min-height: 100%;
        margin: 0;
        padding: 0;
        font-family: Helvetica 14px;
        background-color: #393939;
        overflow: hidden;
      }
      
      input[type="file"] {
        display: none;
      }
      
      .input-field {
        height: 30px;
        font-size: 20px;
        background-color: #252525;
        color: white;
        width: 95%;
        margin-left: 2.5%;
        margin-right: 2.5%;
        border-radius: 5px;
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
      }
      
       .alert {
        position: absolute;
        top: 0px;
        padding: 14px;
        background-color: #e63c3c; /* Red */
        color: white;
        font-weight: medium;
        margin-bottom: 15px;
        width: calc(100% - 44px);
        margin: 8px;
        box-shadow: 0px 5px rgba(0,0,0,.25);
        display: none;
      }

      /* The close button */
      .closebtn {
        margin-left: 15px;
        color: white;
        font-weight: bold;
        float: right;
        font-size: 22px;
        line-height: 20px;
        cursor: pointer;
        transition: 0.3s;
      }

      /* When moving the mouse over the close button */
      .closebtn:hover {
        color: black;
      }
      
      select {
        height: 30px;
        font-size: 20px;
        border-width: 0px;
        background-color: #252525;
        color: white;
        width: 95%;
        margin-left: 2.5%;
        margin-right: 2.5%;
        border-radius: 5px;
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
      }
      
      .button {
        background-color: #00bb78;
        border-radius: 5px;
        display: block;
        position: relative;
        text-decoration: none;
        color:white;
        font-family: 'Helvetica';
        text-align: center;
        font-size: 20px;
        font-weight: bold;
        padding: 5px;
        margin: auto;
        bottom: -8px;
        height: 25px; 
        text-decoration: none;
        width: 10%;
        min-width: 125px;
        overflow: hidden;
      }
      
      .container {
  display: block;
  position: relative;
  padding-left: 35px;
  margin-bottom: 12px;
  cursor: pointer;
  font-size: 22px;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

/* Hide the browser's default checkbox */
.container input {
  position: absolute;
  opacity: 0;
  cursor: pointer;
  height: 0;
  width: 0;
}

/* Create a custom checkbox */
.checkmark {
  position: absolute;
  top: 0;
  left: 0;
  height: 25px;
  width: 25px;
  background-color: #808080;
  border-radius: 5px;
}

/* On mouse-over, add a grey background color */
.container:hover input ~ .checkmark {
  background-color: #ffffff;
}

/* When the checkbox is checked, add a blue background */
.container input:checked ~ .checkmark {
  background-color: #00bb78;
}

/* Create the checkmark/indicator (hidden when not checked) */
.checkmark:after {
  content: "";
  position: absolute;
  display: none;
}

/* Show the checkmark when checked */
.container input:checked ~ .checkmark:after {
  display: block;
}

/* Style the checkmark/indicator */
.container .checkmark:after {
  left: 9px;
  top: 5px;
  width: 5px;
  height: 10px;
  border: solid white;
  border-width: 0 3px 3px 0;
  -webkit-transform: rotate(45deg);
  -ms-transform: rotate(45deg);
  transform: rotate(45deg);
}

      
      .lds-ring {
          margin: auto;
          position: block;
          width: 80px;
          height: 80px;
        }
        .lds-ring div {
          box-sizing: border-box;
          display: block;
          position: absolute;
          width: 60px;
          height: 60px;
          margin: 8px;
          border: 7px solid #00BB78;
          border-radius: 50%;
          animation: lds-ring 1.2s cubic-bezier(0.5, 0, 0.5, 1) infinite;
          border-color: #00BB78 transparent transparent transparent;
        }
        .lds-ring div:nth-child(1) {
          animation-delay: -0.45s;
        }
        .lds-ring div:nth-child(2) {
          animation-delay: -0.3s;
        }
        .lds-ring div:nth-child(3) {
          animation-delay: -0.15s;
        }
        @keyframes lds-ring {
          0% {
            transform: rotate(0deg);
          }
          100% {
            transform: rotate(360deg);
          }
        }
      
        .lds-ring2 {
          margin: auto;
          position: block;
          width: 80px;
          height: 80px;
        }
        .lds-ring2 div {
          box-sizing: border-box;
          display: block;
          position: absolute;
          width: 60px;
          height: 60px;
          margin: 8px;
          border: 7px solid #2896ff;
          border-radius: 50%;
          animation: lds-ring2 1.2s cubic-bezier(0.5, 0, 0.5, 1) infinite;
          border-color: #2896ff transparent transparent transparent;
        }
        .lds-ring2 div:nth-child(1) {
          animation-delay: -0.45s;
        }
        .lds-ring2 div:nth-child(2) {
          animation-delay: -0.3s;
        }
        .lds-ring2 div:nth-child(3) {
          animation-delay: -0.15s;
        }
        @keyframes lds-ring2 {
          0% {
            transform: rotate(0deg);
          }
          100% {
            transform: rotate(360deg);
          }
        }
      
      canvas {
        display: none;
        height: 100%;
        margin: auto;
        background-color: transparent;
      }
      
      #more {display: none;}
      
      .more {display: none;}
      
      #importMenu {
        background-color: #5a5a5a;
        padding: 15px; 
        padding-top: 10px;
        width: 320px;
        height: 60px;
        border-radius: 10px;
        margin: auto;
        margin-top: calc(50vh - 155px);
      }
      
      @keyframes planeAnim {
        0% {bottom: -10px}
        100% {bottom: -25px}
      }
      
      #plane {
        display: none;
        animation-name: planeAnim;
        animation-iteration-count: infinite;
        animation-duration: 0.85s;
        animation-direction: alternate;
        animation-timing-function: ease-in-out;
      }
      
      #changelog {
        background-color: #5a5a5a;
        padding: 15px;
        padding-top: 5px; 
        width: 320px;
        height: 200px;
        border-radius: 10px;
        margin: auto;
        margin-top: 10px;
      }
      
      #projectData {
        display: none;
        background-color: #5a5a5a;
        padding: 15px; 
        width: 450px;
        height: 400px;
        border-radius: 10px;
        margin: auto;
        margin-top: calc(50vh - 200px);
      }
      
      #downloadMenu {
        background-color: #5a5a5a;
        padding: 15px; 
        width: 300px;
        height: 100px;
        border-radius: 10px;
        margin: auto;
        margin-top: calc(50vh - 60px);
        display: none;
      }
      
      #errorMenu {
        background-color: #5a5a5a;
        padding: 15px; 
        width: 300px;
        height: 120px;
        border-radius: 10px;
        margin: auto;
        margin-top: calc(50vh - 60px);
        display: none;
      }
      
      #projectViewer {
        background-color: #5a5a5a;
        padding: 15px; 
        width: 300px;
        height: 405;
        border-radius: 10px;
        margin: auto;
        margin-top: calc(50vh - 200px);
        display: none;
      }
      
      #behaviorOption {
        background-color: #5a5a5a;
        padding: 15px; 
        width: 300px;
        height: 330px;
        border-radius: 10px;
        margin: auto;
        margin-top: calc(50vh - 150px);
        display: none;
      }
      
       #sceneSelector {
        background-color: #5a5a5a;
        padding: 15px; 
        width: 300px;
        height: 330px;
        border-radius: 10px;
        margin: auto;
        margin-top: calc(50vh - 150px);
        display: none;
      }
      
      #sceneEditor {
        background-color: #5a5a5a;
        padding: 15px; 
        width: 300px;
        height: 330px;
        border-radius: 10px;
        margin: auto;
        margin-top: calc(50vh - 150px);
        display: none;
      }
      
      #downgradeBehaviors {
        background-color: #5a5a5a;
        padding: 15px; 
        width: 300px;
        height: 330px;
        border-radius: 10px;
        margin: auto;
        margin-top: calc(50vh - 150px);
        display: none;
      }
      
      
      #deleteGlobalBehaviors {
        background-color: #5a5a5a;
        padding: 15px; 
        width: 300px;
        height: 230px;
        border-radius: 10px;
        margin: auto;
        margin-top: calc(50vh - 150px);
        display: none;
      }
      
      #objectSelector {
        background-color: #5a5a5a;
        padding: 15px; 
        width: 350px;
        height: 370px;
        border-radius: 10px;
        margin: auto;
        margin-top: calc(50vh - 200px);
        display: none;
      }
      
      
      #hideBehaviors {
        background-color: #5a5a5a;
        padding: 15px; 
        width: 350px;
        height: 250px;
        border-radius: 10px;
        margin: auto;
        margin-top: calc(50vh - 150px);
        display: none;
      }
      
        
      #lockProject {
        background-color: #5a5a5a;
        padding: 15px; 
        width: 350px;
        height: 250px;
        border-radius: 10px;
        margin: auto;
        margin-top: calc(50vh - 150px);
        display: none;
      }
            
      #transferBehaviors {
        background-color: #5a5a5a;
        padding: 15px; 
        width: 350px;
        height: 250px;
        border-radius: 10px;
        margin: auto;
        margin-top: calc(50vh - 150px);
        display: none;
      }
      
      #projectLocked {
        background-color: #5a5a5a;
        padding: 15px; 
        width: 350px;
        height: 250px;
        border-radius: 10px;
        margin: auto;
        margin-top: calc(50vh - 150px);
        display: none;
      }
      
      #objectInspector {
        background-color: #5a5a5a;
        padding: 15px; 
        width: 300px;
        height: 330px;
        border-radius: 10px;
        margin: auto;
        margin-top: calc(50vh - 150px);
        display: none;
      }
      
      #behaviorInspector {
        background-color: #5a5a5a;
        padding: 15px; 
        width: 300px;
        height: 330px;
        border-radius: 10px;
        margin: auto;
        margin-top: calc(50vh - 150px);
        display: none;
      }
      
      #objectEditor {
        background-color: #5a5a5a;
        padding: 15px; 
        width: 350px;
        height: 335px;
        border-radius: 10px;
        margin: auto;
        margin-top: calc(50vh - 155px);
        display: none;
      }
      
      #behaviorEditor {
        background-color: #5a5a5a;
        padding: 15px; 
        width: 350px;
        height: 335px;
        border-radius: 10px;
        margin: auto;
        margin-top: calc(50vh - 155px);
        display: none;
      }
      
      #objectEntries {
        background-color: #5a5a5a;
        padding: 15px; 
        width: 350px;
        height: 450px;
        border-radius: 10px;
        margin: auto;
        margin-top: calc(50vh - 225px);
        display: none;
      }
      
      #behaviorEntries {
        background-color: #5a5a5a;
        padding: 15px; 
        width: 350px;
        height: 450px;
        border-radius: 10px;
        margin: auto;
        margin-top: calc(50vh - 225px);
        display: none;
      }
      
      #setPassword {
        background-color: #5a5a5a;
        padding: 15px; 
        width: 350px;
        height: 200px;
        border-radius: 10px;
        margin: auto;
        margin-top: calc(50vh - 100px);
        display: none;
      }
      
      #alertBox {
        background-color: #5a5a5a;
        padding: 15px; 
        width: 350px;
        height: 200px;
        border-radius: 10px;
        margin: auto;
        margin-top: calc(50vh - 100px);
        display: none;
      }
            
      #enterPassword {
        background-color: #5a5a5a;
        padding: 15px; 
        width: 350px;
        height: 200px;
        border-radius: 10px;
        margin: auto;
        margin-top: calc(50vh - 100px);
        display: none;
      }
      
      #patchProject {
        background-color: #5a5a5a;
        padding: 15px; 
        width: 350px;
        height: 252px;
        border-radius: 10px;
        margin: auto;
        margin-top: calc(50vh - 100px);
        display: none;
      }
      
      #modifyBehaviorData {
        background-color: #5a5a5a;
        padding: 15px; 
        width: 350px;
        height: 295px;
        border-radius: 10px;
        margin: auto;
        margin-top: calc(50vh - 200px);
        display: none;
      }
            
      #downloadFiles {
        background-color: #5a5a5a;
        padding: 15px; 
        width: 350px;
        height: 300px;
        border-radius: 10px;
        margin: auto;
        margin-top: calc(50vh - 150px);
        display: none;
      }
      
      #managePlugins {
        background-color: #5a5a5a;
        padding: 15px; 
        width: 350px;
        height: 300px;
        border-radius: 10px;
        margin: auto;
        margin-top: calc(50vh - 150px);
        display: none;
      }
      
      #exportPlugin {
        background-color: #5a5a5a;
        padding: 15px; 
        width: 350px;
        height: 300px;
        border-radius: 10px;
        margin: auto;
        margin-top: calc(50vh - 150px);
        display: none;
      }
      
      #compilingPlugin {
        background-color: #5a5a5a;
        padding: 15px; 
        width: 350px;
        height: 300px;
        border-radius: 10px;
        margin: auto;
        margin-top: calc(50vh - 150px);
        display: none;
      }
      
      #importPlugin {
        background-color: #5a5a5a;
        padding: 15px; 
        width: 350px;
        height: 300px;
        border-radius: 10px;
        margin: auto;
        margin-top: calc(50vh - 150px);
        display: none;
      }
      
      #downloadingFiles {
        background-color: #5a5a5a;
        padding: 15px; 
        width: 350px;
        height: 300px;
        border-radius: 10px;
        margin: auto;
        margin-top: calc(50vh - 150px);
        display: none;
      }
      
      #deleteBehaviorTree {
        background-color: #5a5a5a;
        padding: 15px; 
        width: 300px;
        height: 330px;
        border-radius: 10px;
        margin: auto;
        margin-top: calc(50vh - 150px);
        display: none;
      }
      
      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }
      
      [id='limit']::placeholder { /* Chrome, Firefox, Opera, Safari 10.1+ */
  color: #ff60f7;
  opacity: 1; /* Firefox */
}

[id='limit']:-ms-input-placeholder { /* Internet Explorer 10-11 */
  color: #ff60f7;
}
ff60f7
[id='limit']::-ms-input-placeholder { /* Microsoft Edge */
  color: #ff60f7;
}
      
      #iconImg {
        animation-name: fadeIn;
        animation-duration: 1s;
        border-radius: 5px;
        margin: auto;
        overflow: hidden
      }
      
      input {
        visibility: none;
        border-width: 0px;
        height: 20px;
      }
      
      img {
        border: 0
      }
      
      .custom-file-upload {
        background-color: #00BB78;
        border-radius: 5px;
        display: block;
        position: relative;
        text-decoration: none;
        color:white;
        font-family: 'Helvetica';
        text-align: center;
        font-size: 20px;
        font-weight: bold;
        padding: 5px;
        margin: auto;
        bottom: -8px;
        height: 25px; 
        text-decoration: none;
        width: 10%;
        min-width: 125px;
        overflow: hidden;
      }
      
      .backgroundScroll {
        padding: 8px;
        background-color: #515151;
        border-radius: 10px;
      }
      
      .green {
        color: #00bb78
      }
      
      .lock {
        background: white;
        border-radius: 3px;
        width: 25px;
        height: 20px;
        margin-top: 60px;
        margin-left: 60px;
        position: relative;
      }

      .lock:before {
        content: "";
        display: block;
        position: absolute;
        border:3px solid white;
        top: -14px;
        left: 2.3px;
        width: 15px;
        height: 27px;
        border-radius: 35px 35px 0 0;
      }

      p {
        color: white;
        font-family: Helvetica;
        font-size: 15px;
        margin: auto;
        text-align: center;
      }
      label {
        color: white;
        font-family: Helvetica;
        margin: auto;
      }
      h {
        color: white;
        font-family: Helvetica;
        margin: auto;
        text-align: center;
        font-size: 20px;
        width: 100%;
        font-weight: bold;
      }
      
      .dropdownList {
      display: none;
      position: absolute;
      background-color: #f6f6f6;
      overflow: auto;
      border: 1px solid #ddd;
      z-index: 999999;
      overflow-y: scroll;
      max-height: 375px;
     }
     .dropdownList a {
        color: black;
        padding: 12px 16px;
        text-decoration: none;
        display: block;
     }
   .dropdown a:hover {background-color: #ddd;}
      
      /* The switch - the box around the slider */
.switch {
  position: relative;
  display: inline-block;
  width: 60px;
  height: 34px;
}

/* Hide default HTML checkbox */
.switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

/* The slider */
.slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #aaa;
  -webkit-transition: .4s;
  transition: .4s;
}

.slider:before {
  position: absolute;
  content: "";
  height: 26px;
  width: 26px;
  left: 4px;
  bottom: 4px;
  background-color: white;
  -webkit-transition: .4s;
  transition: .4s;
}

input:checked + .slider {
  background-color: #00bb78;
}

input:focus + .slider {
  box-shadow: 0 0 1px #00bb78;
}

input:checked + .slider:before {
  -webkit-transform: translateX(26px);
  -ms-transform: translateX(26px);
  transform: translateX(26px);
}

/* Rounded sliders */
.slider.round {
  border-radius: 34px;
}

.slider.round:before {
  border-radius: 50%;
}
      
    </style>
    <!--<link rel="stylesheet" href="style.css"/>-->
    <!--<script defer src="script.js"></script>-->
  </head>

  <body>
    
    <!-- Version text -->
    <p id="versionText" style="position: absolute; bottom: 5px; left: 5px;">
      Loading version...
    </p>
    <p id="debugMem" style="position: absolute; bottom: 25px; color:yellow; left: 5px; display: none; text-align: left">
      Loading debug...
    </p>
    
    <!-- Import loading screen -->
    <div class="" style="display: none; width: 100px; height:100px; margin: auto; margin-top: calc(50vh - 35px); transform: scale(1.25)" id="importLoading">
      <div class="lds-ring" style="margin: auto; margin-top: 12px"><div></div><div></div><div></div><div></div></div>
    </div>
    
    <!-- ERROR POPUP -->
    <div class="alert" id="error" style="z-index: 99999">
  <span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span> 
 <p id="error msg" style="margin: 0px; z-index: 999">
   Error msg
      </p>
</div>
    
    <div id="importMenuWhole">
      
    <div id="importMenu">
      <p>
        Import your hyperPad project now! <b style="color:rgba(174,174,174,.98)">(.tap)</b>
      </p>
      
    <label class="custom-file-upload" style="float: left">
    <input type="file" id="file-selector" accept=".tap, .zip">
      Import File
      </label>
      
      <a class="button" onclick="this.innerHTML='Opening Site'" href="https://github.com/RXCodes/hyperPad-Project-Modder" style="min-width:160px; float: right">View on GitHub</a>
      
    </div>
      
    <div id="changelog">
      <p style="color: yellow">
        What's new on <b style="color: orange" id="versionHighlight">this update</b>?
      </p>
      
      <div style="height: 160px; margin-top: 5px; overflow-y: scroll" id="changelogList" class="backgroundScroll">
        
        
      </div>
    </div>
      
      </div>
    
    <div id="errorMenu">
        <h>Error</h>
      <div style="height: 2px; background-color: white; width: 95%; margin-bottom: 10px; margin-top: 2.5px">
        
      </div>
      <p>
        The imported file is not a hyperPad project. Please import a valid hyperPad project.
      </p>
      <a class="button" onclick="returnToMain();">Go back</a>
      
    </div>
    
    <div id="projectViewer">
      <h style="color:#00BB78" id="projectName">Project</h>
      <p style="color:#c0c0c0; text-align:left; font-size: 12px; margin-bottom: 5px" id="fileName">
        ...
      </p>
      <div style="height: 2px; background-color: white; width: 100%; margin-bottom: 10px;"></div>
      
      <div id="projectOptions">
      <p style="width: 100%; height: 20px; margin-bottom: 3px; overflow: hidden" id="projectDataText">
        What would you like to do?
      </p>

      <a class="button" style="width:95%; margin-bottom: 6px; background-color: #d36451" onclick="managePlugins()">
        Manage Plugins
      </a>
      <a class="button" style="width:95%; margin-bottom: 6px; background-color: grey" onclick="compressAssets()">
        Compress Assets
      </a>
      <a class="button" style="width:95%; margin-bottom: 6px;" onclick="behaviorOptions()">
        Modify Behaviors
      </a>
      <a class="button" style="width:95%; margin-bottom: 6px;" onclick="modObjects()">
        Modify Objects
      </a>
      <a class="button" style="width:95%; margin-bottom: 6px;" onclick="editSceneData()">
        Edit Scene Data
      </a>
      <a class="button" style="width:95%; margin-bottom: 6px;" onclick="viewProjectData()">
        Manage Project
      </a>
      <a class="button" style="width:95%; margin-bottom: 6px; background-color: #2896ff" onclick="patchProject()">
        Patch Project
      </a>
      <a class="button" style="width:95%; margin-bottom: 6px;" onclick="finish()">
        Download Project
      </a>
</div>
      
        <div class="loading backgroundScroll" id="loading" style="display: none; margin-top: 20px; z-index: 99; height: 80%">
          <p style="margin-bottom: 10px">
            Compiling Project...
          </p>
    <div class="lds-ring"><div></div><div></div><div></div><div></div></div>
          <div>
            <p style="margin-top: 10px; height: 120px; overflow-y: hidden" id="currentFile">
            Compiling Project...
          </p>
            <div style="height: 10px"></div>
            <p id="compileTime">
              Compiling Time: 0s
            </p>
            <p id="estimatedTimeLeft">
              Estimated Time Left: 0s
            </p>
          <div id="progressBar" style="height: 5px; bottom: 0px; width: 100%; background-color: #2f2f2f; margin-top: 5px; border-radius: 2px;">
        <div id="progress" style="height: 5px; bottom: 0px; left: 0px; width: 0%; background-color: #00bb78; border-radius: 2px">
        </div>
      </div>
      <p id="processTooltip" style="margin: 5px">
        Loading Images...
      </p>
            </div>
</div> 
      
      <div id="icon" style="display: none; width: 100%;">
      <div style="width: 90%; border-radius: 5px; margin: auto; margin-top: 5px; overflow: hidden; margin-bottom: 5px">
        <img style="display: none; width: 95%;" id="iconImg">
      </div>
        <p>
          File Name
        </p>
        <input class="input-field" value="My Project" id="fileExportName" placeholder="My Project">
      </div>
      <a id="download" class="button" style="display: none; text-align: center; float:left; width:45%" onclick="downloadResult()">Download</a>
      <a class="button" onclick="exitMenu();" id="downloadBack" style="display:none; float:right; width:45%">Go back</a>
    </div>
    
    
    <!-- Project data -->
    <div id="projectData">
      <h style="color:#00bb78">Project Details</h>
      <p style="color:#c0c0c0; text-align:left; font-size: 12px; margin-bottom: 5px" id="fileName2">
        Here's what we've found so far.
      </p>
      <div style="height: 2px; background-color: white; width: 100%; margin-bottom: 10px;"></div>
      <div>
        
      </div>
      
      <div style="height: 288px; overflow-y: scroll" class="backgroundScroll">
        <p id="projectDetails" style="text-align:left">
        Loading...
      </p>
        <p>
          <b>Debugging</b>
        </p>
        <a class="button" style="min-width: 320px; margin-bottom: 10px;" onclick="downloadSessionLogs()">Download Session Logs</a>
       <a class="button" style="min-width: 320px; margin-bottom: 10px;" onclick="toggleDebug()">Toggle Memory Usage Debug</a>
        <a id="memGraphButton" class="button" style="min-width: 320px; margin-bottom: 8px" onclick="enableMemDebug()">Enable Memory Graph</a>
        <p style="color:gray; font-size: 12px">
          This feature only works in <b>Chrome</b>!
        </p>
        <div style="height: 15px"></div>
          <p><b>Developer Tools</b></p>
        <a class="button" style="min-width: 320px; margin-bottom: 10px;" onclick="convertObjects()">Convert Objects to Files</a>
        <label class="container" style="font-size: 16px; margin-top: 15px; margin-left: 60px">
            <span style="margin-top: 10px; color: #00bb78">Convert Object Data to JSON</span><span>  (.json)</span>
            <input type="checkbox" checked="" id="convertObjectsToJSON">
            <span class="checkmark"></span>
          </label>
        <label class="container" style="font-size: 16px; margin-top: 15px; margin-left: 60px">
            <span style="margin-top: 10px; color: #00bb78">Automatically Format JSON</span><span>  (Beautify)</span>
            <input type="checkbox" checked="" id="beautifyObjectJSON">
            <span class="checkmark"></span>
          </label>
        
      <a class="button" style="min-width: 320px; margin-bottom: 10px;" onclick="convertBehaviors()">Convert Behaviors to Files</a>
        
        <label class="container" style="font-size: 16px; margin-top: 15px; margin-left: 60px">
            <span style="margin-top: 10px; color: #00bb78">Convert Behavior Data to JSON</span><span>  (.json)</span>
            <input type="checkbox" checked="" id="convertBehaviorsToJSON">
            <span class="checkmark"></span>
          </label>
        <label class="container" style="font-size: 16px; margin-top: 15px; margin-left: 60px">
            <span style="margin-top: 10px; color: #00bb78">Automatically Format JSON</span><span>  (Beautify)</span>
            <input type="checkbox" checked="" id="beautifyBehaviorJSON">
            <span class="checkmark"></span>
          </label>
        
        <div style="height: 15px"></div>
          
          <p><b>Danger Zone</b></p>
 <a class="button" style="background-color:#ff5151; min-width: 320px; margin-bottom: 10px;" onclick="lockProject()">Permanently Lock Project</a>
   <a class="button" style="background-color:#ff5151; min-width: 320px; margin-bottom: 10px;" onclick="setPassword()">Set Password Protection</a>
        <a class="button" style="background-color:#ff5151; min-width: 320px; margin-bottom: 10px;" onclick="prevMenu='projectData'; alertPopup('Hide All Behaviors', 'Are you sure you want to hide all behaviors in your project? This will make them invisible and inaccessible.', hideAllBehaviors)">Hide All Behaviors</a>
        <a class="button" style="background-color:#ff5151; min-width: 320px; margin-bottom: 10px;" onclick="prevMenu='projectData'; alertPopup('Show All Behaviors', 'Are you sure you want to show all hidden behaviors in your project? Behaviors that were previously hidden will be visible and accessible.', showAllBehaviors)">Show All Behaviors</a>
        
        <a class="button" style="background-color:#ff5151; min-width: 320px; margin-bottom: 10px;" onclick="prevMenu='projectData'; alertPopup('Clear Object Dock', 'Are you sure you want to clear the object dock? The object dock is the hotbar used for dragging in assets into the scene.', clearObjectDock)">Clear Object Dock</a>
        
        <a class="button" style="background-color:#ff5151; min-width: 320px; margin-bottom: 10px;" onclick="prevMenu='projectData'; alertPopup('Clear Color Pallete', 'Are you sure you want to reset the color pallete on this project?', clearColorPalette)">Reset Color Palette</a>
        
          <div style="height: 20px"></div>
       
      </div>
      <a class="button" style="min-width:35%; margin-bottom: 6px; float: left" onclick="downloadFiles()">
        Download Files
      </a>
      <a class="button" style="min-width:35%; margin-left: 7px; margin-bottom: 6px; float: left" onclick="throwError('Coming soon!')">
        Local Backups 
      </a>
      <a class="button" style="min-width:20%; margin-bottom: 6px; float: right" onclick="exitMenu()">
        Close
      </a>
    </div>
    
    <!-- Select Scene -->
    <div id="sceneSelector">
      <h style="color:#00bb78">Select Scene</h>
      <p style="color:#c0c0c0; text-align:left; font-size: 12px; margin-bottom: 5px" id="fileName3">
        Here's what we've found so far.
      </p>
      <div style="height: 2px; background-color: white; width: 100%; margin-bottom: 10px;"></div>
      <div>
        <div style="height: 218px; overflow-y: scroll" class="backgroundScroll">
        <p id="sceneList" style="text-align:center">
        Loading...
      </p>
      </div>
      <a class="button" style="width:95%; margin-bottom: 6px;" onclick="exitMenu()">
        Close
      </a>
      </div>
    </div>
    
        <!-- Edit Level Data -->
    <div id="sceneEditor">
      <h style="color:#00bb78" id="sceneName">Edit Scene Data</h>
      <p style="color:#c0c0c0; text-align:left; font-size: 12px; margin-bottom: 5px" id="fileName4">
        Here's what we've found so far.
      </p>
      <div style="height: 2px; background-color: white; width: 100%; margin-bottom: 10px;"></div>
      <div>
        <div style="height: 218px; overflow-y: scroll" class="backgroundScroll">
        
          <p>
            Scene Name
          </p>
          <input type="text" class="input-field" id="sceneNameInput" style="margin-bottom: 5px">
          
          <div style="width:50%; float:left; margin-bottom: 5px">
            <p>
            Scene Mode
          </p>
          <input type="number" class="input-field" id="sceneMode" style="color:#83ffac">
          </div>
          <div style="width:50%; float:right; margin-bottom: 5px">
            <p>
            Scene Type
          </p>
            <select name="Scene Type" id="sceneType" style="color:#c4a3ff">
  <option value="0">Level</option>
  <option value="1">Overlay</option>
</select>
          </div>
          <div style="width:50%; float:left; margin-bottom: 5px">
            <p>
            Index
          </p>
          <input type="number" class="input-field" id="sceneIndex" style="color:#ffeb87">
          </div>
          <div style="width:50%; float:right; margin-bottom: 5px">
            <p>
            Preloading
          </p>
            <select name="Scene Preload" id="scenePreload" style="color:#ffafaf">
  <option value="1">Enabled</option>
  <option value="0">Disabled</option>
</select>
          </div>
          <div style="width:50%; float:left; margin-bottom: 5px">
            <p>
            Scene Width
          </p>
          <input type="number" class="input-field" id="sceneWidth" style="color:#a4d9ff">
          </div>
          <div style="width:50%; float:right; margin-bottom: 5px">
            <p>
            Scene Height
          </p>
          <input type="number" class="input-field" id="sceneHeight" style="color:#a4d9ff">
          </div>
          
          
          <div style="width:50%; float:left; margin-bottom: 5px">
            <p>
            Zoom
          </p>
          <input type="number" class="input-field" id="sceneZoom" style="color:#ffd391">
          </div>
          <div style="width:50%; float:right; margin-bottom: 5px">
            <p>
            Camera
          </p>
          <input type="number" class="input-field" id="sceneCamera" style="color:#ffb48e">
          </div>
          
          <div style="width:50%; float:left; margin-bottom: 5px">
            <p>
            X Position
          </p>
          <input type="number" class="input-field" id="xPos" style="color:#72c9cb">
          </div>
          <div style="width:50%; float:right; margin-bottom: 5px">
            <p>
            Y Position
          </p>
          <input type="number" class="input-field" id="yPos" style="color:#72c9cb">
          </div>
          
      </div>
      <a class="button" style="width:20%; margin-bottom: 6px; float: left;" onclick="exitEditMode()">
        Exit
      </a>
        <a class="button" style="width:48%; margin-bottom: 6px; float: right;" onclick="saveSceneEdit(); exitEditMode(); ">
        Save Edits
      </a>
      </div>
    </div>
    
    <!-- Object Selector -->
    <div id="objectSelector">
      <h style="color:#00bb78">Modify Objects</h>
      <p style="color:#c0c0c0; text-align:left; font-size: 12px; margin-bottom: 5px" id="fileName5">
        Here's what we've found so far.
      </p>
      <div style="height: 2px; background-color: white; width: 100%; margin-bottom: 10px;"></div>
      <div style="height: 255px; overflow-y: scroll" class="backgroundScroll">
        
        <p>
            Filter Objects
          </p>
            <select name="Query" id="searchQuery" style="color:#68ff59; margin-bottom: 5px" onchange="performQuery()">
  <option value="ZNAME">Name</option>
  <option value="ZPHYSICS_MODE">Physics Mode</option>
  <option value="ZOBJECTTYPE">Type</option>
  <option value="ZZ_INDEX">Z Index</option>
  <option value="ZFRICTION">Friction</option>
  <option value="ZMASS">Mass</option>
  <option value="ZFLIPX">X Flip</option>
  <option value="ZFLIPY">Y Flip</option>
  <option value="ZLOCKED">Is Locked</option>
  <option value="ZCOLLIDABLE">Is Collidable</option>
</select>
        
            <select name="Condition" id="searchCondition" style="color:#ffafaf; margin-bottom: 5px" onchange="performQuery()">
  <option value="=">Is Equal To</option>
  <option value="!=">Is Not Equal To</option>
  <option value="like">Includes</option>
  <option value="not like">Does Not Include</option>
  <option value=">">Is Greater Than</option>
  <option value="<">Is Less Than</option>
  <option value=">=">Is Greater Than Or Equal To</option>
  <option value="<=">Is Less Than Or Equal To</option>
</select>
        
          <input placeholder='Enter Query' type="text" class="input-field" id="query" style="margin-bottom: 5px" onchange="performQuery()">
        
         <div style="width:40%; float:left; margin-bottom: 5px">
        <p>
            Limit Count
          </p>
          <input type="number" class="input-field" style="margin-bottom: 5px" id="limit" placeholder="∞" onchange="performQuery()">
        </div>
         <div style="width:60%; float:right; margin-bottom: 5px" >
                   <p>
            Case Sensitive
          </p>
            <select name="Case Sensitive" id="caseSensitive" style="color:#ff5a5a; margin-bottom: 5px" onchange="performQuery()">
  <option value="case">True</option>
  <option value="no-case">False</option>
</select>
        </div>
        
        <p id="searchCount" style="color: #14fff9">
          0 entries out of ? objects
        </p>
        
        <a class="button" style="margin-bottom: 6px; width: 90%" onclick="showObjectEntries()">
        View Matched Entries
      </a>
      </div>
      <div>
      <a class="button" style="min-width: 75px; padding-left: -10px; padding-right: -10px; margin-bottom: 6px; float: left;" onclick="exitMenu()">
        Exit
      </a>
        <a class="button" style="min-width: 125px; margin-bottom: 6px; margin-left: 10px; margin-right: 6px; float: left; background-color: #ff5555" onclick="resetQuery()">
        Reset Query
      </a>
        <a class="button" style="min-width: 100px; margin-bottom: 6px; float: right;" onclick="prevMenu='objectSelector'; editObject()">
        Actions
      </a>
      </div>
    </div>
    
    <!-- View Object Entries -->
    <div id="objectEntries">
      <h style="color:#00bb78">Object Entries</h>
      <p style="color:#c0c0c0; text-align:left; font-size: 12px; margin-bottom: 5px" id="objectEntryText">
        Here's what we've found so far.
      </p>
      <div style="height: 2px; background-color: white; width: 100%; margin-bottom: 10px;"></div>
      <div>
        <div style="height: 340px; overflow-y: scroll" class="backgroundScroll">
        <p id="objectList" style="text-align:left">
        Loading...
      </p>
      </div>
      <a class="button" style="width:95%; margin-bottom: 6px;" onclick="exitObjectEntries()">
        Close
      </a>
      </div>
    </div>
    
    <!-- Object Inspector -->
    <div id="objectInspector">
      <h style="color:#00bb78" id="objectName">Object Data</h>
      <p style="color:#c0c0c0; text-align:left; font-size: 12px; margin-bottom: 5px" id="objectID">
        Here's what we've found so far.
      </p>
      <div style="height: 2px; background-color: white; width: 100%; margin-bottom: 10px;"></div>
      <div>
        <div style="height: 218px; overflow-y: scroll" class="backgroundScroll">
        <p id="objectData" style="text-align:left; white-space:wrap; overflow-x: none">
        Loading...
      </p>
      </div>
      <a class="button" style="width:95%; margin-bottom: 6px;" onclick="closeObjectInspector()">
        Close
      </a>
      </div>
    </div>
    
    <!-- Objects Editor -->
    <div id="objectEditor">
      <h style="color:#00bb78">Edit Object(s)</h>
      <p style="color:#c0c0c0; text-align:left; font-size: 12px; margin-bottom: 5px" id="selectedObject">
        Here's what we've found so far.
      </p>
      <div style="height: 2px; background-color: white; width: 100%; margin-bottom: 10px;"></div>
      <div>
        <div style="height: 218px; overflow-y: scroll" class="backgroundScroll">
        <p id="edits" style="text-align:left; white-space:wrap; overflow-x: none">
        <div style="width:50%; float:left; margin-bottom: 5px">
            <p id="xPosText">
            X Position (px)
          </p>
          <input placeholder="0" type="number" class="input-field input-object" id="ZOBJECTPOSITION/ZX" textParent="xPosText" style="color:#72c9cb">
          </div>
          <div style="width:50%; float:right; margin-bottom: 5px">
            <p id="yPosText">
            Y Position (px)
          </p>
          <input placeholder="0" type="number" class="input-field input-object" id="ZOBJECTPOSITION/ZY" textParent="yPosText" style="color:#72c9cb">
          </div>
          
         <div style="width:50%; float:left; margin-bottom: 5px">
            <p id="xGravityText">
            X Gravity (m/s²)
          </p>
          <input placeholder="0" type="number" class="input-field input-object" id="ZOBJECTDATA/ZGRAVITY_X" textParent="xGravityText" style="color:#8495ff;">
          </div>
          <div style="width:50%; float:right; margin-bottom: 5px">
            <p id="yGravityText">
            Y Gravity (m/s²)
          </p>
          <input placeholder="0" type="number" class="input-field input-object" id="ZOBJECTDATA/ZGRAVITY_Y" textParent="yGravityText" style="color:#8495ff;">
          </div> 
          
        <div style="width:30%; float:left; margin-bottom: 5px; margin-left: 1.75px">
            <p id="xAnchorText">
            X Anchor (%)
          </p>
          <input isPercentage="1" placeholder="0" type="number" class="input-field input-object" id="ZOBJECTPOSITION/ZANCHORX" textParent="xAnchorText" style="color:#cba371;">
          </div>
          <div style="width:30%; float:left; margin-bottom: 5px; margin-left: 3px;">
            <p id="yAnchorText">
            Y Anchor (%)
          </p>
          <input isPercentage="1" placeholder="0" type="number" class="input-field input-object" id="ZOBJECTPOSITION/ZANCHORY" textParent="yAnchorText" style="color:#cba371">
          </div>
          <div style="width:37%; float:right; margin-bottom: 5px; margin-left: -2px; margin-right: 2px;">
            <p id="zIndexText">
            Z Index
          </p>
          <input placeholder="0" type="number" class="input-field input-object" id="ZOBJECTDATA/ZZ_INDEX" textParent="zIndexText" style="color:#fff7a6">
          </div>
        <div style="width:50%; float:left; margin-bottom: 5px">
            <p id="xScaleText">
            X Scale (%)
          </p>
          <input isPercentage="1" placeholder="0" type="number" class="input-field input-object" id="ZOBJECTDATA/ZX_SCALE" textParent="xScaleText" style="color:#eb8fc4;">
          </div>
          <div style="width:50%; float:right; margin-bottom: 5px">
            <p id="yScaleText">
            Y Scale (%)
          </p>
          <input isPercentage="1" placeholder="0" type="number" class="input-field input-object" id="ZOBJECTDATA/ZY_SCALE" textParent="yScaleText" style="color:#eb8fc4">
          </div>
          
          <div style="width:25%; float:left; margin-bottom: 5px; margin-left: 4px">
            <p id="collidableText">
            Collidable
          </p>
          <select class="input-field input-object" id="ZOBJECTDATA/ZCOLLIDABLE" textParent="collidableText" style="color:#ffe970; width: 90%; text-align: center; text-align-last:center; margin: auto; -ms-text-align-last: center; -moz-text-align-last: center">
            <option value="" hidden disabled selected>Mixed</option>
            <option value="0">False</option>
            <option value="1">True</option>
            </select>
          </div>
          <div style="width:25%; float:left; margin-bottom: 5px">
            <p id="lockedText">
            Is Locked
          </p>
          <select class="input-field input-object" id="ZOBJECTDATA/ZLOCKED" textParent="lockedText" style="color:#ffe970; width: 90%; text-align: center; text-align-last:center; margin: auto; -ms-text-align-last: center; -moz-text-align-last: center;">
            <option value="" hidden disabled selected>Mixed</option>
            <option value="0">False</option>
            <option value="1">True</option>
            </select>
          </div>
          <div style="width:25%; float:left; margin-bottom: 5px">
            <p id="xFlipText">
            X Flip
          </p>
          <select class="input-field input-object" id="ZOBJECTDATA/ZFLIPX" textParent="xFlipText" style="color:#ffb185; width: 90%; text-align: center; text-align-last:center; margin: auto; -ms-text-align-last: center; -moz-text-align-last: center;">
            <option value="" hidden disabled selected>Mixed</option>
            <option value="0">False</option>
            <option value="1">True</option>
            </select>
          </div>
          <div style="width:25%; float:right; margin-bottom: 5px; margin-right: -4px">
            <p id="yFlipText">
            Y Flip
          </p>
          <select class="input-field input-object" id="ZOBJECTDATA/ZFLIPY" textParent="yFlipText" style="color:#ffb185; width: 90%; text-align: center; text-align-last:center; margin: auto; -ms-text-align-last: center; -moz-text-align-last: center;">
            <option value="" hidden disabled selected>Mixed</option>
            <option value="0">False</option>
            <option value="1">True</option>
            </select>
          </div>
          
          <div style="width:65%; float:left; margin-bottom: 5px">
            <p id="objectTypeText">
            Object Type
          </p>
          <select class="input-field input-object" id="ZOBJECTDATA/ZOBJECTTYPE" placeholder="Mixed" textParent="objectTypeText" style="color:#ff6000">
            <option value="" hidden disabled selected>Mixed</option>
           <option value="Empty">Empty Object</option>
            <option value="Graphic">Graphic</option>
            <option value="9slice">9 Slice Graphic</option>
            <option value="TTFLabel">TTF Label</option>
            <option value="BMLabel">BM Label</option>
            <option value="LifeIndicator">Life Indicator</option>
            <option value="HealthBar">Health Bar</option>
            <option value="Joystick">Joystick</option>
            <option value="Particle">Particle Effect</option>
            <option value="PauseButton">Pause Button</option>
            <option value="World">Global World Object</option>
            <option value="Ad">Advertisement Banner</option>
            </select>
          </div>
          <div style="width:35%; float:right; margin-bottom: 5px">
            <p id="physicsModeText">
            Physics Mode
          </p>
          <select class="input-field input-object" id="ZOBJECTDATA/ZPHYSICS_MODE" placeholder="Mixed" textParent="physicsModeText" style="color:#eb84cf">
            <option value="" hidden disabled selected>Mixed</option>
            <option value="Kinematic">Wall</option>
            <option value="Dynamic">Physics</option>
            <option value="Scenery">Scenery</option>
            </select>
          </div>
          
       <div style="width:50%; float:left; margin-bottom: 5px">
            <p id="rotationText">
            Rotation (°)
          </p>
          <input placeholder="0" type="number" class="input-field input-object" id="ZOBJECTDATA/ZROTATION" textParent="rotationText" style="color:#b790eb">
          </div>
          <div style="width:50%; float:right; margin-bottom: 5px">
            <p id="densityText">
            Density
          </p>
          <input placeholder="0" type="number" class="input-field input-object" id="ZOBJECTDATA/ZDENSITY" textParent="densityText" style="color:#85cdeb">
          </div>
          
       <div style="width:50%; float:left; margin-bottom: 5px">
            <p id="massText">
            Mass (kg)
          </p>
          <input placeholder="0" type="number" class="input-field input-object" id="ZOBJECTDATA/ZMASS" textParent="massText" style="color:#b790eb">
          </div>
          <div style="width:50%; float:right; margin-bottom: 5px">
            <p id="frictionText">
            Friction (%)
          </p>
          <input isPercentage="1" placeholder="0" type="number" class="input-field input-object" id="ZOBJECTDATA/ZFRICTION" textParent="frictionText" style="color:#eba2a2">
          </div>
          
         <div style="width:50%; float:left; margin-bottom: 10px">
            <p id="restitutionText">
            Restitution (%)
          </p>
          <input isPercentage="1" placeholder="0" type="number" class="input-field input-object" id="ZOBJECTDATA/ZRESTITUTION" textParent="restitutionText" style="color:#b790eb">
          </div>
          <div style="width:50%; float:right; margin-bottom: 10px">
            <p id="linearDampingText">
            Linear Damping
          </p>
          <input placeholder="0" type="number" class="input-field input-object" id="ZOBJECTDATA/ZLINEARDAMPING" textParent="linearDampingText" style="color:#eba2a2">
          </div>
          
          <div style="margin-top: 10px; min-width: 100%; display: block">
          <label class="switch" style="float:left;">
  <input type="checkbox" id="deleteBehaviorsObjects">
  <span class="slider round"></span>
</label>
            <p style="float:left; margin-left: 10px; margin-top: 7px">
              Delete Behaviors in Object(s)<br>
            </p>
            
          </div>
          <br><br>
          
        
      </div>
      <a class="button" style="min-width:90px; margin-bottom: 6px; float: left" onclick="openMenu();">
        Close
      </a>
        <a class="button" style="min-width:100px; background-color: #ff6363; margin-bottom: 6px; margin-left: 6px; float: left" onclick="executeDelete(); openMenu();">
        Delete
      </a>
        <a class="button" style="min-width:100px; margin-bottom: 6px; margin-left: 6px; float: right" onclick="executeApply(); openMenu();">
        Apply
      </a>
      </div>
    </div>
    
    <!-- Behavior options -->
    <div id="behaviorOption">
      <h style="color:#00bb78">Modify Behaviors</h>
      <p style="color:#c0c0c0; text-align:left; font-size: 12px; margin-bottom: 5px" id="fileName7">
        Here's what we've found so far.
      </p>
      <div style="height: 2px; background-color: white; width: 100%; margin-bottom: 10px;"></div>
      <div>
        <div style="height: 218px; overflow-y: scroll" class="backgroundScroll">
          
        <a class="button" onclick="prevMenu = 'behaviorOptions'; downgrade();" style="width:95%; margin-bottom: 6px;">
        Downgrade to Version
      </a>
        <a class="button" style="width:95%; margin-bottom: 6px;" onclick="hideBehaviors()">
        Hide Behaviors
      </a>
         <a class="button" style="width:95%; margin-bottom: 6px;" onclick="removeGlobal();">
        Remove Global behaviors
      </a>
         <a class="button" style="width:95%; margin-bottom: 6px;" onclick="transferBehaviors();">
        Transfer Behaviors
      </a>
         <a class="button" style="width:95%; margin-bottom: 6px;" onclick="modifyBehaviors()">
        Modify Behaviors
      </a>
        <a class="button" style="width:95%; margin-bottom: 6px;" onclick="organizeBehaviors()">
        Organize Behaviors
      </a>
        <a class="button" style="width:95%; margin-bottom: 6px;" onclick="deleteBehaviorTree()">
        Delete Behavior Tree
      </a>
    
      </div>
      <a class="button" style="width:95%; margin-bottom: 6px;" onclick="exitMenu()">
        Close
      </a>
      </div>
    </div>
    
    <!-- Downgrade behaviors -->
    <div id="downgradeBehaviors">
      <h style="color:#00bb78">Downgrade Behaviors</h>
      <p style="color:#c0c0c0; text-align:left; font-size: 12px; margin-bottom: 5px" id="fileName8">
        Here's what we've found so far.
      </p>
      <div style="height: 2px; background-color: white; width: 100%; margin-bottom: 10px;"></div>
      <div>
        <div style="height: 218px; overflow-y: scroll" class="backgroundScroll">
        <p>
          Target Version
        </p>
        <input placeholder="Please enter version" value="1.27" type="number" class="input-field" id="targetVersion" style="color:#00bb78">
        
        <p style="color: #bebebe">
          hyperPad viewer currently supports v1.27 and below. v1.27 is recommended for hyperPad viewer.
        </p>
          <br>
          <p>
          Target ZNAME <b style="color:#bebebe">(Advanced)</b>
        </p>
        <input placeholder="All" value="" type="text" class="input-field" id="targetZName" style="color:#00bb78">
          <p style="color: #bebebe">
          Leave blank to check all behaviors.
        </p>
        </div>
        
      <a class="button" style="width:95px; float:left; margin-bottom: 6px;" onclick="openMenu()">
        Close
      </a>
        <a class="button" style="min-width:147px; margin-bottom: 6px; margin-left: 6px; float: right" onclick="downgradeAction();">
        Downgrade
      </a>
      </div>
    </div>
    
    <!-- Remove all global behaviors -->
    <div id="deleteGlobalBehaviors">
      <h style="color:#00bb78">Remove All Global Behaviors</h>
      <p style="color:#c0c0c0; text-align:left; font-size: 12px; margin-bottom: 5px" id="fileName6">
        Here's what we've found so far.
      </p>
      <div style="height: 2px; background-color: white; width: 100%; margin-bottom: 10px;"></div>
      <div>
        <div style="height: 118px; overflow-y: scroll" class="backgroundScroll">
        <p>
          Are you sure you want to delete ALL behaviors from the global / world object? <b style="color:#ff5151">This action cannot be undone.</b>
        </p>
        </div>
        
      <a class="button" style="width:95px; float:left; margin-bottom: 6px;" onclick="openMenu()">
        Close
      </a>
        <a class="button" style="min-width:147px; margin-bottom: 6px; margin-left: 6px; float: right; background-color: #ff5151" onclick="removeGlobalBehaviors();">
        Delete
      </a>
      </div>
    </div>
    
    <!-- Hide behaviors -->
    <div id="hideBehaviors">
      <h style="color:#00bb78">Hide Behaviors</h>
      <p style="color:#c0c0c0; text-align:left; font-size: 12px; margin-bottom: 5px" id="fileName9">
        Here's what we've found so far.
      </p>
      <div style="height: 2px; background-color: white; width: 100%; margin-bottom: 10px;"></div>
      <div>
        <div style="height: 140px; overflow-y: scroll" class="backgroundScroll">
        <p style="color: pink">
          Search for Object Name:
          </p>
          <input class="input-field object-selector" type="text" id="objectBehaviorTarget">
          <div style="height:10px"></div>
          <p>
            When behaviors are hidden, they are inaccessible and invisible to the user.
          </p>
        </div>
        
      <a class="button" style="width:90px; float:left; margin-bottom: 6px;" onclick="openMenu()">
        Close
      </a>
        <a class="button" style="min-width:85px; margin-bottom: 6px; margin-left: 6px; float: right; background-color: #ff5151" onclick="execHideBehaviors();">
        Hide
      </a>
        <a class="button" style="min-width:85px; margin-bottom: 6px; margin-left: 6px; float: right; background-color: #e99c37" onclick="execShowBehaviors();">
        Show
      </a>
      </div>
    </div>
    
    <div id="objectSelectorDropdown" class="dropdownList dropdown"></div>
    
    <!-- transfer behaviors -->
    <div id="transferBehaviors">
      <h style="color:#00bb78">Transfer Behaviors</h>
      <p style="color:#c0c0c0; text-align:left; font-size: 12px; margin-bottom: 5px" id="fileName10">
        Here's what we've found so far.
      </p>
      <div style="height: 2px; background-color: white; width: 100%; margin-bottom: 10px;"></div>
      <div>
        <div style="height: 140px; overflow-y: scroll" class="backgroundScroll">
        <p>
          Move all behaviors from object:
          </p>
          <input class="input-field object-selector" type="text" id="objectBehaviorFrom">
          <div style="height:10px"></div>
          <p>
          to object:
          </p>
          <input class="input-field object-selector" type="text" id="objectBehaviorTo">
          <div style="height:10px"></div>
        </div>
        
      <a class="button" style="width:80px; float:left; margin-bottom: 6px;" onclick="openMenu()">
        Close
      </a>
        <a class="button" style="min-width:195; margin-bottom: 6px; margin-left: 6px; float: right;" onclick="execTransferBehaviors();">
        Move Behaviors
      </a>
        
      </div>
    </div>
    
    <!-- lock project -->
    <div id="lockProject">
      <h style="color:#00bb78">Lockdown Project</h>
      <p style="color:#c0c0c0; text-align:left; font-size: 12px; margin-bottom: 5px" id="fileName11">
        Here's what we've found so far.
      </p>
      <div style="height: 2px; background-color: white; width: 100%; margin-bottom: 10px;"></div>
      <div>
        <div style="height: 140px; overflow-y: scroll" class="backgroundScroll">
        <p>
          Locking your project will make it uneditable forever. The project will be unaccessible, meaning objects and behaviors cannot be edited. Once you do this, you can no longer mod the project - Make sure you have a copy! Functionality of the project will remain intact.<br>
          <b style="color:#ff4f4f">This change cannot be reverted.</b>
          </p>
        </div>
        
      <a class="button" style="width:80px; float:left; margin-bottom: 6px;" onclick="openMenu()">
        Cancel
      </a>
        <a class="button" style="min-width:195; margin-bottom: 6px; margin-left: 6px; float: right; background-color: #ff4f4f" onclick="enforceLockdown();">
        Enforce Lockdown
      </a>
        
      </div>
    </div>
    
    <!-- locked project -->
    <div id="projectLocked">
      <h style="color:#ff5d5d">PROJECT LOCKED</h>
      <p style="color:#c0c0c0; text-align:left; font-size: 12px; margin-bottom: 5px" id="fileName12">
        Here's what we've found so far.
      </p>
      <div style="height: 2px; background-color: white; width: 100%; margin-bottom: 10px;"></div>
      <div>
        <div style="height: 140px; overflow-y: scroll" class="backgroundScroll">
        <p>
          This project is locked and cannot be modified.
          </p>
          
          <div class="lock" style="transform:scale(2.5); color:white; margin: auto; margin-top: 70px;"></div>
          
        </div>
        
      <a class="button" style="width:80px; float:left; margin-bottom: 6px;" onclick="returnToMain()">
        Import Project
      </a>
        <a class="button" style="min-width:195px; margin-bottom: 6px; margin-left: 6px; float: right;" onclick="projectScreen(); finish();">
        Download Project
      </a>
        
      </div>
    </div>
    
    <!-- set pass project -->
    <div id="setPassword">
      <h style="color:#00bb78">Set Password</h>
      <p style="color:#c0c0c0; text-align:left; font-size: 12px; margin-bottom: 5px" id="fileName13">
        Here's what we've found so far.
      </p>
      <div style="height: 2px; background-color: white; width: 100%; margin-bottom: 10px;"></div>
      <div>
        <div style="height: 90px; overflow-y: scroll" class="backgroundScroll">
        <p style="margin-bottom: 8px">
          Set a password to protect your project from unauthorized modding on this app.
          </p>
          
          <input class="input-field" type="text" placeholder="Enter Password" id="password">
          
        </div>
        
      <a class="button" style="width:75px; float:left; margin-bottom: 6px;" onclick="openMenu()">
        Go Back
      </a>
        <a class="button" style="min-width:195px; margin-bottom: 6px; margin-left: 6px; float: right; background-color:#ff7070" onclick="setPass()">
        Set Password
      </a>
        
      </div>
    </div>
    
    <!-- load pass project -->
    <div id="enterPassword">
      <h style="color:#00bb78">Enter Password</h>
      <p style="color:#c0c0c0; text-align:left; font-size: 12px; margin-bottom: 5px" id="fileName14">
        Here's what we've found so far.
      </p>
      <div style="height: 2px; background-color: white; width: 100%; margin-bottom: 10px;"></div>
      <div>
        <div style="height: 90px; overflow-y: scroll" class="backgroundScroll">
        <p style="margin-bottom: 8px">
          This project is locked by a password. Enter the password to continue.
          </p>
          
          <input class="input-field" type="password" placeholder="Enter Password" id="password2">
          
        </div>
        
      <a class="button" style="width:75px; float:left; margin-bottom: 6px;" onclick="returnToMain()">
        Go Back
      </a>
        <a class="button" style="min-width:195px; margin-bottom: 6px; margin-left: 6px; float: right;" onclick="enterPass()">
        Proceed
      </a>
        
      </div>
    </div>
    
    <!-- download files project -->
    <div id="downloadFiles">
      <h style="color:#00bb78">Download Files</h>
      <p style="color:#c0c0c0; text-align:left; font-size: 12px; margin-bottom: 5px" id="fileName15">
        Here's what we've found so far.
      </p>
      <div style="height: 2px; background-color: white; width: 100%; margin-bottom: 10px;"></div>
      <div>
        <div style="height: 190px; overflow-y: scroll" class="backgroundScroll">
        <p style="margin-bottom: 8px">
          Select files that you want to download - Selecting multiple will place them in a folder for you.
          </p>
          
          <label class="container" style="font-size: 16px; margin-top: 2px">
            <span style="margin-top: 10px; color: #00bb78">Project Database</span><span> (.sqlite)</span>
            <input type="checkbox" id="sqliteFile">
            <span class="checkmark"></span>
          </label>
          <label class="container" style="font-size: 16px; margin-top: 2px">
            <span style="margin-top: 10px; color: #00bb78">Project Database</span><span>  (.json)</span>
            <input type="checkbox" id="jsonFile">
            <span class="checkmark"></span>
          </label>
          <label class="container" style="font-size: 16px; margin-top: 2px">
            <span style="margin-top: 10px; color: #00bb78">Assets Folder</span><span id="assetsFolderProgress"> (directory) </span>
            <input type="checkbox" id="assetsFolder">
            <span class="checkmark"></span>
          </label>
          <label class="container" style="font-size: 16px; margin-top: 2px">
            <span style="margin-top: 10px; color: #00bb78">Project Details</span><span>  (.plist)</span>
            <input type="checkbox" id="projectDetailsFile">
            <span class="checkmark"></span>
          </label>
          <label class="container" style="font-size: 16px; margin-top: 2px">
            <span style="margin-top: 10px; color: #00bb78">Object Dock</span><span>  (.plist)</span>
            <input type="checkbox" id="objectDockFile">
            <span class="checkmark"></span>
          </label>
          <label class="container" style="font-size: 16px; margin-top: 2px">
            <span style="margin-top: 10px; color: #00bb78">Color Picker Memory</span><span>  (.plist)</span>
            <input type="checkbox" id="colorPickerMemoryFile">
            <span class="checkmark"></span>
          </label>
          <label class="container" style="font-size: 16px; margin-top: 2px">
            <span style="margin-top: 10px; color: #00bb78">Persistent Data</span><span>  (.plist)</span>
            <input type="checkbox" id="persistentFile">
            <span class="checkmark"></span>
          </label>
          <label class="container" style="font-size: 16px; margin-top: 2px">
            <span style="margin-top: 10px; color: #00bb78">Project Icon</span><span>  (.png)</span>
            <input type="checkbox" id="projectIconFile">
            <span class="checkmark"></span>
          </label>
          <label class="container" style="font-size: 16px; margin-top: 2px">
            <span style="margin-top: 10px; color: #00bb78">Project Icon HD</span><span>  (.png)</span>
            <input type="checkbox" id="projectIconHDFile">
            <span class="checkmark"></span>
          </label>
          <label class="container" style="font-size: 16px; margin-top: 2px">
            <span style="margin-top: 10px; color: #00bb78">Internal Objects Database</span><span>  (.json)</span>
            <input type="checkbox" id="internalObjectsDatabase">
            <span class="checkmark"></span>
          </label>
          <label class="container" style="font-size: 16px; margin-top: 2px">
            <span style="margin-top: 10px; color: #00bb78">Internal Behaviors Database</span><span>  (.json)</span>
            <input type="checkbox" id="internalBehaviorsDatabase">
            <span class="checkmark"></span>
          </label>
          
        </div>
        
      <a class="button" style="width:75px; float:left; margin-bottom: 6px;" onclick="openMenu()">
        Go Back
      </a>
        <a class="button" style="min-width:195px; margin-bottom: 6px; margin-left: 6px; float: right;" onclick="downloadFilesExecute()" id='downloadExecButton'>
        Download
      </a>
        
      </div>
    </div>
    
    <!-- downloading files project -->
    <div id="downloadingFiles">
      <h style="color:#00bb78">Downloading Files</h>
      <p style="color:#c0c0c0; text-align:left; font-size: 12px; margin-bottom: 5px" id="fileName17">
        Here's what we've found so far.
      </p>
      <div style="height: 2px; background-color: white; width: 100%; margin-bottom: 10px;"></div>
      <div>
        <div style="height: 230px; overflow-y: scroll" class="backgroundScroll">
        <p style="margin-bottom: 8px" id="downloadStatus">
          Creating a folder with all the selected files...
          </p>
          
          <p id="fileViewDownload" style="text-align: left">
            
          </p>
          
        </div>
        
      </div>
    </div>
    
    <!-- alert box -->
    <div id="alertBox">
      <h style="color:#00bb78" id="alertTitle">Alert</h>
      <p style="color:#c0c0c0; text-align:left; font-size: 12px; margin-bottom: 5px" id="fileName16">
        Here's what we've found so far.
      </p>
      <div style="height: 2px; background-color: white; width: 100%; margin-bottom: 10px;"></div>
      <div>
        <div style="height: 90px; overflow-y: scroll" class="backgroundScroll">
        <p id="alertDescription">
          Alert description
          </p>      
          
        </div>
        
      <a class="button" style="width:80px; float:left; margin-bottom: 6px;" onclick="openMenu()">
        Cancel
      </a>
        <a class="button" style="min-width:195px; margin-bottom: 6px; margin-left: 6px; float: right;" onclick="openMenu(); acceptAlert();">
        Proceed
      </a>
        
      </div>
    </div>
    
    <!-- manage plugins -->
    <div id="managePlugins">
      <h style="color:#00bb78">Manage Plugins</h>
      <p style="color:#c0c0c0; text-align:left; font-size: 12px; margin-bottom: 5px" id="fileName18">
        Here's what we've found so far.
      </p>
      <div style="height: 2px; background-color: white; width: 100%; margin-bottom: 10px;"></div>
      <div>
        <div style="height: 185px; overflow-y: scroll" class="backgroundScroll">
        
          <p style="margin-bottom: 8px" id="pluginCount">
          You have 0 plugins.
          </p>
          <div id="plugins">
            
          </div>
          
        </div>
        
      <a class="button" style="min-width:90px;float:left; margin-bottom: 6px;" onclick="exitMenu()">
        Go Back
      </a>
        <label class="custom-file-upload" style="min-width:135px; margin-bottom: 6px; margin-left: 6px; float: right;">
    <input type="file" id="pluginImporter" accept="*">
      Install Plugin
      </label>
        <a class="button" style="min-width:80px; margin-bottom: 6px; margin-left: 6px; float: right;" onclick="exportPlugin()">
        Export
      </a>
        
      </div>
    </div>
    
    <!-- export plugins -->
    <div id="exportPlugin">
      <h style="color:#00bb78">Export Plugin</h>
      <p style="color:#c0c0c0; text-align:left; font-size: 12px; margin-bottom: 5px" id="fileName19">
        Here's what we've found so far.
      </p>
      <div style="height: 2px; background-color: white; width: 100%; margin-bottom: 10px;"></div>
      <div>
        <div style="height: 185px; overflow-y: scroll" class="backgroundScroll">
        <p>
          Plugin Name
          </p>
          <input class="input-field" value="My Plugin" placeholder="Enter Plugin Name" id="PluginName">
          <div style="height: 10px">
            
          </div>
          
          <p>
            Icon Display
          </p>
          <div style="margin-bottom: 10px">
           <div style="float:left; height: 125px; width: 125px; margin-left:10px">
             <img id="pluginIcon" src="" style="width: 100%; height: 100%; border-radius: 10px; background-color:#666; margin-top: 12px">
            </div> 
            <a class="button" style="min-width:160px; margin-bottom: 6px; margin-left: 12px; float: left;" onclick="resetIcon()">
        Reset Icon
      </a>
    <label class="custom-file-upload" style="min-width:160px; margin-bottom: 10px; margin-left: 12px; float: left;">
    <input type="file" id="icon-selector" accept="image">
      Import Image
      </label>
            <p style="margin-bottom: 10px">
              Recommended image dimensions are<br>256px by 256px.
            </p>
          </div>
          
          <p>
            Description
          </p>
          <textarea class="input-field" id="PluginDescription" placeholder="Enter description" style="height: 70px"></textarea>
          <div style="height: 10px">
            
          </div>
          <p style="text-align: left; color: #ff5757; margin-bottom: 10px">
            NOTE: All objects will be placed on the global layer to work with all scenes.
          </p>
          <label class="container" style="font-size: 16px; margin-top: 2px">
            <span style="margin-top: 10px; color: #00bb78">Select Multiple Objects</span>
            <input type="checkbox" id="selectMultiplePluginObjects">
            <span class="checkmark"></span>
          </label>
          
          <div id="targetSinglePluginObject">
          <p style="color:#ff9fff">
          Target Object
          </p>
          <input class="input-field object-selector" type="text" id="pluginObject">
          <div style="height: 10px">
            
            </div>
          </div>
          
          <div id="targetMultiplePluginObjects" style="display:none">
          <p style="color:#ffb173">
          Target Prefix
          </p>
          <input class="input-field" placeholder="Enter Prefix" type="search" id="pluginPrefix">
          <div style="height: 8px"></div>
            <p style="margin-bottom: 1px; color: #999">
              Object names with this prefix will be selected.
            </p>
            <p style="margin-bottom: 15px; color: #bbb" id="multiplePluginSelectionCount">
              0 Objects Selected
            </p>
            <label class="container" style="font-size: 16px; margin-top: 2px">
            <span style="margin-top: 10px; color: #00bb78">Obsfucate Object Names</span>
            <input type="checkbox" id="obsfucateObjects">
            <span class="checkmark"></span>
            </label>
          </div>
          
          <label class="container" style="font-size: 16px; margin-top: 2px">
            <span style="margin-top: 10px; color: #00bb78">Closed Source</span><span> (Hide Objects)</span>
            <input type="checkbox" id="closedSource">
            <span class="checkmark"></span>
          </label>
          <label class="container" style="font-size: 16px; margin-top: 2px">
            <span style="margin-top: 10px; color: #00bb78">Require Assets</span>
            <input type="checkbox" id="requireAssets">
            <span class="checkmark"></span>
          </label>
          <div id="requireAssetsSelect" style="display:none">
          <p style="color:#ffac7a">
          Target Folder
          </p>
          <select class="input-field" placeholder="Select Directory" id="assetsPrefix">
            </select>
          <div style="height: 8px"></div>
            <p style="margin-bottom: 1px; color: #999">
              Assets in this folder will be used
            </p>
            <p style="margin-bottom: 15px; color: #bbb" id="multipleAssetsCount">
              0 Assets Found
            </p>
            
            <label class="container" style="font-size: 16px; margin-top: 2px">
            <span style="margin-top: 10px; color: #00bb78">Use Alias Folder</span>
            <input type="checkbox" id="hideAssets">
            <span class="checkmark"></span>
            </label>
            <div id="AliasFolder" style="display: none; margin-bottom: 15px;">
              <p style="margin-bottom: 15px;">
                Predefined types are "Graphic", "Sound", "BMFont", "TTFFont" and "Particle". But of course, you can specify your own.
              </p>
              <input class="input-field" type="text" id="aliasFolderType" value="Graphic">
            </div>
              <label class="container" style="font-size: 16px; margin-top: 2px">
            <span style="margin-top: 10px; color: #00bb78">Hide Assets from Files View</span>
            <input type="checkbox" id="hideAssetsfromFiles">
            <span class="checkmark"></span>
              
          </label>
          </div>
              
        </div>
        
      <a class="button" style="min-width:110px;float:left; margin-bottom: 6px;" onclick="openMenu()">
        Go Back
      </a>
        <a class="button" style="min-width:200px; margin-bottom: 6px; margin-left: 6px; float: right;" onclick="downloadPlugin()">
        Download Plugin
      </a>
        
      </div>
    </div>
    
    
        <!-- import plugins -->
    <div id="importPlugin">
      <h style="color:#00bb78">Import Plugin</h>
      <p style="color:#c0c0c0; text-align:left; font-size: 12px; margin-bottom: 5px" id="fileName20">
        Here's what we've found so far.
      </p>
      <div style="height: 2px; background-color: white; width: 100%; margin-bottom: 10px;"></div>
      <div>
        <div style="height: 185px; overflow-y: scroll" class="backgroundScroll">
        <p id="pluginNameView" style="color:#00bb78; font-weight: bold; font-size: 16px">
          Plugin Name
          </p>
          <div style="height: 3px">
            
          </div>

             <img id="pluginIconView" src="" style="width: 150px; height: 150px; border-radius: 10px; background-color:#666; margin-left:auto; margin-right:auto; margin-bottom: 6px; display:block">
          
          <p style="margin-top: 6px">
            Description
          </p>
          <textarea readonly class="input-field" id="PluginDescriptionView" placeholder="Enter description" style="height: 100px; overflow-y: scroll"></textarea>
          <div style="margin-bottom: 10px">
            
          </div>
          <p>
            Plugin Information
          </p>
          <p id="pluginInfo" style="text-align: left">
            
          </p>
          
        </div>
        
      <a class="button" style="min-width:110px;float:left; margin-bottom: 6px;" onclick="openMenu()">
        Cancel
      </a>
        <a class="button" style="min-width:200px; margin-bottom: 6px; margin-left: 6px; float: right;" onclick="importPlugin()">
        Import Plugin
      </a>
        
      </div>
    </div>
    
    <!-- compiling plugin -->
    <div id="compilingPlugin">
      <h style="color:#00bb78">Processing Plugin</h>
      <p style="color:#c0c0c0; text-align:left; font-size: 12px; margin-bottom: 5px" id="fileName21">
        Here's what we've found so far.
      </p>
      <div style="height: 2px; background-color: white; width: 100%; margin-bottom: 10px;"></div>
      <div>
        <div style="height: 230px;" class="backgroundScroll">
          <div>
            
          <div id="planeAnimScreen">
        
        <p style="margin-bottom: 8px">
          Compiling plugin... This might take a while...
          </p>
          <div class="lds-ring"><div></div><div></div><div></div><div></div></div>
          
          <p id="compilingPluginPercent">
            0%
          </p>
          
          <img id="plane" style="position: absolute; margin: auto; display: block; bottom: 20px;">
            </div>
          </div>
        </div>
        
      </div>
    </div>
    
    <!-- patch project -->
    <div id="patchProject">
      <h style="color:#00bb78">Patch Project</h>
      <p style="color:#c0c0c0; text-align:left; font-size: 12px; margin-bottom: 5px" id="fileName22">
        Here's what we've found so far.
      </p>
      <div style="height: 2px; background-color: white; width: 100%; margin-bottom: 10px;"></div>
      <div>
        <div style="height: 140px; overflow-y: scroll" class="backgroundScroll" id="patchList">
        ...
        </div>
        
      <a class="button" style="width:80px; float:left; margin-bottom: 6px;" onclick="exitMenu()">
        Close
      </a>
        <a class="button" style="min-width:195; margin-bottom: 6px; margin-left: 6px; float: right; background-color: #2896ff" onclick="executePatch();" id="execPatch">
        Patch Project
      </a>
        
      </div>
    </div>
    
    <!-- modify behaviors -->
    <div id="modifyBehaviorData">
      <h style="color:#00bb78">Modify Behaviors</h>
      <p style="color:#c0c0c0; text-align:left; font-size: 12px; margin-bottom: 5px" id="fileName23">
        Here's what we've found so far.
      </p>
      <div style="height: 2px; background-color: white; width: 100%; margin-bottom: 10px;"></div>
      <div style="height: 185px; overflow-y: scroll" class="backgroundScroll">
      <p>
          Search for a behavior in the project or select multiple behaviors in an object.
          </p><div style="height: 7px"></div>
      
      <label class="container" style="font-size: 16px; margin-top: 2px">
            <span style="margin-top: 10px; color: #00bb78">Search for Behaviors in Object</span>
            <input type="checkbox" id="searchInObject">
            <span class="checkmark"></span>
            </label>
      
      <div id="multipleBehaviors" style="display:none">
        
          <div>

          <p style="color: #ff887f">
            Search in Object:
          </p>
          <input class="input-field object-selector" type="text" id="objectBehaviorSearch">
          <div style="height: 1px"></div>
</div>
        </div>
  <div id="selectBehavior">
          
          <p style="color: #7dff5f">
            Select Behavior:
          </p>
          <input class="input-field behavior-selector" type="text" id="BehaviorSearch">
          <div style="height: 1px"></div>
    </div>
        
          <a class="button" style="min-width:90%; margin-bottom: 6px;" onclick="behaviorEntries(); prevMenu='modifyBehaviorData'">
        View Matched Entries
      </a>

          
        </div>
        
      <a class="button" style="min-width:100px;float:left; margin-bottom: 6px;" onclick="menu('behaviorOption')">
        Go Back
      </a>
      <a class="button" style="min-width:155px;float:left; margin-left: 8px; margin-bottom: 6px;" onclick="editBehaviors(); prevMenu='modifyBehaviorData'">
        Modify Entries
      </a>
      <a class="button" style="min-width:49px;float:right;margin-bottom: 6px; background-color:#ffb966" onclick="editBehaviors('all'); prevMenu='modifyBehaviorData'">
        All
      </a>
       
    </div>
    
    <!-- View Behavior Entries -->
    <div id="behaviorEntries">
      <h style="color:#00bb78">Behavior Entries</h>
      <p style="color:#c0c0c0; text-align:left; font-size: 12px; margin-bottom: 5px" id="behaviorEntryText">
        Here's what we've found so far.
      </p>
      <div style="height: 2px; background-color: white; width: 100%; margin-bottom: 10px;"></div>
      <div>
        <div style="height: 340px; overflow-y: scroll" class="backgroundScroll">
        <p id="behaviorList" style="text-align:left">
        Loading...
      </p>
      </div>
      <a class="button" style="width:95%; margin-bottom: 6px;" onclick="openMenu()">
        Close
      </a>
      </div>
    </div>
    
    <!-- Behavior Inspector -->
    <div id="behaviorInspector">
      <h style="color:#00bb78" id="objectName">Behavior Data</h>
      <p style="color:#c0c0c0; text-align:left; font-size: 12px; margin-bottom: 5px" id="behaviorID">
        Here's what we've found so far.
      </p>
      <div style="height: 2px; background-color: white; width: 100%; margin-bottom: 10px;"></div>
      <div>
        <div style="height: 218px; overflow-y: scroll" class="backgroundScroll">
        <p id="behaviorData" style="text-align:left; white-space:wrap; overflow-x: none">
        Loading...
      </p>
      </div>
      <a class="button" style="width:95%; margin-bottom: 6px;" onclick="openMenu(); prevMenu = 'modifyBehaviorData';">
        Close
      </a>
      </div>
    </div>
    
    <!-- Downgrade behaviors -->
    <div id="deleteBehaviorTree">
      <h style="color:#00bb78">Delete Behavior Tree</h>
      <p style="color:#c0c0c0; text-align:left; font-size: 12px; margin-bottom: 5px" id="fileName24">
        Here's what we've found so far.
      </p>
      <div style="height: 2px; background-color: white; width: 100%; margin-bottom: 10px;"></div>
      <div>
        <div style="height: 218px; overflow-y: scroll" class="backgroundScroll">
        <p>
          Parent Behavior
        </p>
        <input class="input-field behavior-selector" id="parentBehaviorTree" style="color:#00bb78">
        
        <p style="color: #bebebe">
          The select behavior and its child behaviors will be deleted with the parent.
        </p>
          <br>
          <p>
          Iteration Levels
        </p>
        <input type="number" value="0" class="input-field" id="deleteTreeIterations" style="color:#ffba7f">
        
        <p style="color: #bebebe">
          How many iterations from the parent behavior to delete the behaviors. Set to 0 to delete ALL child behaviors.
        </p>
      
        </div>
        
      <a class="button" style="width:95px; float:left; margin-bottom: 6px;" onclick="menu('behaviorOption')">
        Close
      </a>
        <a class="button" style="background-color: #ff6050; min-width:147px; margin-bottom: 6px; margin-left: 6px; float: right" onclick="deleteBehaviorTreeForce();">
        Delete
      </a>
      </div>
    </div>
    
  </body>
    
  </div>
</html>

<!-- download functionality -->
<script src="https://cdn.jsdelivr.net/npm/web-streams-polyfill@2.0.2/dist/ponyfill.min.js"></script>
    <!-- includes blob.stream() polyfill -->
    <script src="https://cdn.jsdelivr.net/gh/eligrey/Blob.js/Blob.js"></script>
    <script src="https://rxcodes.github.io/hyperPad-Project-Modder/saveFile.js"></script>
    

<!-- import -->

<script>
  
  // delete behavior tree
  function deleteBehaviorTree() {
    getBehaviors();
    menu("deleteBehaviorTree");
  }
  
  function deleteBehaviorTreeForce() {
    
    try {
    let toDelete = {};
    let startTime = Date.now();
    let behavior = document.getElementById("parentBehaviorTree").uuid;
      
    if (!behavior) {
      return throwError("Behavior must be specified")
    }  
      
    let iterations = document.getElementById("deleteTreeIterations").value || 0;
    if (iterations != parseInt(iterations)) {
      return throwError("Iteration count must be a positive integer")
    }
      
    if (iterations < 0) {
      return throwError("Iteration count cannot be negative")
    }
      
    if (iterations == 0) {
      iterations = Infinity;
    }
    
    let deletes = 1;
    toDelete[behavior] = true;
    let checks = [];
    
    function it(id) {
      if (toDelete[id]) {
        return;
      }
      toDelete[id] = true;
      deletes++;
      let bData = db.exec("select zactions from zbehaviourdata where ztag = " + JSON.stringify(id));
      if (bData)
      bData = bData[0].values[0][0];
      bData = extract(Buffer.from(bData));
      (bData.outputs || []).forEach(function(id) {
        if (toDelete[id]) {
          return;
        }
        checks.push(id);
      });
    }
    
    let bData = db.exec("select zactions from zbehaviourdata where ztag = " + JSON.stringify(behavior));
      
    if (bData.length == 0) {
      return throwError("Behavior no longer exists, choose another behavior")
    }
      
    bData = bData[0].values[0][0];
    bData = extract(Buffer.from(bData));
    (bData.outputs || []).forEach(function(id) {
      console.log(id)
      checks.push(id);
    })
    
    while (checks.length > 0 && iterations > 0) {
      iterations--;
      let tmp = checks;
      checks = [];
      tmp.forEach(function(id) {
        it(id);
      })
    }
    
    console.log(toDelete)
    Object.keys(toDelete).forEach(function(id) {
      db.run("delete from zbehaviourdata where ztag = " + JSON.stringify(id));
    })
    
    let deltaTime = Date.now() - startTime;
    throwSuccess("Removed " + deletes + " behaviors (" + deltaTime + "ms)");
    document.getElementById("parentBehaviorTree").value = "";
    document.getElementById("parentBehaviorTree").uuid = undefined;
    
    } catch(e) {
      throwError("Internal error deleting behaviors: " + e)
    }
      
  }
  
  // organize behaviors
  function organizeBehaviors() {
    let root = db.exec("select z_pk, zx_pos, zy_pos, zactions from zbehaviourdata where ZISROOT = 1")[0].values;
    
    let xSpace = 1250;
    let ySpace = 800;    
    let startTime = Date.now();
    let writes = 0;
      
    // loop through each root behavior
    root.forEach(function(data) {
      
      let zpk = data[0];
      let xPos = data[1];
      let yPos = data[2];
      
      let organized = {};
      let tree = {};
      
      // put behaviors into columns
      function chain(id, xPos, yPos, parent) {
        yPos -= ySpace;
        if (!organized[id]) {
          let data = db.exec("select zactions from zbehaviourdata where ztag = " + JSON.stringify(id));
          if (data.length == 0) {
            return;
          }
          data = data[0].values[0][0];
          data = extract(Buffer.from(data));
          organized[id] = {
            x: xPos,
            y: yPos,
            parents: parent
          }
          if (!data.outputs) {
            return;
          }
          if (data.outputs.length == 1) {
            chain(data.outputs[0], xPos, yPos, parent);
          }
          if (data.outputs.length > 1) {
            parent.push(id);
            let x = xPos - ((data.outputs.length * xSpace) / 2);
            data.outputs.forEach(function(id) {
              chain(id, x, yPos, parent);
              x += xSpace;
            })
          }
        } else {
          return;
        }
      }
        
      let zactions = extract(Buffer.from(data[3]));
      let outputs = zactions.outputs;
      let x = xPos - (((outputs.length - 1) * xSpace) / 2);
      outputs.forEach(function(id) {
        chain(id, x, yPos, []);
        x += xSpace;
      })
      
      Object.keys(organized).forEach(function(id) {
        let b = organized[id];
        db.run("update zbehaviourdata set zx_pos = " + b.x + " where ztag = " + JSON.stringify(id));
        writes++;
        db.run("update zbehaviourdata set zy_pos = " + b.y + " where ztag = " + JSON.stringify(id));
        writes++;
        console.debug([b.x, b.y, id])
      })
      
    })
    
    let deltatime = Date.now() - startTime;
    throwSuccess("Successfully organized " + root.length + " behavior trees - " + writes + " writes (" + deltatime + "ms)");
  }
  
  // load BPList Parser from the internet
async function loadBPListParser() {
  return new Promise(async function(resolve) {
    console.info("Started loading plugin")
    let location = "https://raw.githubusercontent.com/RXCodes/hyperPad-Project-Modder/main/BPListParser.js";
    let data = await fetch(location);
    data = await data.text();
    try {
      eval(data);
      console.debug("Loaded plugin")
    } catch(e) {
      console.error(e);
	}
    resolve();
  });
}
  
  // open menu force
  function menu(id) {
    hideIds.forEach(function(id) {
    try {
      document.getElementById(id).style.display = "none";
    } catch(e) {};
    });
    document.getElementById(id).style.display = "block";
  }
  
  // inspect behavior
  async function inspectBehavior(ID) {
    prevMenu = "behaviorEntries"
    hideIds.forEach(function(id) {
    try {
      document.getElementById(id).style.display = "none";
    } catch(e) {};
    });
    document.getElementById("behaviorInspector").style.display = "block";
    document.getElementById("behaviorID").innerHTML = ID;
    document.getElementById("behaviorData").innerHTML = "Loading...";
    let index = db.exec("select * from zbehaviourdata where ztag = " + JSON.stringify(ID))[0];
    let dict = {};
    let i = 0;
    index.columns.forEach(function(key) {
      dict[key] = index.values[0][i];
      i++;
    });
    
    let s = "<b style='color:#6abfff; text-decoration-line: underline;'>ZBEHAVIOURDATA</b><br>";                    
    
    // iterate through dictionary
    Object.keys(dict).forEach(function(key) {
      if (key == "ZACTIONS" || key == "ZGROUPS") {
        return;
      }
      s += "<b style='color:#00bb78'>";
      s += key + ": ";
      s += "</b>";
      s += dict[key];
      s +="<br>"
    });
	s += "<br>";
    
    // zactions
    try {
    let zactions = await extract(Buffer.from(dict.ZACTIONS));
    s += "<b style='color:#ff7974; text-decoration-line: underline;'>ZACTIONS</b><br>";                    
    Object.keys(zactions).forEach(function(key) {
      s += "<b style='color:#00bb78'>";
      s += key + ": ";
      s += "</b>";
      let l = zactions[key];
      if (typeof l == "object") {
        l = JSON.stringify(l)
        if (zactions[key].value !== undefined && zactions[key].controlledBy !== undefined) {
          l = "<span style='color:#bcbcbc'>[Input Field] </span>" + zactions[key].value;
          if (zactions[key].secured) {
            l = "<b style='color:#ff7974;'>SECURED VALUE</b><br>"
          } else {
            l += "<br>";
            l += "— <b style='color:#fffd98'>Type: </b>" + zactions[key].type + "<br>"
            l += "— <b style='color:#ffd08e'>Controlled By: </b>" + zactions[key].controlledBy + "<br>"
            l += "— <b style='color:#a3ffa7'>Value Key: </b>" + zactions[key].valueKey
          }
        }
      }
      if (l === "") {
        l = "<i style='color:#ff7974;'>(blank)</i>"
      }
      s += l;
      s +="<br>"
    });
	s += "<br>";
    } catch(e) {}
    
    // zgroups
    try {
      console.log(dict.ZGROUPS)
    let zgroups = await extract(Buffer.from(dict.ZGROUPS));
    s += "<b style='color:#ff6de7; text-decoration-line: underline;'>ZGROUPS</b><br>";
    if (zgroups.success == false) {
      s += "Cannot load ZGROUPS data.";
    } else {
    Object.keys(zgroups).forEach(function(key) {
      s += "<b style='color:#00bb78'>";
      s += key + ": ";
      s += "</b>";
      s += zgroups[key];
      s +="<br>"
    });
	s += "<br>";
    }
    } catch(e) {};
    
    document.getElementById("behaviorData").innerHTML = s;
  }
  
  // view matched behavior entries
  async function behaviorEntries() {
    try {
  let results = [];
      
      let load = function() {let entryCount = results.length;
  let fileHeader = entryCount + " entries";
  document.getElementById("behaviorList").innerHTML = "Error loading entries.";
  document.getElementById("behaviorEntryText").innerHTML = fileHeader;
  hideIds.forEach(function(id) {
    try {
      document.getElementById(id).style.display = "none";
    } catch(e) {};
  });
  document.getElementById("behaviorEntries").style.display = "block";  
  let o = "";
  prevMenu = "modifyBehaviorData";
  results.forEach(function(entry) {
    
    let activeText = "[OFF]";
    if (entry[3]) {
      activeText = "[ON]";
    }
    o += "<span style='color: #c2c2c2'>" + entry[2] + ": </span>";
    o += "<b style='color: #00bb78'>" + entry[0] + "</b><br>";
    o += "<span style='color: #999'> (" + entry[4];
    o += ") </span>"
    o += "<span style='color: #88dbe3'>" + activeText;
    o += "</span>" + "<span style='color: #999'> (" + Object.keys(entry[5]).length;
    o += " Keys) </span>";
    o += "<br>";
    o += entry[1] + "<br>";
    o += "<a style='color: #edd465' onclick='inspectBehavior(\"";
    o += entry[1] + "\",\"" + entry[0] + "\")'> [Inspect Behavior] </a>";
    o += "<a style='color: #ff6060' onclick='editBehaviors(\"";
    o += entry[1] + "\")'> [Actions] </a> <br>";
    o += "<br>";
  })
    console.log(o)
  document.getElementById("behaviorList").innerHTML = o;}
    
  let multiple = document.getElementById("searchInObject").checked;
  console.log(multiple)
  if (multiple) {
    let obj = document.getElementById("objectBehaviorSearch");
    let num = db.exec("select z_pk from zobjectdata where zname = " + JSON.stringify(obj.objectName))[0].values[0][0];
    let data = db.exec("select zactions, ztag, zname from zbehaviourdata where zobject = " + num)[0].values
    let current = 0;
    let count = data.length;
    data.forEach(async function(data) {
      let behavior = await extract(Buffer.from(data[0]));
      results.push([behavior.alias, data[1], behavior.behaviourCategory, behavior.active, data[2], behavior]);
      current++;
      if (current == count) {
        load();
      }
    })
    
  } else {
    let behavior = document.getElementById("BehaviorSearch");
    let b = db.exec("select zactions, zname from zbehaviourdata where ztag = " + JSON.stringify(behavior.uuid))[0].values[0];
    let data = await extract(Buffer.from(b[0]));
    console.log(JSON.stringify(data))
    results.push([data.alias, behavior.uuid, data.behaviourCategory, data.active, b[1], data])
    load();
  }
    
  
    } catch(e) {
      throwError("Failed to load behaviors: object did not contain behaviors.")
      console.error(e);
    }
}
  
  // behavior names
  var behaviorNames = [];
  var behaviorData = {};
  
  function getBehaviors() {
  return new Promise(function(resolve) {
  behaviorData = {};
  behaviorNames = [];
  behaviorIDs = [];
  let data = db.exec("SELECT zactions, ztag from zbehaviourdata")[0].values;
  let count = data.length;
  let current = 0;
  console.log(count)
  data.forEach(async function(data) {
    let behavior = await extract(Buffer.from(data[0]));
    behaviorNames.push(behavior.alias);
    behaviorIDs.push(data[1]);
    behaviorData[behavior.alias] = behavior;
    behaviorData[data[1]] = behavior;
  	current++;
    if (current == count) {
      resolve();
    }
  })
  });

  }

// intialize the program
loadBPListParser();
  
  async function modifyBehaviors() {
    hideIds.forEach(function(id) {
    try {
      document.getElementById(id).style.display = "none";
    } catch(e) {};
    });
    document.getElementById("modifyBehaviorData").style.display = "block";
    prevMenu = "behaviorOption"
    await wait(0.1);
    await getBehaviors();
  }
  
  // behaviors to text
  function execConvertBehaviors() {
    throwSuccess("Starting process");
    let objs = db.exec("select ztag, zactions from zbehaviourdata")[0];
    throwSuccess("Creating " + objs.values.length + " files");
    var seperator = "";
    if (document.getElementById("beautifyBehaviorJSON").checked) {
      seperator = "\t";
    }
    objs.values.forEach(async function(obj) {
      
      let content = obj[1];
      let ext = ".txt";
      if (document.getElementById("convertBehaviorsToJSON").checked) {
        content = JSON.stringify(await extract(Buffer.from(obj[1])), null, seperator);
        ext = ".json";
      }
      
      project.file("Behaviors/" + obj[0] + ext, content)
      console.info(obj[0])
    });
    throwSuccess("Successfully created " + objs.values.length + " files");
  }
  
  function convertBehaviors() {
    prevMenu = "projectData"
    alertPopup("Convert Objects", "This will create a file for every single behavior found in the project - each file will contain the object's internal behavior data. The files will be stored in <b>Behaviors/</b>.", execConvertBehaviors);
  }
  
  
  // objects to text
  function execConvertObjects() {
    throwSuccess("Starting process");
    var seperator = "";
    if (document.getElementById("beautifyObjectJSON").checked) {
      seperator = "\t";
    }
    let objs = db.exec("select zname, ZGAMEOBJECTDATA from zobjectdata")[0];
    throwSuccess("Creating " + objs.values.length + " files");
    objs.values.forEach(async function(obj) {
      
      let content = obj[1];
      let ext = ".txt";
      if (document.getElementById("convertObjectsToJSON").checked) {
        content = JSON.stringify(await extract(Buffer.from(obj[1])), null, seperator);
        ext = ".json";
      }
      
      project.file("Objects/" + obj[0] + ext, content)
      console.info(obj[0])
    });
    throwSuccess("Successfully created " + objs.values.length + " files");
  }
  
  function convertObjects() {
    prevMenu = "projectData"
    alertPopup("Convert Objects", "This will create a file for every single object found in the project - each file will contain the object's internal object data. The files will be stored in <b>Objects/</b>.", execConvertObjects);
  }
  
  // patches
  var executePatch = function() {};
  async function patchProject() {
    hideIds.forEach(function(id) {
    try {
      document.getElementById(id).style.display = "none";
    } catch(e) {};
    });
    document.getElementById("patchProject").style.display = "block";
    document.getElementById("patchList").innerHTML = "<p id='patchFixText'>Downloading patches...</p><br><div class='lds-ring2'><div></div><div></div><div></div><div></div></div>";
    document.getElementById("patchFixText").innerHTML = "Downloading patches...";
    document.getElementById("execPatch").style["background-color"] = "grey";
    executePatch = function() {};
    await wait(0.1)
    try {
      
      // load script
      let script = await fetch("https://raw.githubusercontent.com/RXCodes/hyperPad-Project-Modder/main/patches.js");
      script = await script.text();
      console.log(script)
      
      // eval
      let go = true;
      try {
      script = eval(script);
      } catch(e) {
        throwError("Failed to download patch or patch failed to execute: " + e)
        go = false;
      }
      
      if (!go) {
        return;
      }
      
      await diagnose();
      await wait(0.5);
      
      if (commands.length == 0) {
        document.getElementById("execPatch").style["background-color"] = "grey";
      } else {
        document.getElementById("execPatch").style["background-color"] = "#2896ff";
        executePatch = function() {
          let count = 0;
          let errors = 0;
          document.getElementById("execPatch").style["background-color"] = "grey";
          executePatch = function() {};
          this.commands.forEach(function(cmd) {
            count++;
            try {
              db.run(cmd);
            } catch(e) {
              console.log(e);
              errors++;
            };
          });
  		throwSuccess("PATCHED - Successfully executed " + (count - errors) + " out of " + count + " modifications");
        }
      }
      
      console.log(patches)
      let diagCount = 0;
      let total = 0;
      Object.keys(patches).forEach(function(patch) {
        total++;
        if (patches[patch]) {
          diagCount++;
        }
      })
      document.getElementById("patchList").innerHTML = "<p>Scanned for " + total + " known vulnerabilities - Found " + diagCount + "</p>";
      document.getElementById("patchList").innerHTML += "<div id='vList'>"
      
      // enter diagnosis
      let vList = ""
      Object.keys(patches).forEach(function(patch) {
        let arr = ["<p style='text-align: left; color:#808080'>", patch, ": ", "<span"]
        if (patches[patch]) {
          arr.push(" style='color: #ff6060; text-align: left'>DIAGNOSED")
        } else {
          arr.push(" style='color: #00bb78; text-align: left'>NOT FOUND");
        }
        arr.push("</span>")
        arr.push("</p>")
        vList += arr.join("");
      });
      
      document.getElementById("patchList").innerHTML += vList;
      document.getElementById("patchList").innerHTML += "</div>"
      
      console.log(commands)
      
    } catch(e) {
      throwError("Failed to execute patch: " + e + "<br>")
    }
  }
  
  // import plugin
  var pluginSelector = document.getElementById("pluginImporter");
  pluginSelector.addEventListener('change', async (event) => {
    let file = event.target.files[0];
    throwSuccess("Importing plugin...")
    await wait(0.1);
    let text = await file.text();
    let arr = text.split("-hyperPadPlugin-");
    if (arr.length == 1) {
      return throwError("Provided file is not a plugin");
    }
    if (arr[0].length !== parseInt(arr[1])) {
      return throwError("Plugin file is corrupted or has been tampered with")
    }
    let json;
    
    // for older plugins
    let error = "";
    let eCount = 0;
    try {
      json = JSON.parse(atob(arr[0]));
    } catch(e) {
      eCount++;
      error = "Failed to parse outdated file: " + e;
    }
    
    // for newer plugins
    try {
      json = JSON.parse(decodeURIComponent(escape(atob(arr[0]))));
    } catch(e) {
      eCount++;
      error = "Failed to parse file: " + e;
    }
    
    if (eCount == 2) {
      return throwError(error);
    }
    
    if (!json.isPlugin) {
      return throwError("Provided file is not a hyperPad plugin")
    }
    console.log(json)
    plugin = json;
    
    hideIds.forEach(function(id) {
      try {
        document.getElementById(id).style.display = "none";
      } catch(e) {};
    });
    document.getElementById("importPlugin").style.display = "block";
    
    // display data
    document.getElementById("pluginIconView").src = json.icon;
    document.getElementById("pluginNameView").innerHTML = json.name;
    document.getElementById("PluginDescriptionView").value = json.description;
  
    let set = "<b style='color:#00bb78'>Status: </b>";
    let status = "<b style='color:#6ffffa'>Open Source</b>"
    if (json.closedSource) {
      status = "<b style='color:#ff5c5c'>Closed Source</b>"
    }
    set += status + "<br>"
    set += "<b style='color:#00bb78'>Behavior Count: </b>";
    set += json.behaviorCount + "<br>";
    set += "<b style='color:#00bb78'>Object Count: </b>";
    set += json.objects.length + "<br>";
    set += "<b style='color:#00bb78'>Assets Count: </b>";
    set += (json.assetsCount || 0) + "<br>";
    set += "<b style='color:#00bb78'>Creation Date: </b>";
    let date = new Date(json.creationDate);
    set += date.getMonth() + "-" + date.getDate() + "-" + date.getFullYear();
    document.getElementById("pluginInfo").innerHTML = set;
    
    throwSuccess("Successfully loaded plugin data")
  }); 
  
  // import plugin icon
  var iconSelector = document.getElementById("icon-selector");
  iconSelector.addEventListener('change', async (event) => {
    let file = event.target.files[0];
    let img = await file.arrayBuffer();
    var binary = '';
    var bytes = new Uint8Array(img)
    var len = bytes.byteLength;
    for (var i = 0; i < len; i++) {
        binary += String.fromCharCode( bytes[ i ] );
    }
    img = window.btoa( binary );
    document.getElementById("pluginIcon").src = "data:image/png;base64," + img;
  }); 
  
  var pass = ""
  const appear = [
    { transform: 'scale(0.05)', opacity: 0},
    { transform: 'scale(1)', opacity: 1}
  ]
  document.getElementById("importMenuWhole").animate(appear, {duration: 300, transition: "ease-out"});
  function returnToMain() {
    hideIds.forEach(function(id) {
      try {
        document.getElementById(id).style.display = "none";
      } catch(e) {};
    });
    document.getElementById("importMenuWhole").style.display = "block";
    document.getElementById("errorMenu").style.display = "none";
    document.getElementById("importMenuWhole").animate(appear, {duration: 300, transition: "ease-out"});
  }
  
  const fileSelector = document.getElementById('file-selector');
  var project = new JSZip();
  var fileExist = {};
  var scenes = {};
  
  // file data
  var extensions = {};
  var ptm = 32;
  var file = "";
  var startTime = 0;
  fileSelector.addEventListener('change', (event) => {
    fileExist = {};
    startTime = Date.now();
    
    // Closure to capture the file information.
    function handleFile(f) {
		file = f;
      	scenes = {};
        var dateBefore = new Date();
        project.loadAsync(f)                                   // 1) read the Blob
        .then(function(zip) {
            var dateAfter = new Date();
            
            zip.forEach(function (relativePath, zipEntry) {  // 2) print entries
              fileExist[zipEntry.name] = true;
              extensions[zipEntry.name.split(".").pop()] = true;
              if (zipEntry.name.startsWith("levels/")) {
                console.info(zipEntry.name);
              }
            });
          
          onImport(dateAfter - dateBefore);
        }, function (e) {
            console.error(f.name + ": " + e.message);
        });
    }
    
    var files = event.target.files;
  	for (var i = 0; i < files.length; i++) {
      handleFile(files[i]);
  	}
    
    function onImport(time) {
      
      let fileName = fileSelector.files[0].name;
      let size = (Math.round((fileSelector.files[0].size) / 100000) / 10) + "MB";
      time = time + "ms";
      // throwSuccess("Imported Project (" + time + ") - Now Processing...");
      document.getElementById("importMenuWhole").style.display = "none";
      document.getElementById("importLoading").style.display = "block";
      console.info(fileName, size, time);
      
      // validation
      let success = true;
      
      function check(file) {
        if (!fileExist[file]) {
          success = false;
          console.error(file);
        }
      }
      check("gameDetails.plist");
      check("levels/Level 1/Level.sqlite")
      
      // success?
      if (success) {
        
        var gameDetails = "";
        
        function getKey(content, key) {
          let first = content.split("<key>" + key + "</key>")[1];
          let second = first.split("<string>")[1];
          let third = second.split("</string>")[0];
          return third;
        }
        
		project.file("gameDetails.plist").async("string")
		  .then(function(content) {
          	gameDetails = content;
            ptm = getKey(content, "ptmRatio");
            document.getElementById("projectName").innerHTML = getKey(content, "gameName");
          	
          let fileHeader = fileName + 
 "<b style='color:#989898'> (" + size + ")</b>";
          document.getElementById("fileName").innerHTML = fileHeader;
          document.getElementById("fileName2").innerHTML = fileHeader;
          document.getElementById("fileName3").innerHTML = fileHeader;
          document.getElementById("fileName4").innerHTML = fileHeader;
          document.getElementById("fileName5").innerHTML = fileHeader;
          document.getElementById("fileName6").innerHTML = fileHeader;
          document.getElementById("fileName7").innerHTML = fileHeader;
          document.getElementById("fileName8").innerHTML = fileHeader;
          document.getElementById("fileName9").innerHTML = fileHeader;
          document.getElementById("fileName10").innerHTML = fileHeader;
          document.getElementById("fileName11").innerHTML = fileHeader;
          document.getElementById("fileName12").innerHTML = fileHeader;
          document.getElementById("fileName13").innerHTML = fileHeader;
          document.getElementById("fileName14").innerHTML = fileHeader;
          document.getElementById("fileName15").innerHTML = fileHeader;
          document.getElementById("fileName16").innerHTML = fileHeader;
          document.getElementById("fileName17").innerHTML = fileHeader;
          document.getElementById("fileName18").innerHTML = fileHeader;
          document.getElementById("fileName19").innerHTML = fileHeader;
          document.getElementById("fileName20").innerHTML = fileHeader;
          document.getElementById("fileName21").innerHTML = fileHeader;
          document.getElementById("fileName22").innerHTML = fileHeader;
          document.getElementById("fileName23").innerHTML = fileHeader;
          document.getElementById("fileName24").innerHTML = fileHeader;
		});
        
        project.file("levels/Level 1/Level.sqlite").async("uint8array")
          .then(function(content) {
            hideAlert()
            console.log("loaded");
        	
          let err = false;
            db = new SQL.Database(content);
          document.getElementById("projectViewer").style.display = "block";
          document.getElementById("importLoading").style.display = "none";
          document.getElementById("projectViewer").animate(appear, {duration: 300, transition: "ease-out"});
          console.info("loaded sqlite")
          
            try {
              let o = db.exec("select * from lock");
              if (o.length > 0) {
                document.getElementById("projectViewer").style.display = "none";
                enforceLockdown();
                return;
              }
            } catch(e) {};
          try {
              let o = db.exec("select value from password");
              if (o.length > 0) {
                document.getElementById("projectViewer").style.display = "none";
                throwError("This project requires a password");
                pass = o[0].values[0];
                checkPass();
                
              }
            } catch(e) {console.error(e)}
        });
        
        let entries = Object.keys(fileExist);
        getBehaviors();
        
      } else {
        document.getElementById("importLoading").style.display = "none";
        document.getElementById("errorMenu").style.display = "block";
        console.error("Failed to import");
      }
    }
    
  });
</script>

<script>
  
  var blobFile;
  async function finish() {
    try {
          console.log("finish");
          let compileError = false;
    	  try {
            project.file("levels/Level 1/Level.sqlite", db.export());
          } catch(e) {
            throwError("Failed to compile project, please try again");
            compileError = true;
            exitMenu();
          }
          if (compileError) {
            return;
          }
          document.getElementById("download").innerHTML = "Download";
          document.getElementById("loading").style.display = "block";
          document.getElementById("download").style.display = "none";
    	  document.getElementById("projectOptions").style.display = "none";
    	  document.getElementById("downloadBack").style.display = "none";
          document.getElementById("loading").style.display = "block";
          document.getElementById("icon").style.display = "none";
          project.file("icon@2x.png").async("base64")
          .then(function(content) {
            document.getElementById("iconImg").src = "data:image/png;base64," + content;
            document.getElementById("iconImg").style.display = "block";
          });
          console.log(extensions);
      	  console.log(JSON.stringify(project.generateAsync({type: "blob"})))
      	  let fileName = document.getElementById("currentFile");
          let percentage = document.getElementById("processTooltip");
          let progress = document.getElementById("progress");
      	  let s = 0;
          let ct = document.getElementById("compileTime");
          let et = document.getElementById("estimatedTimeLeft");
          ct.innerHTML = "0m 0s";
          et.innerHTML = "Time Left: -";
          percentage.innerHTML = "0%";
          et.style.color = '#bbb';
          progress.style.width = 0;
          let progressTrack = 0;
          let st = Date.now();
          let timer = setInterval(function() {
            let time = Math.round((Date.now() - st) / 1000);
            let s = time % 60;
            let m = Math.floor(time / 60);
            ct.innerHTML = m + 'm ' + s + "s";
            let avg = progressTrack / time;
            let est = Math.round((100 - progressTrack)/ avg);
            let es = est % 60;
            let em = Math.floor(est / 60);
            et.innerHTML = "Time Left: " + em + "m " + es + "s";
            if (isNaN(est)) {
              et.innerHTML = "Starting Process..."
            }
          }, 100)
    	  project.generateAsync({type : "uint8array"}, function(onUpdate) {
            
            // on update
            let e = "<b style=\"color:#00bb78\">";
            e += "Processing File:</b><br>";
            e += onUpdate.currentFile || "Completing Process...";
            fileName.innerHTML = e;
            s += 1;
            progressTrack = onUpdate.percent;
            percentage.innerHTML = Math.round(onUpdate.percent) + "% (" + s + " updates)";
            progress.style.width = onUpdate.percent + "%";

          })
            .then(function (file) {
            clearTimeout(timer);
            document.getElementById("loading").style.display = "none";
            document.getElementById("download").style.display = "block";
            document.getElementById("icon").style.display = "block";
            document.getElementById("downloadBack").style.display = "block";
            console.log("project download")
            blobFile = file;
          });
    
        } catch(e) {console.log(e)}
  }
        
</script>

<script>
var results;
var plugin;
const version = "0.11";
const versionSuffix = "beta";
document.getElementById("versionText").innerHTML = "v" + version + " " + versionSuffix;
document.getElementById("versionHighlight").innerHTML = "v" + version + " " + versionSuffix;
var whereQuery;
var prevMenu;
var hideIds = ["projectData", "errorMenu", "icon", "download", "downloadBack", "sceneEditor", "sceneSelector", "objectSelector", "objectEntries", "objectEditor", "behaviorOption", "downgradeBehaviors", "deleteGlobalBehaviors", "hideBehaviors", "transferBehaviors", "importMenuWhole", "lockProject", "projectLocked", "enterPassword", "setPassword", "downloadFiles", "alertBox", "downloadingFiles", "projectViewer", "managePlugins", "exportPlugin", "importPlugin", "compilingPlugin", "behaviorEntries", "behaviorEditor", "behaviorInspector", "modifyBehaviorData", "patchProject", "deleteBehaviorTree"];
  
let changelogs = [
  {
    name: "Modify Behaviors",
    description: "You can now inspect and modify behavior's internal data. You can either search a single behavior by name or search behaviors by object."
  },
  {
    name: "Added Behavior Modifications",
    description: "You can now organize all behavior trees within a project, so your behaviors will be arranged in a grid-like formation. You can also delete behavior trees."
  },
  {
    name: "Improvements",
    description: "Fixed behaviors' output value showing only one behavior ID. Some visual changes to buttons."
  }
]
let changelogIn = "";
changelogs.forEach(function(dict) {
  let name = dict.name;
  let desc = dict.description;
  let add = "<p style='text-align:left'><span style='color: grey'>• </span>";
  add += "<b style='color:#00bb78'>" + name + "</b>";
  add += "<span style='color:#bbb'>: </span>"
  add += desc + "</p>";
  changelogIn += add + "<br>"
})
document.getElementById("changelogList").innerHTML = changelogIn;  

function obfuscateName() {
    let result           = '';
    let characters       = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz01234567899';
    let charactersLength = characters.length;
    for ( var i = 0; i < 30; i++ ) {
      result += characters.charAt(Math.floor(Math.random() * 
 charactersLength));
   }
   return result;
}  
  
document.getElementById("searchInObject").onchange = function(event) {
  console.log(event) 
  let checked = document.getElementById("searchInObject").checked;
  if (!checked) {
    document.getElementById("multipleBehaviors").style.display = "none";
    document.getElementById("selectBehavior").style.display = "block";
  } else {
    document.getElementById("multipleBehaviors").style.display = "block";
    document.getElementById("selectBehavior").style.display = "none";
  }
}
  
// plugin export settings
document.getElementById("selectMultiplePluginObjects").onchange = function(event) {
  let checked = document.getElementById("selectMultiplePluginObjects").checked;
  if (checked) {
    document.getElementById("targetSinglePluginObject").style.display = "none";
    document.getElementById("targetMultiplePluginObjects").style.display = "block";
  } else {
    document.getElementById("targetSinglePluginObject").style.display = "block";
    document.getElementById("targetMultiplePluginObjects").style.display = "none";
  }
}
  
document.getElementById("multiplePluginSelectionCount").objects = [];
document.getElementById("pluginPrefix").addEventListener("input", function() {
  let value = document.getElementById("pluginPrefix").value;
  if (value.length == 0) {
    document.getElementById("multiplePluginSelectionCount").objects = [];
    return document.getElementById("multiplePluginSelectionCount").innerHTML = "0 Objects Selected";
  }
  let search = "select zname from zobjectdata where zname like " + JSON.stringify(value + "%");
  let index = db.exec(search);
  if (index.length == 0) {
    document.getElementById("multiplePluginSelectionCount").objects = [];
    return document.getElementById("multiplePluginSelectionCount").innerHTML = "0 Objects Selected";
  }
  document.getElementById("multiplePluginSelectionCount").innerHTML = index[0].values.length + " Objects Selected";
  if (index[0].values.length == 1) {
    document.getElementById("multiplePluginSelectionCount").innerHTML = "1 Object Selected";
  }
  document.getElementById("multiplePluginSelectionCount").objects = [];
  index[0].values.forEach(function(column) {
    document.getElementById("multiplePluginSelectionCount").objects.push(column[0])
  })
});
  
document.getElementById("hideAssets").onchange = function(event) {
  let checked = document.getElementById("hideAssets").checked;
  if (checked) {
    document.getElementById("AliasFolder").style.display = "block";
  } else {
    document.getElementById("AliasFolder").style.display = "none";
  }
}
  
  
document.getElementById("requireAssets").onchange = function(event) {
  let checked = document.getElementById("requireAssets").checked;
  if (checked) {
    document.getElementById("requireAssetsSelect").style.display = "block";
  } else {
    document.getElementById("requireAssetsSelect").style.display = "none";
  }
}
  
const assetUpdate = function() {
  let value = document.getElementById("assetsPrefix").value;
  if (value.length == 0) {
    document.getElementById("multipleAssetsCount").objects = [];
    return document.getElementById("multipleAssetsCount").innerHTML = "0 Assets Found";
  }
  let assets = 0;
  
  project.folder("Assets/" + value).forEach(function(path) {
    if (!path.endsWith(".metaData.plist")) {
      return;
    }
    assets++;
  })
  
  document.getElementById("multipleAssetsCount").innerHTML = assets + " Assets Found";
  if (assets == 1) {
    document.getElementById("multipleAssetsCount").innerHTML = "1 Asset Found";
  }
} 
document.getElementById("assetsPrefix").addEventListener("input", assetUpdate);
  
 async function importPlugin() {
   
   throwSuccess("Attempting to port objects...");
   let startTime = Date.now();
   await wait(0.1);
   
   // check if plugin already exists
   let tester = db.exec("select zobject from zbehaviourdata where ztag like " + JSON.stringify("Plugin/" + plugin.creationDate + "-%"))
   if (tester.length > 0) {
     return throwError("Provided plugin already exists in the project")
   }
   
   startPlaneAnimation();
    hideIds.forEach(function(id) {
    try {
      document.getElementById(id).style.display = "none";
    } catch(e) {};
    });
    document.getElementById("compilingPluginPercent").innerHTML = "0%";
    document.getElementById("compilingPlugin").style.display = "block";
   await wait(0.3)
   
   // find highest object zpk
   let ObjectZPK = 1;
   let index = db.exec("select z_pk from zobjectdata");
   try {
     index[0].values.forEach(function(z) {
       ObjectZPK = Math.max(z[0], ObjectZPK);
     })
   } catch(e) {console.error(e)}
   console.log("Highest Object ZPK: " + ObjectZPK);
   ObjectZPK++;
   
   // find highest object pos zpk
   let PosZPK = 1;
   index = db.exec("select z_pk from zobjectposition");
   try {
     index[0].values.forEach(function(z) {
       PosZPK = Math.max(z[0], PosZPK);
     })
   } catch(e) {console.error(e)}
   console.log("Highest Object Position ZPK: " + PosZPK);
   PosZPK++;
   
   // find highest behavior zpk
   let BehaviorZPK = 1;
   index = db.exec("select z_pk from zbehaviourdata");
   try {
     index[0].values.forEach(function(z) {
       BehaviorZPK = Math.max(z[0], BehaviorZPK);
     })
   } catch(e) {console.error(e)}
   console.log("Highest Behavior ZPK: " + BehaviorZPK);
   BehaviorZPK++;
   
   // get plugin objects
   let objects = plugin.objects; 
   let writes = 0;
   
   let error = false;
   
   function sanitizeArray(arr) {
     let i = -1;
     arr.forEach(function(value) {
       i++;
       if (value == null) {
         return;
       }
       if (typeof value == "object") {
         
         arr[i] = JSON.stringify(value)
         
         // check if normal dictionary or blob
         if (value.hasOwnProperty("0") && value.hasOwnProperty("1") && value.hasOwnProperty("2")) {
           let uint = [];
           let it = true;
           let z = 0;
           while (it) {
             if (value[z] == undefined) {
               it = false;
             } else {
               uint.push(value[z])
             }
             z++;
           }
           arr[i] = new Uint8Array(uint)
           // console.log(arr[i].byteLength)
         }
         
       }
     })
   }
   
   await wait(0.3);
   let bColumns = db.exec("select * from zbehaviourdata limit 1")[0].columns;
   let oColumns = db.exec("select * from zobjectdata limit 1")[0].columns;
   let pColumns = db.exec("select * from zobjectposition limit 1")[0].columns;
   console.log("assetcolumns")
   let aColumns = db.exec("select * from zpathdata limit 1")[0].columns;
   console.log(aColumns)
   let ZLayer = 5;
   
   // try catch entire thing
   let promise = new Promise(async function(resolve) {
  try {
     
   let processedObjs = 0;
   objects.forEach(function(obj) {
     BehaviorZPK++;
     ObjectZPK++;
     
     // extract and set object data
     console.log(obj)
     let statement;
   
     try {
       ZLayer = db.exec("select z_pk from zlayerdata where zindex = -1")[0].values[0][0];
     } catch(e) {}
     db.run("INSERT into Z_5Objects values(" + ZLayer + "," + ObjectZPK + ")");
     writes++;
     console.info("Created object ZPK: " + ObjectZPK)
     
     // prepare and execute statement for zobjectdata if any
     let zObjectData;
     try {
     zObjectData = obj.zobjectdata[0].values[0];
     console.log(zObjectData)
     zObjectData[oColumns.indexOf("Z_PK")] = ObjectZPK;
     statement = "INSERT INTO ZObjectData values(";
     for (a = 0; a < zObjectData.length; a++) {
       statement += "?,";
     }
     statement = statement.substring(0, statement.length - 1) + ")";
     if (plugin.obfuscateObjects) {
       zObjectData[oColumns.indexOf("ZNAME")] = obfuscateName();
     }
     
     sanitizeArray(zObjectData);
     let s = db.prepare(statement);
     s.bind(zObjectData);
     s.step();
     } catch(e) {console.error(e)}
     
     // prepare and execute statement for zobjectpos if any
     let zPosData;
     try {
     PosZPK++;
     zPosData = obj.zposdata[0].values[0];
     statement = "INSERT INTO ZObjectPosition values(";
     for (a = 0; a < pColumns.length; a++) {
       statement += "?,";
     }
     statement = statement.substring(0, statement.length - 1) + ")";
       
     if (plugin.closedSource) {
       zPosData[pColumns.indexOf("ZX")] = -999999999;
       zPosData[pColumns.indexOf("ZY")] = -999999999;
     } 
     zPosData[pColumns.indexOf("ZOBJECTS")] = ObjectZPK;    
     zPosData[pColumns.indexOf("ZLAYERS")] = ZLayer;
     zPosData[pColumns.indexOf("Z_PK")] = PosZPK;    
     sanitizeArray(zPosData);
     s = db.prepare(statement);
     s.bind(zPosData);
     s.step();
     
     writes++;
     } catch(e) {
       console.error(e)
       zPosData = [0, 9, 14, 0, 0, 0, 0, 0.5, 0.5, 0, 0];
       statement = "INSERT INTO ZObjectPosition values(";
       for (a = 0; a < pColumns.length; a++) {
         statement += "?,";
       }
       statement = statement.substring(0, statement.length - 1) + ")";

       if (plugin.closedSource) {
         zPosData[pColumns.indexOf("ZX")] = -999999999;
         zPosData[pColumns.indexOf("ZY")] = -999999999;
       } 
       zPosData[pColumns.indexOf("ZOBJECTS")] = ObjectZPK;    
       zPosData[pColumns.indexOf("ZLAYERS")] = ZLayer;
       zPosData[pColumns.indexOf("Z_PK")] = PosZPK;    
       sanitizeArray(zPosData);
       s = db.prepare(statement);
       s.bind(zPosData);
       s.step();
     }
     
     // extract and set behaviors if any
     let behaviors = [[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]] // 13 params
     
     try {
       behaviors = obj.zbehaviourdata[0].values;
       behaviors.forEach(async function(behavior) {
         BehaviorZPK++;
         try {
         behavior[bColumns.indexOf("Z_PK")] = BehaviorZPK;
         behavior[bColumns.indexOf("ZOBJECT")] = ObjectZPK;
       
         statement = "INSERT INTO ZBehaviourData values(";
         for (a = 0; a < behavior.length; a++) {
           statement += "?,";
         }
         statement = statement.substring(0, statement.length - 1) + ")";
         
         if (plugin.closedSource) {
           behavior[bColumns.indexOf("ZX_POS")] = -99999999;
           behavior[bColumns.indexOf("ZY_POS")] = -99999999;
         }
         
         sanitizeArray(behavior);
         s = db.prepare(statement);
         s.bind(behavior);
         s.step();
       
         
         } catch(e) {}
       writes++;
       })
     } catch(e) {}
     
     // create custom behavior for plugin
     BehaviorZPK++;
     try {
     if (obj.zbehaviourdata.length == 0) {
       obj.zbehaviourdata = db.exec("select * from zbehaviourdata limit 1")
     }
     let behavior = behaviors[0];
     statement = "INSERT INTO ZBehaviourData values(";
     for (a = 0; a < bColumns.length; a++) {
       statement += "?,";
     }
     statement = statement.substring(0, statement.length - 1) + ")";
     let installID = "Plugin/" + plugin.creationDate + "-" + Math.random()
     obj.zbehaviourdata[0].columns = bColumns;
     behavior[bColumns.indexOf("Z_PK")] = BehaviorZPK;
     behavior[bColumns.indexOf("ZOBJECT")] = ObjectZPK;
     behavior[bColumns.indexOf("ZNAME")] = "Comment";
     behavior[bColumns.indexOf("ZX_POS")] = -999999999;
     behavior[bColumns.indexOf("ZY_POS")] = -999999999;
     behavior[bColumns.indexOf("IS_ROOT")] = 0;
     behavior[bColumns.indexOf("ZTAG")] = installID;
     let pluginData = JSON.parse(JSON.stringify(plugin));
     delete pluginData.objects;
     behavior[obj.zbehaviourdata[0].columns.indexOf("ZBEHAVIOURDESCRIPTION")] = {
       plugin: pluginData,
       installDate: Date.now(),
       installID: installID
     };
     sanitizeArray(behavior);
     s = db.prepare(statement);
     s.bind(behavior);
     s.step();
     } catch(e) {
       console.error(e)
     }
     writes++;
     processedObjs++;
     
     let percent = Math.round((processedObjs / objects.length) * 50);
     percent += "%";
     document.getElementById("compilingPluginPercent").innerHTML = percent;
   });
     
   document.getElementById("compilingPluginPercent").innerHTML = "50%";
     
   // asset importer
   console.log("asset importer")
   let assetZPK = db.exec("select z_max from z_primarykey where z_name = \"PathData\"")[0].values[0][0];
   if (plugin.assetsCount) {
     
     console.log("AI")
     if (plugin.hideAssets) {
       let assetType = plugin.folderAliasType || "Graphic";
       assetType = assetType.trim();
       project.file("Assets/" + plugin.assetPath + "/.metaData.plist", '<?xml version="1.0" encoding="UTF-8"?> <!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"> <plist version="1.0"> <dict> <key>assetType</key> <string>' + assetType + '</string> </dict> </plist>');
       console.log("atob stuff")
       project.file("Assets/" + plugin.assetPath + "/.thumbnail.png", window.atob(plugin.icon.substr(22)), {binary: true});
       console.log("atob stuff2")
       
       assetZPK++;
       let row = [0, 9, 1, assetType, "Assets/" + plugin.assetPath, Math.random(), ""];
       let statement = "INSERT INTO ZPathData values(";
       for (a = 0; a < row.length; a++) {
         statement += "?,";
       }
       row[aColumns.indexOf("Z_PK")] = assetZPK;
       statement = statement.substring(0, statement.length - 1) + ")";
       sanitizeArray(row);
       let s = db.prepare(statement);
       s.bind(row);
       s.step();
       writes++;
     }
     
     // find highest asset ZPK
     console.log("Highest Asset ZPK: " + assetZPK);
     assetZPK++;
     
     // port data
     let hasAssetData = true;
     try {
     let data = plugin.assetData[0];
     data.values.forEach(function(row) {
       let statement = "INSERT INTO ZPathData values(";
       for (a = 0; a < row.length; a++) {
         statement += "?,";
       }
       row[data.columns.indexOf("Z_PK")] = assetZPK;
       statement = statement.substring(0, statement.length - 1) + ")";
       sanitizeArray(row);
       let s = db.prepare(statement);
       s.bind(row);
       s.step();
       writes++;
       assetZPK++;
     })
     
     db.run("update z_primarykey set z_max = " + assetZPK + " where z_name = " + JSON.stringify("PathData"));
     } catch(e) {
       hasAssetData = false;
     };
     
     // import assets
     let zip = new JSZip();
     await zip.loadAsync(plugin.assets, {base64: true})
     let count = 0;
     let done = 0;
     zip.forEach(async function(path) {
       count++;
     });
     zip.forEach(async function(path) {
       let newPath = path;
       if (plugin.hideAssetsFromFile) {
         if (!newPath.endsWith(".plist")) {
           if (newPath.split(".").length > 1) {
             newPath = ".asset." + newPath.split(".").pop();
             console.log(newPath)
           }
         }
       }
       project.file("Assets/" + plugin.assetPath + "/" + newPath, await zip.file(path).async("blob"));
       done++;
       let p = 50 + Math.round((done / count) * 50);
       document.getElementById("compilingPluginPercent").innerHTML = p + "%";
       
     });
     
   } 
     
   // bump up z_max
   db.run("update z_primarykey set z_max = " + BehaviorZPK + " where z_name = " + JSON.stringify("BehaviourData"));
   db.run("update z_primarykey set z_max = " + ObjectZPK + " where z_name = " + JSON.stringify("ObjectData"));
   db.run("update z_primarykey set z_max = " + PosZPK + " where z_name = " + JSON.stringify("ObjectPosition"));
   resolve(); 
     
  } catch(e) {
     error = true;
     throwError("Error porting plugin object(s): " + e);
     managePlugins();
     resolve();
   }
     
   });
   if (error) {
     return;
   }
   await wait(0.5)
   document.getElementById("compilingPluginPercent").innerHTML = "100%";
   await wait(0.5);
   let delta = Date.now() - startTime;
   throwSuccess("Successfully installed plugin - " + writes + " writes (" + (delta / 1000) + "s)");
   managePlugins();
 }
  
  function managePlugins() {
  clearInterval(planeAnimation);
  hideIds.forEach(function(id) {
    try {
      document.getElementById(id).style.display = "none";
    } catch(e) {};
  });
  document.getElementById("managePlugins").style.display = "block";
    
  // folders
  try {
  let folders = "";
  let dirs = {};
  project.folder("Assets/").forEach(function(path, file) {
    
    if (path.split("/").length > 2) {   
      
      let dir = path.split("/");
      dir.pop();
      dir.pop();
      dirs[dir.join("/")] = true;
      
      for (i = 0; i < dir.length; i++) {
        dir.pop();
        dirs[dir.join("/")] = true;
      }
     
    }
  });
  dirs = Object.keys(dirs).sort();
  dirs.forEach(function(dir) {
    if (dir.length == 0) {
      return;
    }
    folders += "<option value=" + JSON.stringify(dir) + ">";
    folders += dir;
    folders += "</option>";
  })
  document.getElementById("assetsPrefix").innerHTML = folders;
  assetUpdate();
  prevMenu = "managePlugins";
   
  let pluginCount = db.exec('select * from zbehaviourdata where ztag like "Plugin%"');
  let plugins = [];
  let pluginObjects = {};
  try {
    plugins = db.exec('select * from zbehaviourdata where ztag like "Plugin%"')[0];
  } catch(e) {};
  if (pluginCount.length == 0) {
    pluginCount = 0;
  } else {
    pluginCount = 0;
    plugins.values.forEach(function(plugin) {
      let data = JSON.parse(plugin[plugins.columns.indexOf("ZBEHAVIOURDESCRIPTION")]);
      pluginObjects[data.installID.split("-")[0]] = data;
      console.log(data);
    })
    pluginCount = Object.keys(pluginObjects).length;
  }
    
  if (pluginCount == 1) {
    document.getElementById("pluginCount").innerHTML = "1 plugin installed"
  } else {
    document.getElementById("pluginCount").innerHTML = pluginCount + " plugins installed"
  }
  document.getElementById("pluginCount").innerHTML += "<br><i style='color:#bbb'>(Tap on a Plugin Icon to Delete)</i>"

  document.getElementById("plugins").innerHTML = "";
  if (pluginCount >= 1) {
    let str = "";
    Object.keys(pluginObjects).forEach(function(object) {
      let data = pluginObjects[object];
      str += "<div style='margin-bottom: 5px'>"
      
      // plugin icon
      str += "<img style=' width: 100px; height: 100px; border-radius: 10px; float:left; background-color:#444; position:static; margin-right: 5px' src='"
      str += data.plugin.icon + "'";
      let s = JSON.stringify('color:#00bb78');
      str += " onclick=\"alertPopup('Delete Plugin', 'Are you sure you want to delete <b class=\\\'green\\\'>";
      str += data.plugin.name + "</b>? You can always install the plugin back."
      str += "', deletePlugin); targetDeletePlugin = '" + data.installID + "'\">"; 
      
      // plugin info
      str += "<p style='color:#00bb78; font-weight:bold; font-size: 17px; float: left'>";
      str += data.plugin.name;
      str += "</p>"
      let date = new Date(data.installDate);
      date = date.getMonth() + "-" + date.getDate() + "-" + date.getFullYear();
      str += "<p style='float:left'>Installed on " + date + "</p>"
      str += "<div style='margin-bottom: 5px; background-color:#444; width: calc(100% - 105px); height: 60px; overflow: scroll; float: left; border-radius: 10px'>"
      str += "<p>" + data.plugin.description + "</p>";
      str += "</div>";
    })
    document.getElementById("plugins").innerHTML = str;
    // console.log(str)
  }
  } catch(e) {
    throwError("Internal error: failed to load plugins")
  }
 
}  
  
  var targetDeletePlugin;
  function deletePlugin() {
    console.log(targetDeletePlugin);
    
    // find object ZPK
    try {
      
    targetDeletePlugin = targetDeletePlugin.split("-")[0];
    let ZPK = db.exec("select zobject from zbehaviourdata where ztag like " + JSON.stringify(targetDeletePlugin + "%"));
    if (ZPK.length == 0) {
      return throwError("Could not find plugin object - please delete the object manually in the project")
    }
    
    ZPK = ZPK[0].values
    
    ZPK.forEach(function(row) {
      // delete object data and pos
      let id = row[0];
      db.run("delete from zobjectdata where z_pk = " + id);
      db.run("delete from zobjectposition where zobjects = " + id);
      db.run("delete from z_5objects where z_7objects = " + id);

      // delete behaviors
      db.run("delete from zbehaviourdata where zobject = " + id);
    });
    throwSuccess("Successfully removed plugin from project");
    managePlugins();
    } catch(e) {
      throwError("Error removing plugin: " +  e);
      managePlugins();
    }
    
  }
  
  var planeAnimation;
  function planeImgLoad() {
    console.log("loaded plane")
  }
  
  function newSmokeCloud() {
    var img = document.createElement('img');
    img.src = "https://firebasestorage.googleapis.com/v0/b/hyperpad-discord-marketplace.appspot.com/o/animations%2Fplane%2F176A2255-38AA-4880-8D18-E20511FD675F.png?alt=media&token=2311b803-97c7-41c6-bc71-f7d63d4a8f7b";
    document.getElementById('planeAnimScreen').appendChild(img);
    let size = 15 + (Math.random() * 10);
    let rot = Math.random() * 360;
    size += "px";
    img.style.width = size;
    img.style.height = size;
    img.classList.add("smoke");
    img.style.position = "absolute"
    let botP = 200 + (Math.random() * 12.5);
    botP += "px";
    img.style.bottom = botP;
    img.style.display = "block";
    img.style["margin-left"] = "140px";
    img.leftPixels = 140;
    img.style["z-index"] = 1;
    img.style.transform = "rotate(" + rot + "deg)";
    img.rot = rot;
    img.rotvel = (Math.random() - 0.5) * 10;
    
  }
  
  function startPlaneAnimation() {
    
    let planeID = 0;
    let plane = document.getElementById("plane");
    plane.style.position = "relative"
    plane.style.width = "75px";
    plane.style.height = "75px";
    plane.style.bottom = "-25px";
    plane.style["z-index"] = 2;
    plane.style["margin-left"] = "calc(50% - 40px)";
    
    plane.src = plane1;
    planeAnimation = setInterval(function() {
      
      if (Math.random() < 0.15) {
        newSmokeCloud();
      }
      
      document.querySelectorAll('.smoke').forEach(function(smoke) {
        if (smoke.leftPixels < 0) {
          smoke.style.opacity = 1 - (Math.abs(smoke.leftPixels / 50))
        }
        if (smoke.leftPixels < -50) {
          return smoke.remove();
        }
        smoke.rot += smoke.rotvel;
        smoke.style.transform = "rotate(" + smoke.rot + "deg)";
		smoke.leftPixels -= 3;
        smoke.style["margin-left"] = smoke.leftPixels + "px";
      });
      
      planeID++;
      switch(planeID) {
        case 1:
          plane.src = plane1;
          break;
        case 2:
          plane.src = plane2;
          break;
        case 3:
          plane.src = plane3;
          break;
        case 4:
          plane.src = plane2;
          planeID = 0
          break;
      }
      
    }, 10)
    
  }
  

  
  async function downloadPlugin() {
 
    try {
    let name = document.getElementById("PluginName").value;
    let desc = document.getElementById("PluginDescription").value;
    desc.trim();
    
    if (name.length == 0) {
      return throwError("Plugin name cannot be blank")
    }
    
    if (desc.length == 0) {
      desc = "No description provided."
    }
    
    if (name.length < 4) {
      return throwError("Plugin name is too short - 4 characters minimum")
    }
    
    if (name.length > 30) {
      return throwError("Plugin name is too long - 30 characters limit")
    }
    
    if (desc.length > 1000) {
      return throwError("Description is too long - 1,000 character limit")
    }
    let objs = [];
    let closedSource = document.getElementById("closedSource").checked;
    let multiple = document.getElementById("selectMultiplePluginObjects").checked
    let behaviors = 0;
    
    startPlaneAnimation();
    hideIds.forEach(function(id) {
    try {
      document.getElementById(id).style.display = "none";
    } catch(e) {};
    });
    document.getElementById("compilingPluginPercent").innerHTML = "0%";
    document.getElementById("compilingPlugin").style.display = "block";
    await wait(0.1);
    
    if (!multiple) {
      
      // single selection
      let obj = document.getElementById("pluginObject").objectName;
      if (!obj) {
        exportPlugin();
        return throwError("Target plugin object was not provided")
      }

      // check for object
      let index = db.exec("select z_pk from zobjectdata where zname = " + JSON.stringify(obj));
      if (index.length == 0) {
        exportPlugin();
        return throwError("Specified object does not exist");
      } 
      let zpk = index[0].values[0][0];

      // get behaviors
      index = db.exec("select * from zbehaviourdata where zobject = " + zpk);
      if (index.length > 0) {
        behaviors += index[0].values.length; 
      }
      let objectdata = db.exec("select * from zobjectdata where z_pk = " + zpk);
      let posdata = db.exec("select * from zobjectposition where z_pk = " + zpk);
      objs.push({
        zbehaviourdata: index,
        zobjectdata: objectdata,
        zposdata: posdata
      })
      
    } else {
      
      // multiple selection
      let entries = document.getElementById("multiplePluginSelectionCount").objects;
      console.log(entries);
      if (entries.length == 0) {
        exportPlugin();
        return throwError("No objects selected - select at least one object to create the plugin")
      }
      
      let errorObjects = [];
      let processed = 0;
      entries.forEach(function(obj) {
        // check for object
        try {
        let index = db.exec("select z_pk from zobjectdata where zname = $obj", {
          '$obj': obj
        });

        if (index.length == 0) {
          return errorObjects.push(obj)
        } 
        let zpk = index[0].values[0][0];

        // get behaviors
        index = db.exec("select * from zbehaviourdata where zobject = " + zpk);
        if (index.length > 0) {
          behaviors += index[0].values.length; 
        }
        let objectdata = db.exec("select * from zobjectdata where z_pk = " + zpk);
        let posdata = db.exec("select * from zobjectposition where z_pk = " + zpk);
        objs.push({
          zbehaviourdata: index,
          zobjectdata: objectdata,
          zposdata: posdata
        })
        } catch(e) {
          console.log(e, obj)
        }
        
        document.getElementById("compilingPluginPercent").innerHTML = Math.round((processed / entries.length) * 50) + "%";
        processed++;
        
      });
      
      if (errorObjects.length > 0) {
        exportPlugin();
        return throwError(errorObjects.length + " out of " + entries.length + " objects selected does not exist")
      }
      
    }
    document.getElementById("compilingPluginPercent").innerHTML = "50%";
    await wait(0.05);
      
    // generate output
    let output = {
      name: name,
      description: desc,
      creationDate: Date.now(),
      icon: document.getElementById("pluginIcon").src,
      closedSource: closedSource,
      isPlugin: true,
      behaviorCount: behaviors,
      folderAliasType: document.getElementById("aliasFolderType").value,
      objects: objs
    }
    
    if (document.getElementById("obsfucateObjects").checked && multiple) {
      output.osfucateObjects = true;
    }
    
    console.log(output);
    
    // check if using assets
    if (document.getElementById("requireAssets").checked) {
      let folder = document.getElementById("assetsPrefix").value;
      output.assetPath = folder;
      output.assets = await project.folder("Assets/" + folder).generateAsync({type: "base64"}, function(onUpdate) {
        let percent = (50 + Math.round(onUpdate.percent / 2)) + "%";
        document.getElementById("compilingPluginPercent").innerHTML = percent;
      });
      let assets = 0;
      project.folder("Assets/" + folder).forEach(async function(path) {
        if (!path.endsWith(".metaData.plist")) {
          return;
        }
        assets++;
      })
      output.assetsCount = assets;
      
      if (document.getElementById("hideAssetsfromFiles").checked) {
        output.hideAssetsFromFile = true;
      }
      
      // copy data from zpathdata
      let index = db.exec("select * from zpathdata where zpath like " + JSON.stringify("Assets/" + folder + "%"));
      output.assetData = index;
      
      if (document.getElementById("hideAssets").checked) {
        output.hideAssets = true;
      }
    }
    
    document.getElementById("compilingPluginPercent").innerHTML = "100%";
    await wait(1);
    exportPlugin();
    await wait(0.1)
    output = btoa(unescape(encodeURIComponent(JSON.stringify(output))));
    output += "-hyperPadPlugin-" + output.length;
    downloadFile(output, name + ".plugin");
    throwSuccess("Successfully generated plugin file");     
      
    } catch(e) {
      exportPlugin();
      throwError("CRITICAL ERROR: " + e)
    }
  }
  
  
function resetIcon() {
    document.getElementById("pluginIcon").src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAAAXNSR0IArs4c6QAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAABAKADAAQAAAABAAABAAAAAABEIjhzAAAAHGlET1QAAAACAAAAAAAAAIAAAAAoAAAAgAAAAIAAAAdUdXXPCgAAByBJREFUeAHsnFGO5DYMRPfYudsebrK9iIGGI9sSRYqU6zUQ9IxbokrkYzX3I/Pr1+9/fviPHMCAKAMUXrTwGD9ffB8GMAAMAAaEGaD4wsVnCmAKwAAwABgQZoDiCxefCYAJAAPAAGBAmAGKL1x8JgAmAAwAA4ABYQYovnDxmQCYADAADAAGhBmg+MLFZwJgAsAAMAAYEGaA4gsXnwmACQADwABgQJgBii9cfCYAJgAMAAOAAWEGKL5w8ZkAmAAwAAwABoQZoPjCxWcCYALAADAAGBBmgOILF58JgAkAA8AAYECYAYovXHwmACYADAADgAFhBii+cPGZAJgAMAAMAAaEGaD4wsVnAmACwAAwABgQZoDiCxefCYAJAAPAAGBAmAGKL1x8JgAmAAwAA4ABYQYovnDxmQCYADAADAAGhBmg+MLFZwJgAsAAMAAYEGaA4gsXnwmACQADwABgQJgBii9cfCYAJgAMAAOAAWEGKL5w8ZkAmAAwAAwABoQZoPjCxWcCYALAADAAGBBmgOILF58JgAkAA8AAYECYAYovXHwmACYADAADgAFhBii+cPGZAJgAMAAMAAaEGaD4wsVnAmACwAAwABgQZoDiCxefCYAJAAPAAGBAmAGKL1x8JgAmAAwAA4ABYQYovnDxmQCYADAADAAGhBmg+MLFZwJgAsAAMAAYEGaA4gsXnwmACQADwABgQJgBii9cfCYAJgAMAAOIYOBn8hWhiZgN1klKIyl8M5q+GSd7/nI7jAYySnIDkytiJJed6/wBrAawSlIDkirQ+M69PRQOZh2ZJZmOyRRo/A8vVV6w68AuSXRIIo2f5gnwO8kvCZxMIM2f1vzfB8OxkWMSZ0ycSON/+NjlBcsGlkmaIWk0f1lPgOdBnknYYMJo/rLNfwiD6QGmSdZAsmj+o8fKv8N1J9ckqjNRNH/5pj8LhO0OtklSR5Jo/nNvbfM7fD/wTYIeEkTzb9PsV0Jh/IZxknOTHJr/qqe2eg7jN4yTnJvkiBjAVt1sFAvnF5yTmIvE0PzGVqu7DdYbrJOURlJo/rpdPKEM1husk5RGUgQMYKKPhraO8DUU2Lh4RI/EWolLCjT0SB2NvTO0bURPa+3QYQOLW2dJP5O+vKAxDPSKeakXU2YBDxu99L0izisuIdjIlro99MX0xxZNT3umRTUCPJ0p9bnUZYWNotEHro8iOXIV+idYpNbtYm8nWLiJrbXybqBzPKuukX3nM2d/Hzn71WtffTnM4u+33Wyz3O1fyc+djtHPVuoufVZpcTSwy7g62hy961ez06urZ91q7WXPKyuM5ndp/k99I15Z3HjdJUt/uXPLCaLx3Rr/qK1X0xxxjrgZ74eG2fcM7SXPLCkKE3A1gdlm+d6fzcu3ltmfs+9S4vwSImh414Y/13S2UY7957hZvx96Zt+z9Jc6t5QYjCDECGYb5bO/Eice96l2p7T8ph1Msy9tqpmmqcbIzF2+91a7V4qelENp/qXNf9T4G/7en4+9ld57tT+tq3SnNC1pB2MC5U2gKhtPjd37edX7LdW19DCaPqXpzzXuaZDznkq/9+jvWVPpTmla0g7GDNLNoNUkO/DQ0m15tsNdwzWGH0Cjpzf6m2psafSrPW/Ki/ku5o00No2dwMBVM48+h/v//hQeidD8m4C71n200a/W73p/d93uARO+FbhD3//ws3uerprZ8nz3XLjpdwtE4y/7J4EF+Nae3WrfuoP12W53D9MbFhhDcDUEK+i9+6pz0HuP3nXV77tM37KDMASTIfQC7bWuIg9edzviVLxjmqa0gzGEW0M4YM16r8SFdw4q3S1dS7oAjOB/RuAN/Ey8bD5mtF/tzb5TqfNLiRE3gytgs59nMRJx76y7lD23rDAxM4iA3TvmSla8tR/xVt5hi7O2EPlyMzjg3OF9BS9ReVihfbszthP8MjOIgj0ybiQzu+qOzElo7NDgL2tW71xFwh4d2zsXn3iRrwi9r4j5iktsaDSRsK+K7clOpGZPna+L9boLbWAGkbCvjO3FTrRmL52vjPPKSxU2gWjYV8ef5Sda76y+1+9//QULmUE07BnxZ/iJ1jujTWavzEWTjSAa9qz4Vn6i9Vp1ye2Tu3CCEUTDnhnfwk+0Xosm2T2yF19kBNGwZ8cf5Sda76ge+fXyCQg0gmjYz/Gvanle5/n71Zmt557ntmK1zuTZw5+8I0EPCTIaRAvQiGeW+nnq6D3f88xWrF4drDvxTkJOCTE2/HceW4B6P/s+z/rzrKbec2fPedrfq4N1DdZJSiMpEybwBOvs5971surp1WGN37uvVwfrLjgnMReJMZhAL7TWdVG1GtXTq2M07uj6Xh2su2Gc5NwkZ8AERuEdXR9dp149vTp641nX9epg3QPfJOghQR0mYIW4d99Ijc4xR/Z+1l69RuJcxfB6PqKFtfd8/wsAAP//asTjVAAAB3pJREFU7ZsJkhs3DEV97Nwth3OsuFojUb2AJECg9Z+rUpJGbBD8G+glv379+89v/hvH4HfwLys3ljastWbWWfqYWTPTG8/u6BxQdkAxhuKMkC3PWrmx1NrWWGuOrNv2iHod6YlnLvQNQBcAHYRBlMi3ulZetvU9r9ba1nU9e4+utfbCuk49A1gnYH8CIfqXlZOZPqx7XK2b6cH67FUPfN+v4SdmzzcHk47v38G1inZ0nRXv0frtc9b92nVtnajP7b58ftfjNB7TBYSCI0rkW90eLrZnPF8t+3vud1XL0g9rJgMBAG0AXol19vseHmb3usPzPXiw1qbhXZx2fyg01S3njzaMpYfXNdH9ZNd/PSvvJ8xt8TEAnwMcbYYR/KN7yqw/ggfPnGv4FJ/TLy0J8sVroo0win10X1n1R/HgOQLA/V8zRptgVrTR/a2uP4sHzw+GAMB9Ahctfg/Mo3tcWd8DD2p86tiEiWnRF1/z2/NHC7/db+ZzdK8r6s+cn2cHTf/qZ0B8BzFS9N5YR/a6orY3HtR717IJD9Oi18T44veRoo/CObLnyNpReFC3MwQA7AewKMFHYxzVd1TdaDyo/6PpSywuF3zxxH89+93FHtW/d91XzHnfYdQoH0LCXxK8hf6ol4FtxDm8ambgwZ4XIQNAMf97byauXob1rJOJB3ufhADg+AdAFUw9DTxaqwoW9HEQAurAjAr76LlqeB71Gf3zajjQDwGw+3tybyNUFZr3OY/qVT0/fREA4QFwF5EdmXfm53c5O302QaAMyIzg22fvimN7Duvnu56XvgmA503AKnbLOoTVCCvq762p+9Svi+ZcityUFIuxLWuUMeTsNw8+ZQIt5rasUcaQsxMAvleShbcJi7ktazDBzU2wUHPltFKuoYVkWMxtWVMZw6v+K/dObwuCVRnkK3NYv6+K4d37r4rrV/X1VYfpvD1YDXK1riKGVz2331c8Az1xAwj984XWBKOfqwn1W85RDdev7OcrD2W8CYwapX2uEoZtb72fK52FXrgBcAMwhtnDLB6/MN0C03VwGs5H+AaVDtv04mGYR40KGHqdpcp5KmAq0YPEIRvjb2f2Ms1WL+vV6xxbnaxzsG/C7UMZ9E3wHq9ZOHr03tbIOgv7EgBLr9Ot8Gc+Z4h3pt+zZzPOwp4J5n/cjNWBPzNC73crseztrWf9ynOwV5Lxt98WqxPQY4yrtauwvOpj5vtVZ2CfZOMTAH8JmDHL3rPRwt7b0/Nn0f1Tv4jxCYCYAHiYMUrknkbfqxXVN3WLmX4z/+MVcnz+AU1rKE9c29oRnz37pVZhw7+anwCIuwU8TOphhAiztzU9+qTGjUz/GgIQFxsCo0HQmjTqM/zf1LivJp55jwDiA+DVvGd4v65b8f6sF74TCQaI/iF6hemq7AHvP7xLYyF9+ObqVMWc0X3AOeZ/auD5pjGD6s+jzZddX5VXzn0QegDzCUy2SaP2h+tPruUxkQdg5+YTZcDMuvCM+Xc1sPvDHVOorcs0q/featxx3o6wA6xjsLyNmFEPfo/5BZs/2ADCuUAyTOu1J9yecws+BIDpn+t6GXJlHcSN+U0aMC3izwRWend6LzjF/GYNmBcSAtPGXFEAPjF/lwa6FhMCKzw8vAdcYv5uDXQ/QAj8/+cGwy4NeBAOMf6wBoYfJAhKBAH8Yf4pDUw9TAikhQC8YXwXDbgUIQief50YcMN/KwlfGN9VA67FCIKQIIAjTB+mgbDChMEzDDaM30b5wYdtLa+YfokGlmxCGHyEAbhj8BIaKNEEAUFAoIEcDRAATCI0IKwByBcmn6mbM3Ur4U4AEABoQFgDkC9MfqVJRC85txECgABAA8IagHxh8pm6OVO3Eu4EAAGABoQ1APnC5FeaRPSScxshAAgANCCsAcgXJp+pmzN1K+FOABAAaEBYA5AvTH6lSUQvObcRAoAAQAPCGoB8YfKZujlTtxLuBAABgAaENQD5wuRXmkT0knMbIQAIADQgrAHIFyafqZszdSvhTgAQAGhAWAOQL0x+pUlELzm3EQKAAEADwhqAfGHymbo5U7cS7gQAAYAGhDUA+cLkV5pE9JJzGyEACAA0IKwByBcmn6mbM3Ur4U4AEABoQFgDkC9MfqVJRC85txECgABAA8IagHxh8pm6OVO3Eu4EAAGABoQ1APnC5FeaRPSScxshAAgANCCsAcgXJp+pmzN1K+FOABAAaEBYA5AvTH6lSUQvObcRAoAAQAPCGoB8YfKZujlTtxLuBAABgAaENQD5wuRXmkT0knMbIQAIADQgrAHIFyafqZszdSvhTgAQAGhAWAOQL0x+pUlELzm3EQKAAEADwhqAfGHymbo5U7cS7gQAAYAGhDUA+cLkV5pE9JJzGyEACAA0IKwByBcmn6mbM3Ur4U4AEABoQFgDkC9MfqVJRC85txECgABAA8IagHxh8pm6OVO3Eu4EAAGABoQ1APnC5FeaRPSScxshAAgANCCsAcgXJp+pmzN1K+FOABAAaEBYA5AvTH6lSUQvObcRAoAAQAPCGoB8YfKZujlTtxDu/wFtJx/6F6ubEgAAAABJRU5ErkJggg=="

  }
  
  resetIcon();
  
function exportPlugin() {
  clearInterval(planeAnimation);
  hideIds.forEach(function(id) {
    try {
      document.getElementById(id).style.display = "none";
    } catch(e) {};
  });
  document.getElementById("exportPlugin").style.display = "block";
}  
  
  function clearObjectDock() {
    project.remove("objectDock.plist")
    throwSuccess("Successfully cleared Object Dock")
  }

  function clearColorPalette() {
    project.remove("colourPickerMemory.plist")
    throwSuccess("Successfully reset Color Picker Memory")
  }
  
  async function extractBehaviorsData() {

return new Promise(async function(resolve) {

  let result = {};
  let data = db.exec("SELECT ztag, zactions from zbehaviourdata")[0].values;
  let count = data.length;
  let current = 0;
  console.log(count)
  data.forEach(async function(data) {
    result[data[0]] = await extract(Buffer.from(data[1]));
  	current++;
  	if (current == count) {
      resolve(JSON.stringify(result));
    }
  })
	
})

}
  
  async function extractObjectsData() {

return new Promise(async function(resolve) {

  try {
  
  let result = {};
  let data = db.exec("SELECT ZNAME, ZGAMEOBJECTDATA from zobjectdata")[0].values;
  let count = data.length;
  let current = 0;
  console.log(count)
  data.forEach(async function(data) {
    result[data[0]] = await extract(Buffer.from(data[1]));
  	current++;
  	if (current == count) {
      resolve(JSON.stringify(result));
    }
  })

  } catch(e) {
    console.error(e)
  }
  
})

  }
 
  var downloadingZip = false;
async function downloadFilesExecute() {
  let count = 0;
  let check = ["sqliteFile", "jsonFile", "assetsFolder", "projectDetailsFile", "objectDockFile", "colorPickerMemoryFile", "projectIconFile", "projectIconHDFile", "persistentFile", "internalObjectsDatabase", "internalBehaviorsDatabase"];
  let downloads = []
  check.forEach(function(id) {
    if (document.getElementById(id).checked) {
      count++;
      downloads.push(id)
    }
  })
  
  if (downloadingZip) {
    return throwError("Download is already in progress.")
  }
  
  if (count == 0) {
    return throwError("Please select at least one file to download")
  }
  
  let files = {
    sqliteFile: "levels/Level 1/Level.sqlite",
    assetsFolder: "Assets Folder",
    jsonFile: "levels/Level 1/Level.json",
    projectDetailsFile: "gameDetails.plist",
    objectDockFile: "objectDock.plist",
    colorPickerMemoryFile: "colourPickerMemory.plist",
    projectIconFile: "icon.png",
    projectIconHDFile: "icon@2x.png",
    persistentFile: "persistent.plist",
    internalObjectsDatabase: "Objects.json",
    internalBehaviorsDatabase: "Behaviors.json"
  }
  
  if (count == 1) {
    downloadingZip = true;
    document.getElementById("downloadExecButton").innerHTML = "Downloading"
    let fileName = files[downloads[0]].replace("levels/Level 1/", "");
    throwSuccess("Downloading " + fileName + "...");
    if (downloads[0] == "sqliteFile") {
      getSQLite();
      document.getElementById("downloadExecButton").innerHTML = "Download"
      downloadingZip = false;
      return throwSuccess("Successfully downloaded " + fileName);
    }
    if (downloads[0] == "jsonFile") {
      extractJSON();
      document.getElementById("downloadExecButton").innerHTML = "Download"
      downloadingZip = false;
      return throwSuccess("Successfully downloaded " + fileName);
    }
    if (downloads[0] == "internalObjectsDatabase") {
      let data = await extractObjectsData();
      downloadFile(data, "Objects.json");
      document.getElementById("downloadExecButton").innerHTML = "Download"
      downloadingZip = false;
      return throwSuccess("Successfully downloaded " + fileName);
    }
    if (downloads[0] == "internalBehaviorsDatabase") {
      let data = await extractBehaviorsData();
      downloadFile(data, "Behaviors.json");
      document.getElementById("downloadExecButton").innerHTML = "Download"
      downloadingZip = false;
      return throwSuccess("Successfully downloaded " + fileName);
    }
    if (downloads[0] == "assetsFolder") {
      try {
    project.folder("Assets").generateAsync({type: "blob"}, function(update) {
      let percent = " (" + Math.floor(update.percent) + "%)";
      document.getElementById("downloadExecButton").innerHTML = "Downloading " + percent;
      document.getElementById("assetsFolderProgress").innerHTML = percent;
    })
		  .then(function(content) {
      downloadFile(content, "Assets.zip")
      throwSuccess("Successfully downloaded " + fileName);
      document.getElementById("downloadExecButton").innerHTML = "Download"
      document.getElementById("assetsFolderProgress").innerHTML = " (directory)";
      downloadingZip = false;
    });
    } catch(e) {
      throwError("Failed to download " + fileName + " - folder does not exist")
      document.getElementById("downloadExecButton").innerHTML = "Download"
      document.getElementById("assetsFolderProgress").innerHTML = " (directory)";
      downloadingZip = false;
      console.error(e)
    }
      return
    }
    try {
    project.file(files[downloads[0]]).async("blob")
		  .then(function(content) {
      downloadFile(content, fileName)
      throwSuccess("Successfully downloaded " + fileName);
      document.getElementById("downloadExecButton").innerHTML = "Download"
      downloadingZip = false;
    });
    } catch(e) {
      throwError("Failed to download " + fileName + " - file does not exist")
      document.getElementById("downloadExecButton").innerHTML = "Download"
      downloadingZip = false;
    }
  }
  
  if (count > 1) {
    hideIds.forEach(function(id) {
      try {
        document.getElementById(id).style.display = "none";
      } catch(e) {};
    });
    document.getElementById("downloadingFiles").style.display = "block";
    
    let entries = [];
    document.getElementById("downloadStatus").innerHTML = "Populating folder...";
    downloads.forEach(function(file) {
      entries.push({
        name: files[file],
        progress: 0,
        failed: false
      })
    });
    
    let update = function() {
      let content = "";
      entries.forEach(function(file) {
        let append = "<span style='color:#00bb78'>";
        append += file.name.replace("levels/Level 1/", "");
        append += "</span>";
        if (!file.failed) {
          if (file.ported) {
            append += "<span style='color:#55ffff'> (DONE)";
            append += "</span><br>";
          } else {
            append += "<span> (" + file.progress + "%)";
            append += "</span><br>";
          }
        } else {
          append += "<span style='color:#ff6565'> (FAILED)";
          append += "</span><br>";
        }
        content += append;
      });
      document.getElementById("fileViewDownload").innerHTML = content;
    }

    update();
    await wait(0.1);
    let zip = new JSZip();
    let index = -1;
    entries.forEach(async function(file) {
      let pass = true;
      index++;
      let rIndex = parseInt(index);
      console.log(file.name)
      if (file.name == "levels/Level 1/Level.sqlite") {
        pass = false;
        let content = await project.file(file.name).async("blob", function(onUpdate) {
          entries[rIndex].progress = Math.floor(onUpdate.percent);
        });
        entries[rIndex].progress = 100;
        zip.file("Level.sqlite", content);
        entries[rIndex].processed = true;
        return;
      }
      if (file.name == "levels/Level 1/Level.json") {
        pass = false;
        entries[rIndex].progress = 100;
        zip.file("Level.json", extractJSON(true));
        entries[rIndex].processed = true;
        return;
      }
      if (file.name == "Objects.json") {
        pass = false;
        let data = await extractObjectsData();
		entries[rIndex].progress = 50;
        zip.file("Objects.json", data);
        entries[rIndex].processed = true;
        entries[rIndex].progress = 100;
      }
      if (file.name == "Behaviors.json") {
        pass = false;
        let data = await extractBehaviorsData();
        entries[rIndex].progress = 50;
        zip.file("Behaviors.json", data);
        entries[rIndex].processed = true;
        entries[rIndex].progress = 100;
      }
      if (file.name == "Assets Folder") {
        pass = false;
        try {
          let pathCount = 0;
          project.folder("Assets").forEach(async function() {
            pathCount++;
          });
          let currentCount = 0;
          project.folder("Assets").forEach(async function(path) {
            let content = await project.file("Assets/" + path).async("blob");
            zip.file("Assets/" + path, content);
            currentCount++;
            let percent = Math.round((currentCount / pathCount) * 100);
            entries[rIndex].progress = percent;
            if (currentCount == pathCount) {
              entries[rIndex].processed = true;
            }
          })
        } catch(e) {
          console.error(e);
          entries[rIndex].failed = true;
          entries[rIndex].processed = true;
        }
        return;
      }
      if (pass) {
        try {
          let content = await project.file(file.name).async("blob", function(onUpdate) {
            entries[rIndex].progress = Math.floor(onUpdate.percent);
          });
          entries[rIndex].progress = 100;
          zip.file(file.name, content);
          entries[rIndex].processed = true;
        } catch(e) {
          console.error(file.name)
          entries[rIndex].failed = true;
          entries[rIndex].processed = true;
        }
      }
    });
    
    let timer = setInterval(function() {
      update();
      let passing = true;
      entries.forEach(async function(file) {
        if (!file.processed) {
          passing = false;
          // console.log(file)
        }
      })
      if (passing) {
        let s = 0;
        let d = setInterval(function() {
          s++;
          document.getElementById("downloadStatus").innerHTML = "Allocating resources (" + s + "s)";
        }, 1000);
        document.getElementById("downloadStatus").innerHTML = "Allocating resources...";
        clearInterval(timer);
        let currentFile;
        zip.generateAsync({type: "blob"}, async function(onUpdate) {
          let p = Math.floor(onUpdate.percent);
          clearInterval(d);
          document.getElementById("downloadStatus").innerHTML = "Compressing folder (" + p + "%)";
          if (onUpdate.currentFile !== currentFile) {
            let i = 0;
            entries.forEach(function(file) {
              if (file.name == currentFile) {
                console.log(currentFile)
                entries[i].ported = true;
                update();
              }
              i++;
            })
            currentFile = onUpdate.currentFile;
          }
          update();
        }).then(async function(content) {
          entries.forEach(function(file) {
            file.ported = true;
          })
          update();
          await wait(0.5);
          downloadFile(content, "Downloads.zip");
          hideIds.forEach(function(id) {
            try {
              document.getElementById(id).style.display = "none";
            } catch(e) {};
          });
          // console.log(content.size)
          let size = Math.round(content.size / 100000) / 10;
          if (size == 0) {
            size = Math.round(content.size / 1000) / 10;
            size += "KB";
          } else {
            size += "MB";
          }
          document.getElementById("downloadFiles").style.display = "block";
          throwSuccess("Successfully downloaded " + count + " files (" + size + ")")
          delete zip;
        })
      }
    }, 50);
    
  }
  
}
  
function hideAllBehaviors() {
  let startTime = Date.now();
  // create table to store hidden behavior data if there is no table
  try {
    db.exec("create table hiddenBehaviors(ZOBJECT NUM, Z_PK NUM,HIDDEN INT,ZX_POS NUM,ZY_POS NUM)");
  } catch(e) {};
  
  // get all behavior z_pks
  index = db.exec("select * from zbehaviourdata");
  if (index.length == 0) {
    return throwError("The project does not contain any behaviors")
  }
  let behaviorsZPKS = [];
  index[0].values.forEach(function(value) {
    behaviorsZPKS.push(value[0]);
  });
  
  // iterate through all behaviors
  let toHide = [];
  let it = 0;
  let writes = 0;
  try {
  behaviorsZPKS.forEach(function(id) {
    
    // check if behavior is hidden
    check = db.exec("select hidden from hiddenBehaviors where z_pk = " + id);
    // console.log(JSON.stringify(check));
    if (check.length == 0) {
      
      // store behavior data if behavior does not show up in the database
      let zpk = db.exec("select zobject from zbehaviourData where z_pk = " + id)[0].values[0][0];
      let xI = index[0].columns.indexOf("ZX_POS");
      let yI = index[0].columns.indexOf("ZY_POS");
      let xPos = index[0].values[it][xI];
      let yPos = index[0].values[it][yI];
      let v = [zpk, id, 0, xPos, yPos];
      let cmd = "insert into hiddenBehaviors values(" + v.join(",") + ")";
      // console.log(cmd);
      db.run(cmd);
      toHide.push(id);
      writes++;
      
    } else {
      
      // if behavior is not hidden, update data
      if (check[0].values[it][0] == 0) {
        let xI = index[0].columns.indexOf("ZX_POS");
        let yI = index[0].columns.indexOf("ZY_POS");
        let cmd = "update hiddenBehaviors set ZX_POS = " + index[0].values[it][xI];
        cmd += " where z_pk = " + id;
        db.run(cmd);
        cmd = "update hiddenBehaviors set ZY_POS = " + index[0].values[it][yI];
        cmd += " where z_pk = " + id;
        db.run(cmd);
        // console.log(index[0].values[it][xI] + "," + index[0].values[it][yI])
        toHide.push(id);
        writes += 2;
      }
      
    }
    it++;
  });
  } catch(e) {
    console.error(e)
  };
  
  // hide behaviors
  let hidden = 0;
  toHide.forEach(function(id) {
    let cmd = "update zbehaviourdata set ZX_POS = -99999999999 where z_pk = " + id;
    db.run(cmd);
    cmd = "update zbehaviourdata set ZY_POS = -99999999999 where z_pk = " + id;
    db.run(cmd);
    cmd = "update hiddenBehaviors set hidden = 1 where z_pk = " + id;
    db.run(cmd);
    hidden++;
    writes++;
  });
  
  let delta = Date.now() - startTime;
  throwSuccess("Successfully hidden " + hidden + " behaviors - " + writes + " writes (" + delta + "ms)");
  
}
  
function showAllBehaviors() {
  
  let startTime = Date.now();
  // create table to store hidden behavior data if there is no table
  try {
    db.exec("create table hiddenBehaviors(ZOBJECT NUM, Z_PK NUM,HIDDEN INT,ZX_POS NUM,ZY_POS NUM)");
  } catch(e) {};
   
  let writes = 0;
  let shown = 0;
  
  try {
  let cmd = "select z_pk from hiddenBehaviors";
  cmd += " where hidden = 1" 
  let data = db.exec(cmd);
  if (data.length == 0) {
    return throwError("There are no hidden behaviors in the whole project")
  }
  
  data[0].values.forEach(function(value) {
    let b = value[0];
    let pos = db.exec("select ZX_POS, ZY_POS from hiddenBehaviors where Z_PK = " + b);
    let cmd = "update zbehaviourData set ZX_POS = " + pos[0].values[0][0];
    cmd += " where Z_PK = " + b;
    db.run(cmd);
    cmd = "update zbehaviourData set ZY_POS = " + pos[0].values[0][1];
    cmd += " where Z_PK = " + b;
    db.run(cmd);
    shown++;
    writes += 2;
  });
  
  let delta = Date.now() - startTime;
  throwSuccess("Successfully shown " + shown + " behaviors - " + writes + " writes (" + delta + "ms)");
  db.run("delete from hiddenBehaviors where hidden = 1");
  } catch(e) {console.error(e)}
}
  
var acceptAlert = function() {};
  
function alertPopup(title, description, funct) {
  hideIds.forEach(function(id) {
    try {
      document.getElementById(id).style.display = "none";
    } catch(e) {};
  });
  console.log(funct)
  acceptAlert = funct;
  document.getElementById("alertBox").style.display = "block";
  document.getElementById("alertTitle").innerHTML = title;
  document.getElementById("alertDescription").innerHTML = description;
  document.getElementById("alertBox").animate(appear, {duration: 300, transition: "ease-out"});
}
  
function exitEditMode() {
  exitMenu();
  editSceneData();
}
  
function downloadFiles() {
  hideIds.forEach(function(id) {
    try {
      document.getElementById(id).style.display = "none";
    } catch(e) {};
  });
  prevMenu = "projectData";
  document.getElementById("downloadFiles").style.display = "block";
}  
  
function enterPass() {
  
  if (document.getElementById("password2").value.length == 0) {
    return throwError("Password cannot be blank")
  } 
  
  if (document.getElementById("password2").value === pass[0]) {
    openMenu();
    throwSuccess("Successfully authenicated project modification")
    
  } else {
    throwError("Provided password is invalid")
  }
}
 
function checkPass() {
  console.info("check password")
  hideIds.forEach(function(id) {
    try {
      document.getElementById(id).style.display = "none";
    } catch(e) {};
  });
  document.getElementById("enterPassword").style.display = "block";  
  
}  
  
function setPass() {
  
  if (document.getElementById("password").value.length == 0) {
    return throwError("Password cannot be blank")
  } 
  
  openMenu();
  try {
    db.run("create table password (value Text)");
  } catch(e) {console.error(e)};
  try {
    let p = document.getElementById("password").value;
    let o = db.exec("update password set value = " + JSON.stringify(p));
    throwSuccess("Successfully set password");
    if (o.length == 0) {
      db.run("insert into password values(" + JSON.stringify(p) + ")");
    }
  } catch(e) {throwError(e)};
}
  
function setPassword() {
  hideIds.forEach(function(id) {
    try {
      document.getElementById(id).style.display = "none";
    } catch(e) {};
  });
  try {
    let p = db.exec("select value from password")[0].values[0][0];
    document.getElementById("password").value = p;
    console.info(p)
  } catch(e) {}
  prevMenu = "projectData";
  document.getElementById("setPassword").style.display = "block";  
}
  
function projectScreen() {
  hideIds.forEach(function(id) {
    try {
      document.getElementById(id).style.display = "none";
    } catch(e) {};
  });
  document.getElementById("projectViewer").style.display = "block";  
}
  
function lockProject() {
  hideIds.forEach(function(id) {
    try {
      document.getElementById(id).style.display = "none";
    } catch(e) {};
  });
  prevMenu = "projectData"
  document.getElementById("lockProject").style.display = "block";  
}
  
function enforceLockdown() {
  hideIds.forEach(function(id) {
    try {
      document.getElementById(id).style.display = "none";
    } catch(e) {};
  });
  
  // lock change
  try {
  db.run("Create table Lock (lock num)");
  db.run("insert into Lock values(" + Date.now() + ")");
  db.run("update zprojectdata set zproject_key = ''");
  
  // change project insides
  db.run("update zbehaviourdata set ZX_POS = -999999999");
  db.run("update zbehaviourdata set ZY_POS = -999999999");
  db.run("update zobjectdata set zlocked = 1");
  db.run("update zobjectdata set zlastbehaviourscale = -99");
  db.run("update zeditordata set zlastscenetype = -999")
  db.run("update zeditordata set zlastlevelindex = -999")
  db.run("update zeditordata set ztimespentcreating = 999999999999")
  } catch(e) {console.error(e)}
  console.info("project locked")
  
  document.getElementById("projectLocked").style.display = "block";  
  document.getElementById("projectLocked").animate(appear, {duration: 300, transition: "ease-out"});
  document.getElementById("projectLocked").style.display = "block";  
  document.getElementById("downloadBack").style["background-color"] = "grey";
  document.getElementById("downloadBack").onclick = "throwError('Project cannot be edited because it is locked')"
  
}
  
var debugTimer;
var webTiming;
var debugging = false;
var byteLength = 0;
function toggleDebug() {
  if (!debugging) { 
    document.getElementById("debugMem").style.display = "block";
    webTiming = Date.now();
    let time = 0;
    debugTimer = setInterval(async function() {
      let delta = Date.now() - webTiming;
      webTiming = Date.now();
      let perf = Math.floor((1000 / delta) * 100);
      perf += "% Runtime Performance";
      let bytes = document.getElementById("memTracker").innerHTML.length;
      perf += "<br>HTML Memory: " + bytes + "B";
      let varB = 0;
      Object.keys(window).forEach(function(v) {
        try {
          if (typeof v !== "Blob") {
            varB += window[v].toString().length;
          }
        } catch(e) {}
      });
      perf += "<br>Global Variable Memory: " + varB + "B";
      if (time % 5 == 0) {
        byteLength = db.export().byteLength
      }
      time++
      perf += "<br>SQLite File Size: " + byteLength + "B";
      document.getElementById("debugMem").innerHTML = perf;
    }, 1000)
    debugging = true;
  } else {
    document.getElementById("debugMem").style.display = "none";
    debugging = false;
    clearTimeout(debugTimer);
  }
}
  
function enableMemDebug() {
  var script=document.createElement('script');
  script.src='https://rawgit.com/paulirish/memory-stats.js/master/bookmarklet.js';
  document.head.appendChild(script);
  let d = document.getElementById("memGraphButton");
  d.innerHTML = "Memory Graph Enabled"
  d.style["background-color"] = "gray";
}
  
function removeGlobal() {
  hideIds.forEach(function(id) {
    try {
      document.getElementById(id).style.display = "none";
    } catch(e) {};
  });
  prevMenu = "behaviorOption";
  document.getElementById("deleteGlobalBehaviors").style.display = "block";
}  
  
function transferBehaviors() {
  hideIds.forEach(function(id) {
    try {
      document.getElementById(id).style.display = "none";
    } catch(e) {};
  });
  prevMenu = "behaviorOption";
  document.getElementById("transferBehaviors").style.display = "block";
}
  
function execTransferBehaviors() {
  let startTime = Date.now();
  // check for object A
  let obj = document.getElementById("objectBehaviorFrom").objectName;
  let index = db.exec("select z_pk from zobjectdata where zname = " + JSON.stringify(obj));
  if (index.length == 0) {
    return throwError("Object A (" + obj + ") does not exist");
  } 
  let zpk = index[0].values[0][0];
  
  // check for object B
  let obj2 = document.getElementById("objectBehaviorTo").objectName;
  index = db.exec("select z_pk from zobjectdata where zname = " + JSON.stringify(obj2));
  if (index.length == 0) {
    return throwError("Object B (" + obj2 + ") does not exist");
  } 
  let zpk2 = index[0].values[0][0];
  
  // get behavior count from object A
  let behaviors = db.exec("select z_pk from zbehaviourdata where zobject = " + zpk);
  if (behaviors.length == 0) {
    return throwError("There are no behaviors in Object A (" + obj + ")")
  }
  behaviors = behaviors[0].values;
  
  // move behaviors
  let cmd = "update zbehaviourdata set zobject = " + zpk2;
  cmd += " where zobject = " + zpk;
  db.run(cmd);
  
  let delta = Date.now() - startTime;
  throwSuccess("Successfully transferred " + behaviors.length + " behaviors")
  
}
  
function hideBehaviors() {
  hideIds.forEach(function(id) {
    try {
      document.getElementById(id).style.display = "none";
    } catch(e) {};
  });
  prevMenu = "behaviorOption";
  document.getElementById("hideBehaviors").style.display = "block";
}  
  
function execHideBehaviors() {
  let startTime = Date.now();
  // create table to store hidden behavior data if there is no table
  try {
    db.exec("create table hiddenBehaviors(ZOBJECT NUM, Z_PK NUM,HIDDEN INT,ZX_POS NUM,ZY_POS NUM)");
  } catch(e) {};
  
  // check for object
  let obj = document.getElementById("objectBehaviorTarget").objectName;
  let index = db.exec("select z_pk from zobjectdata where zname = " + JSON.stringify(obj));
  if (index.length == 0) {
    return throwError("Specified object does not exist");
  } 
  let zpk = index[0].values[0][0];
  
  // get all behavior z_pks
  index = db.exec("select * from zbehaviourdata where zobject = " + zpk);
  if (index.length == 0) {
    return throwError("Object did not contain any behaviors")
  }
  let behaviorsZPKS = [];
  index[0].values.forEach(function(value) {
    behaviorsZPKS.push(value[0]);
  });
  
  // iterate through all behaviors
  let toHide = [];
  let it = 0;
  let writes = 0;
  try {
  behaviorsZPKS.forEach(function(id) {
    
    // check if behavior is hidden
    check = db.exec("select hidden from hiddenBehaviors where z_pk = " + id);
    // console.log(JSON.stringify(check));
    if (check.length == 0) {
      
      // store behavior data if behavior does not show up in the database
      let xI = index[0].columns.indexOf("ZX_POS");
      let yI = index[0].columns.indexOf("ZY_POS");
      let xPos = index[0].values[it][xI];
      let yPos = index[0].values[it][yI];
      let v = [zpk, id, 0, xPos, yPos];
      let cmd = "insert into hiddenBehaviors values(" + v.join(",") + ")";
      // console.log(cmd);
      db.run(cmd);
      toHide.push(id);
      writes++;
      
    } else {
      
      // if behavior is not hidden, update data
      if (check[0].values[it][0] == 0) {
        let xI = index[0].columns.indexOf("ZX_POS");
        let yI = index[0].columns.indexOf("ZY_POS");
        let cmd = "update hiddenBehaviors set ZX_POS = " + index[0].values[it][xI];
        cmd += " where z_pk = " + id;
        db.run(cmd);
        cmd = "update hiddenBehaviors set ZY_POS = " + index[0].values[it][yI];
        cmd += " where z_pk = " + id;
        db.run(cmd);
        // console.log(index[0].values[it][xI] + "," + index[0].values[it][yI])
        toHide.push(id);
        writes += 2;
      }
      
    }
    it++;
  });
  } catch(e) {
    console.error(e)
  };
  
  // hide behaviors
  let hidden = 0;
  toHide.forEach(function(id) {
    let cmd = "update zbehaviourdata set ZX_POS = -99999999999 where z_pk = " + id;
    db.run(cmd);
    cmd = "update zbehaviourdata set ZY_POS = -99999999999 where z_pk = " + id;
    db.run(cmd);
    cmd = "update hiddenBehaviors set hidden = 1 where z_pk = " + id;
    db.run(cmd);
    hidden++;
    writes++;
  });
  
  let delta = Date.now() - startTime;
  throwSuccess("Successfully hidden " + hidden + " behaviors - " + writes + " writes (" + delta + "ms)");
  
}
  
function execShowBehaviors() {
  
  let startTime = Date.now();
  // create table to store hidden behavior data if there is no table
  try {
    db.exec("create table hiddenBehaviors(ZOBJECT NUM, Z_PK NUM,HIDDEN INT,ZX_POS NUM,ZY_POS NUM)");
  } catch(e) {};
  
  // check for object
  let obj = document.getElementById("objectBehaviorTarget").objectName;
  let index = db.exec("select z_pk from zobjectdata where zname = " + JSON.stringify(obj));
  if (index.length == 0) {
    return throwError("Specified object does not exist");
  } 
  let zpk = index[0].values[0][0];
  
  let writes = 0;
  let shown = 0;
  
  try {
  let cmd = "select z_pk from hiddenBehaviors where zobject = " + zpk;
  cmd += " and hidden = 1" 
  let data = db.exec(cmd);
  if (data.length == 0) {
    return throwError("There are no hidden behaviors in the specified object")
  }
  
  data[0].values.forEach(function(value) {
    let b = value[0];
    let pos = db.exec("select ZX_POS, ZY_POS from hiddenBehaviors where Z_PK = " + b);
    let cmd = "update zbehaviourData set ZX_POS = " + pos[0].values[0][0];
    cmd += " where Z_PK = " + b;
    db.run(cmd);
    cmd = "update zbehaviourData set ZY_POS = " + pos[0].values[0][1];
    cmd += " where Z_PK = " + b;
    db.run(cmd);
    shown++;
    writes += 2;
  });
  
  let delta = Date.now() - startTime;
  throwSuccess("Successfully shown " + shown + " behaviors - " + writes + " writes (" + delta + "ms)");
  db.run("delete from hiddenBehaviors where zobject = " + zpk)
  } catch(e) {console.error(e)}
}
  
// object selector code
function selectObject(objectName, selectorID, ID) {
  console.log(objectName, selectorID, ID);
  document.getElementById(selectorID).objectName = objectName;
  document.getElementById(selectorID).value = objectName;
  document.getElementById(selectorID).uuid = ID;
}
var savedTitle = document.title;
var csAddStr = " \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 \xa0 - HVKeyboard ";
if (document.title == "") { savedTitle = document.URL; }
var csShowCount = 0;
function captionKbClose() {
  if (csShowCount > 0) {
    csShowCount = csShowCount - 1;
  }
  if (csShowCount == 0) {
    document.title = savedTitle;
  }
}
function getPosition(el) {
  const rect = el.getBoundingClientRect();
  return {
    left: rect.left + window.scrollX,
    top: rect.top + window.scrollY,
    bottom: rect.bottom + window.scrollY,
    right: rect.right + window.scrollX,
    width: Math.abs(rect.left - rect.right)
  };
}
  
document.querySelectorAll(".behavior-selector").forEach(function(element) {
  element.placeholder = "No behavior selected";
  element.objectName = "";
  element.populateDropdown = function(listID) {
    let e = document.getElementById("objectSelectorDropdown");
    let ref = getPosition(element);
    e.style.width = ref.width + "px";
    e.style.left = ref.left;
    e.style.top = ref.bottom;
    e.style.display = "none";
    e.setAttribute("parentElement", element);
    element.focused = true;
    let result = [];
    let ids = [];
    
    let index = behaviorNames;
    let i = -1;
    let highlight = "<b style='color:#00bb78'>" + element.value + "</b>"
    index.forEach(function(r) {
      i++;
      let text = r || "";
      text = text.replace(element.value, highlight);
      if (element.value !== "") {
        if (text === r) {
          return;
        }
      }
      result.push(text);
      ids.push({
        name: r,
        id: behaviorIDs[i]
      });
    });
    
    console.log(ids)
    
    if (result.length == 0) {
      result.push("<b style='color:#ff5555'> No behaviors found. </b>")
    }
    
    let inner = "";
    let self = this;
    index = 0;
    result.forEach(function(item) {
      let id = ids[index];
      inner += "<a onclick='selectObject(" + JSON.stringify(id.name) + ",";
      inner += JSON.stringify(element.id) + "," + JSON.stringify(id.id) + ");'";
      inner += ">" + item + "</a>";
      index++;
    });
    element.ids = ids;
    element.style.color = 'white';
    e.innerHTML = inner;
    e.style.display = "block";
  }
  setInterval(function() {
    if (element.value !== "" && element.value !== element.objectName) {
    if (element.value !== element.prevText) {
      element.prevText = element.value;
      element.populateDropdown();
      }
    }
    if (element.focused) {
      if (element.value !== element.prevText) {
        element.prevText = element.value;
        element.populateDropdown();
      }
    }
  }, 100);
  element.onfocus = function(data) {
    this.populateDropdown();
  }
  element.onblur = function(data) {
    this.hide();
  }
  element.addEventListener("keypress", function(event) {
  if (event.key === "Enter") {
    event.preventDefault();
    this.hide("enter");
  }})
  element.hide = function(type) {
    element.focused = false;
    try {
      setTimeout(function() {
        document.getElementById("objectSelectorDropdown").style.display = "none";
      }, 1);
    } catch(e) {};
    blur();
    document.title = savedTitle + csAddStr + "Hide";
  	csShowCount = csShowCount + 1;
  	setTimeout(captionKbClose, 1000);
    if (type == "enter") {
      if (this.ids[0]) {
        this.objectName = this.ids[0].name;
        this.uuid = this.ids[0].id;
      }
    }
    this.value = this.objectName;
    element.style.color = "#00bb78"
  }
})
  
document.querySelectorAll(".object-selector").forEach(function(element) {
  element.placeholder = "No object selected";
  element.objectName = "";
  element.populateDropdown = function(listID) {
    let e = document.getElementById("objectSelectorDropdown");
    let ref = getPosition(element);
    e.style.width = ref.width + "px";
    e.style.left = ref.left;
    e.style.top = ref.bottom;
    e.style.display = "none";
    e.setAttribute("parentElement", element);
    element.focused = true;
    let result = [];
    let ids = [];
    
    let cmd = "select zname from zobjectdata"
    let index = db.exec(cmd);
    let highlight = "<b style='color:#00bb78'>" + element.value + "</b>"
    index[0].values.forEach(function(r) {
      let text = r[0] || "";
      text = text.replace(element.value, highlight);
      if (element.value !== "") {
        if (text === r[0]) {
          return;
        }
      }
      result.push(text);
      ids.push(r[0]);
    });
    
    if (result.length == 0) {
      result.push("<b style='color:#ff5555'> No objects found. </b>")
    }
    
    let inner = "";
    let self = this;
    index = 0;
    result.forEach(function(item) {
      let id = ids[index];
      inner += "<a onclick='selectObject(" + JSON.stringify(id) + ",";
      inner += JSON.stringify(element.id) + ");'";
      inner += ">" + item + "</a>";
      index++;
    });
    element.ids = ids;
    element.style.color = 'white';
    e.innerHTML = inner;
    e.style.display = "block";
  }
  setInterval(function() {
    if (element.value !== "" && element.value !== element.objectName) {
    if (element.value !== element.prevText) {
      element.prevText = element.value;
      element.populateDropdown();
      }
    }
    if (element.focused) {
      if (element.value !== element.prevText) {
        element.prevText = element.value;
        element.populateDropdown();
      }
    }
  }, 100);
  element.onfocus = function(data) {
    this.populateDropdown();
  }
  element.onblur = function(data) {
    this.hide();
  }
  element.addEventListener("keypress", function(event) {
  if (event.key === "Enter") {
    event.preventDefault();
    this.hide("enter");
  }})
  element.hide = function(type) {
    element.focused = false;
    try {
      setTimeout(function() {
        document.getElementById("objectSelectorDropdown").style.display = "none";
      }, 1);
    } catch(e) {};
    blur();
    document.title = savedTitle + csAddStr + "Hide";
  	csShowCount = csShowCount + 1;
  	setTimeout(captionKbClose, 1000);
    if (type == "enter") {
      if (this.ids[0]) {
        this.objectName = this.ids[0];
      }
    }
    this.value = this.objectName;
    element.style.color = "#00bb78"
  }
})
  
function removeGlobalBehaviors() {
  prevMenu = "behaviorOption";
  exitMenu();
  let cmd = 'SELECT z_pk from zobjectdata where zobjecttype = "World" and zname = "world" limit 1';
  let index = db.exec(cmd);
  if (index.length == 0) {
    return throwError("Failed to delete global behaviors - global world object not found. Try reloading and saving the project then import the newest .tap file.");
  }
  ZPK = index[0].values[0][0];
  cmd = "select * from zbehaviourdata where z_pk = " + ZPK;
  index = db.exec(cmd);
  console.log(index)
  if (index.length == 0) {
    return throwError("There are no global behaviors to delete.");
  }
  cmd = "delete from zbehaviourdata where z_pk = " + ZPK;
  try {
    db.exec(cmd);
    throwSuccess("Successfully deleted " + index[0].values[0].length + " global behaviors");
  } catch(e) {
    throwError("Error deleting global behaviors: " + e);
  }
}
  
function downloadFile(text, fileName) {
        const fileStream = streamSaver.createWriteStream(fileName, {
          size: text.size // Makes the procentage visiable in the download
        })

        // One quick alternetive way if you don't want the hole blob.js thing:
        // const readableStream = new Response(
        //   Blob || String || ArrayBuffer || ArrayBufferView
        // ).body
        const readableStream = new Response(text).body;

        // more optimized pipe version
        // (Safari may have pipeTo but it's useless without the WritableStream)
        if (window.WritableStream && readableStream.pipeTo) {
          return readableStream.pipeTo(fileStream)
            .then(() => {
            console.log('done writing');
          })
        }

        // Write (pipe) manually
        window.writer = fileStream.getWriter()

        const reader = readableStream.getReader()
        const pump = () => reader.read()
          .then(res => res.done
            ? writer.close()
            : writer.write(res.value).then(pump))

        pump()
}
  
function getSQLite() {
  let exp = db.export();
  downloadFile(exp, "Level.sqlite")
}
  
function downloadSessionLogs() {
  let exp = logs;
  downloadFile(exp, "Logs.txt")
}
  
function extractJSON(shouldReturn) {
  let output = {};
  let tables = ["Zbehaviourdata", "zcameradata", "zcollisiondata", "zeditordata", "zlayerdata", "zleveldata", "zobjectdata", "zobjectposition", "zpathdata", "zprojectdata", "ztiledata", "ztileselectordata", "z_5objects", "z_metadata", "z_modelcache", "z_primarykey"];
  tables.forEach(function(key) {
    try {
      output[key] = db.exec("SELECT * FROM " + key)[0] || {};
    } catch(e) {
      console.error(e);
    }
  })
  if (shouldReturn) {
    return JSON.stringify(output);
  }
  downloadFile(JSON.stringify(output), "Project.json")
}
  
function openMenu() {
  clearTimeout(editTimer);
  hideIds.forEach(function(id) {
    try {
      document.getElementById(id).style.display = "none";
    } catch(e) {};
  })
  try {
    document.getElementById(prevMenu).style.display = "block";
  } catch(e) {
    exitMenu()
  }
  if (prevMenu == "objectEntries") {
    showObjectEntries();
  }
}
  
function behaviorOptions() {
  document.getElementById("behaviorOption").style.display = "block";
  document.getElementById("projectViewer").style.display = "none";
}
  
function downgrade() {
  prevMenu = "behaviorOption";
  document.getElementById("behaviorOption").style.display = "none";
  document.getElementById("downgradeBehaviors").style.display = "block";
}
  
async function downloadResult() {
  // Saving a blob is as simple as the fetch example, you just get the
      // readableStream from the blob by calling blob.stream() to get a
      // readableStream and then pipe it
  		document.getElementById("download").innerHTML = "Downloading";
  		file = blobFile
  		let name = document.getElementById("fileExportName").value;
  		if (name.length == 0) {
          name = "My Project"
        }
  		console.log(name + ".tap")
        const fileStream = streamSaver.createWriteStream(name + '.tap', {
          size: file.size // Makes the procentage visiable in the download
        })

        // One quick alternetive way if you don't want the hole blob.js thing:
        // const readableStream = new Response(
        //   Blob || String || ArrayBuffer || ArrayBufferView
        // ).body
        const readableStream = new Response(file).body;

        // more optimized pipe version
        // (Safari may have pipeTo but it's useless without the WritableStream)
        if (window.WritableStream && readableStream.pipeTo) {
          return readableStream.pipeTo(fileStream)
            .then(() => {
            console.log('done writing');
            document.getElementById("download").innerHTML = "Done!";
          })
        }

        // Write (pipe) manually
        window.writer = fileStream.getWriter()

        const reader = readableStream.getReader()
        const pump = () => reader.read()
          .then(res => res.done
            ? writer.close()
            : writer.write(res.value).then(pump))

        pump()
}
  
function downgradeAction() {
  let startTime = Date.now();
  let version = document.getElementById("targetVersion").value;
  let zname = document.getElementById("targetZName").value;
  let pass = true;
  try {
    JSON.parse(version) + 1;
  } catch(e) {
    throwError("Provided target version is not a valid number")
    pass = false;
  }
  if (!pass) return;
  if (version < 0) {
    throwError("Provided target version cannot be negative")
    pass = false;
    return;
  }
  if (!pass) return;
  
  // search behaviors
  let cmd = "SELECT ZNAME FROM ZBEHAVIOURDATA;"
  if (zname) {
    cmd = "SELECT ZNAME FROM ZBEHAVIOURDATA WHERE ZNAME LIKE " + JSON.stringify(zname + "%");
  }
  let count = 0;
  let updated = 0;
  let d = db.exec(cmd);
  if (d.length == 0) {
    throwError("No behaviors were found with the provided inputs")
    return;
  }
  behaviors = {};
  d[0].values.forEach(function(behavior) {
    count++;
    
    let ver = behavior[0].split(" v");
    if (ver.length <= 1) {
      return;
    }
    ver = ver[ver.length - 1];
    if (parseFloat(version) >= parseFloat(ver)) {
      return;
    }
    updated++;
    behaviors[behavior[0]] = ver;
  });
  
  Object.keys(behaviors).forEach(function(key) {
    let name = key.replace(" v" + behaviors[key], "");
    let cmd = "UPDATE ZBEHAVIOURDATA SET ZNAME = " + JSON.stringify(name);
    cmd += " WHERE ZNAME = " + JSON.stringify(key);
    db.run(cmd);
    console.log(cmd)
  });
  
  let delta = Date.now() - startTime;
  throwSuccess("Successfully downgraded " + updated + " out of " + count + " behaviors (" + delta + "ms)");
  
  if (pass) {
   openMenu();
  }
}
  
var selectedObject;
var editingObjects = [];
var logs = "[SYSTEM] [" + Date.now() + "] Started running script - version " + version;
logs += "\n";
  
function executeDelete() {
  let objectsDestroyed = 0;
  try {
  let cmd = "";
  if (selectedObject !== "selected") {
    cmd = "SELECT Z_PK from ZOBJECTDATA WHERE ZUNIQUEID = " + JSON.stringify(selectedObject) + ";";
    cmd += "DELETE from ZOBJECTDATA WHERE ZUNIQUEID = " + JSON.stringify(selectedObject);
    try {
      let index = db.exec(cmd);
      cmd = "DELETE from ZOBJECTPOSITION WHERE Z_PK = " + index[0].values[0];
      db.run(cmd);
      db.run("DELETE from ZBEHAVIOURDATA WHERE ZOBJECT = " + index[0].values[0]);
      db.run("DELETE from Z_OBJECTS WHERE Z_7OBJECTS = " + index[0].values[0]);
      objectsDestroyed++;
    } catch(e) {throwError("Failed to destroy object: " + e)};
  } else {
    results[0].values.forEach(function(index) {
      
      cmd = "DELETE from ZOBJECTDATA WHERE ZUNIQUEID = " + JSON.stringify(index[1]);
      try {
        let i = db.exec("SELECT Z_PK from ZOBJECTDATA WHERE ZUNIQUEID = " + JSON.stringify(index[1]) + ";")
        db.exec("DELETE from ZOBJECTDATA WHERE ZUNIQUEID = " + JSON.stringify(index[1]));
        db.run("DELETE from ZBEHAVIOURDATA WHERE ZOBJECT = " + i[0].values[0]);
        db.run("DELETE from ZOBJECTPOSITION WHERE ZOBJECTS = " + i[0].values[0]);
        db.run("DELETE from Z_OBJECTS WHERE Z_7OBJECTS = " + i[0].values[0]);
        objectsDestroyed++;
      } catch(e) {};
    })
  }
  } catch(e) {throwError("Failed to destroy objects(s): " + e)};
  
  if (objectsDestroyed == 1) {
    throwSuccess("Successfully destroyed 1 object");
  }
  if (objectsDestroyed > 1) {
    throwSuccess("Successfully destroyed " + objectsDestroyed + " objects")
  }
  
} 

function executeApply() {
  let modCount = Object.keys(modifications).length;
  let objectCount = editingObjects.length;
  let startTime = Date.now();
  let writes = 0;
  let errors = 0;
  editingObjects.forEach(function(objectID) {
    
  	try {
    
    // get z_pk
    cmd = "SELECT Z_PK from ZOBJECTDATA WHERE ZUNIQUEID = " + JSON.stringify(objectID);
    let index = db.exec(cmd);
    let ZPK = index[0].values[0][0];
      
    // loop through each mod
    Object.keys(modifications).forEach(function(mod) {
      let select = mod.split("/")[0];
      let edit = mod.split("/")[1];
      let setTo = modifications[mod]
      let cmd;
      try {
        JSON.parse(setTo) + 1;
      } catch(e) {
        setTo = JSON.stringify(setTo);
      }
      if (select == "ZOBJECTDATA") {
        cmd = "UPDATE ZOBJECTDATA SET " + edit;
        cmd += " = " + setTo;
        cmd += " WHERE ZUNIQUEID = " + JSON.stringify(objectID);
        db.run(cmd);
      } 
      if (select == "ZOBJECTPOSITION") {
        cmd = "UPDATE ZOBJECTPOSITION SET " + edit;
        cmd += " = " + setTo;
        cmd += " WHERE Z_PK = " + ZPK;
        db.run(cmd);
      }
      writes++;
    })
      
      // destroy behaviors if toggled on
      if (document.getElementById("deleteBehaviorsObjects").checked) {
        let cmd = "DELETE FROM ZBEHAVIOURDATA WHERE ZOBJECT = " + ZPK;
        db.run(cmd);
        writes++;
      }
      
    } catch(e) {
      console.error(e);
      errors++;
    };
    
  })
  let delta = Date.now() - startTime;
    throwSuccess("Successfully modified " + modCount + " properties on " + objectCount + " objects - " + writes + " writes (" + delta + "ms) (" + errors + " errors)");
 
}
  
var editTimer;
var modifications = {};  
  
function editObject(objectID = "selected") {
  let data = {};
  let varied = {};
  modifications = {};
  clearTimeout(editTimer);
  modifications = {};
  editTimer = setInterval(function() {
    document.querySelectorAll('.input-object').forEach(function(element) {
      if (!element.getAttribute("textParent")) return;
      // console.log(element.getAttribute("textParent"))
      document.getElementById(element.getAttribute("textParent")).style.color = "white";
      if (varied[element.id] && element.value !== "") {
        document.getElementById(element.getAttribute("textParent")).style.color = "#00bb78";
        modifications[element.id] = element.value;
      }
      
      if (!varied[element.id] && (data[element.id].toString() !== element.value.toString())) {
        // console.log(data[element.id], element.value)
        document.getElementById(element.getAttribute("textParent")).style.color = "#00bb78";
        modifications[element.id] = element.value;
      }
      
    });
  }, 100)
  
  // initialize input fields
  document.querySelectorAll('.input-object').forEach(function(element) {
    element.setAttribute("value", "?");
    element.setAttribute("placeholder", "0");
    element.value = "?";
    element.placehodler = "0";
  });
  document.getElementById("ZOBJECTDATA/ZPHYSICS_MODE").value = "";
  document.getElementById("ZOBJECTDATA/ZOBJECTTYPE").value = "";
  document.getElementById("ZOBJECTDATA/ZCOLLIDABLE").value = "";
  document.getElementById("ZOBJECTDATA/ZLOCKED").value = "";
  document.getElementById("ZOBJECTDATA/ZFLIPX").value = "";
  document.getElementById("ZOBJECTDATA/ZFLIPY").value = "";
  
  selectedObject = objectID;
  editingObjects = [];
  if (objectID !== "selected") {
    editingObjects.push(objectID);
  }
  document.getElementById("objectSelector").style.display = "none";
  document.getElementById("objectEntries").style.display = "none";
  document.getElementById("objectEditor").style.display = "block";
  let fileHeader = "No object selected."
  document.getElementById("selectedObject").innerHTML = fileHeader;
  if (objectID == "selected") {
    
    if (!results[0]) {
      throwError("Failed to load object data: No object is selected")
    }
    
    let entryCount = results[0].values.length;
    results[0].values.forEach(function(index) {
      editingObjects.push(index[1])
    })
 	
    fileHeader = "Editing " + entryCount + " entries -> " +
 "<b style='color:#989898'> Querying " + document.getElementById("searchQuery").value + "</b>";
  } else {
    fileHeader = "<b style='color:#989898'>Object ID: </b>" + objectID;
  }
  document.getElementById("selectedObject").innerHTML = fileHeader;
  
  // load data
  
  editingObjects.forEach(function(objectID) {
    
    try {
    
    cmd = "SELECT * from ZOBJECTDATA WHERE ZUNIQUEID = " + JSON.stringify(objectID);
    let index = db.exec(cmd);
      let i = 0;
      
    index[0].columns.forEach(function(key) {
      let id = "ZOBJECTDATA/" + key;
      try {
        let value = index[0].values[0][i];
        let element = document.getElementById(id)
        if (element.getAttribute("isPercentage") || element.isPercentage) {
          value = value * 100;
        }
        
        if (data[id] == undefined) {
          data[id] = value;
        } else if (data[id] !== value || varied[id]) {
          
          value = "";
          varied[id] = true;
          element.setAttribute("placeholder", "Mixed");
          element.placeholder = "Mixed";
        }
        element.setAttribute("value", value);
        element.value = value;
      } catch(e) {};
      i++;
    });
    cmd = "SELECT * from ZOBJECTPOSITION WHERE Z_PK = " + index[0].values[0][0];
    // console.log(cmd);
    db.run(cmd);
    index = db.exec(cmd);
    i = 0;
    index[0].columns.forEach(function(key) {
      let id = "ZOBJECTPOSITION/" + key;
      try {
        let value = index[0].values[0][i];
        let element = document.getElementById(id)
        if (element.getAttribute("isPercentage") || element.isPercentage) {
          value = value * 100;
        }
        // console.log(data[id])
        if (data[id] == undefined) {
          data[id] = value;
          console.log(value)
        } else if (data[id] !== value || varied[id]) {
          value = "";
          varied[id] = true;
          element.setAttribute("placeholder", "Mixed");
          element.placeholder = "Mixed";
        }
        element.setAttribute("value", value);
        element.value = value;
      } catch(e) {};
      i++;
    });
      
    } catch(e) {};
     
  });
  
}
  
function showObjectEntries() {
  let fileHeader = 0 + " entries -> " +
 "<b style='color:#989898'> Querying " + document.getElementById("searchQuery").value + "</b>";
  document.getElementById("objectEntryText").innerHTML = fileHeader;
  document.getElementById("objectList").innerHTML = "No results to display."
  performQuery();
  document.getElementById("objectSelector").style.display = "none";
  document.getElementById("objectEntries").style.display = "block"; 
  let o = "";
  let entryCount = results[0].values.length;
  fileHeader = entryCount + " entries -> " +
 "<b style='color:#989898'> Querying " + document.getElementById("searchQuery").value + "</b>";
  document.getElementById("objectEntryText").innerHTML = fileHeader;
  prevMenu = "objectEntries";
  results[0].values.forEach(function(entry) {
    o += "<b style='color: #00bb78'>" + entry[0] + "</b>";
    o += "<span style='color: #c2c2c2'> (" + entry[2] + ") </span><br>";
    o += entry[1] + "<br>";
    o += "<a style='color: #edd465' onclick='inspectObject(\"";
    o += entry[1] + "\",\"" + entry[0] + "\")'> [Inspect Object] </a>";
    o += "<a style='color: #ff6060' onclick='editObject(\"";
    o += entry[1] + "\")'> [Actions] </a> <br>";
    o += "<br>";
  })
  document.getElementById("objectList").innerHTML = o;
}
  
function exitObjectEntries() {
  document.getElementById("objectSelector").style.display = "block";
  document.getElementById("objectEntries").style.display = "none";
  clearTimeout(editTimer);
}
  
function saveSceneEdit() {
  let sceneToEdit = document.getElementById("sceneName").innerHTML;
  let sceneName = document.getElementById("sceneNameInput").value;
  let sceneMode = document.getElementById("sceneMode").value;
  let sceneType = document.getElementById("sceneType").value;
  let scenePreload = document.getElementById("scenePreload").value;
  let sceneIndex = document.getElementById("sceneIndex").value;
  let sceneWidth = document.getElementById("sceneWidth").value;
  let sceneHeight = document.getElementById("sceneHeight").value;
  let cmd;
  
  // update mode
  cmd = "UPDATE ZLevelData SET ZLevelMode = ";
  cmd += JSON.stringify(sceneMode);
  cmd += " WHERE ZLevelName = " + JSON.stringify(sceneToEdit);
  db.run(cmd);
  
  // update type
  cmd = "UPDATE ZLevelData SET ZSceneType = ";
  cmd += JSON.stringify(sceneType);
  cmd += " WHERE ZLevelName = " + JSON.stringify(sceneToEdit);
  db.run(cmd);
  
  // update zoom
  cmd = "UPDATE ZLevelData SET ZScale = ";
  cmd += JSON.stringify(document.getElementById("sceneZoom").value);
  cmd += " WHERE ZLevelName = " + JSON.stringify(sceneToEdit);
  db.run(cmd);
  
  // update camera
  cmd = "UPDATE ZLevelData SET ZCamera = ";
  cmd += JSON.stringify(document.getElementById("sceneCamera").value);
  cmd += " WHERE ZLevelName = " + JSON.stringify(sceneToEdit);
  db.run(cmd);
  
  // update x pos
  cmd = "UPDATE ZLevelData SET ZX_POS = ";
  cmd += JSON.stringify(document.getElementById("xPos").value);
  cmd += " WHERE ZLevelName = " + JSON.stringify(sceneToEdit);
  db.run(cmd);
  
  // update y pos
  cmd = "UPDATE ZLevelData SET ZY_POS = ";
  cmd += JSON.stringify(document.getElementById("yPos").value);
  cmd += " WHERE ZLevelName = " + JSON.stringify(sceneToEdit);
  db.run(cmd);
  
  // update preload
  cmd = "UPDATE ZLevelData SET ZPreload = ";
  cmd += JSON.stringify(scenePreload);
  cmd += " WHERE ZLevelName = " + JSON.stringify(sceneToEdit);
  db.run(cmd);
  
  // update index
  cmd = "UPDATE ZLevelData SET ZIndex = ";
  cmd += JSON.stringify(sceneIndex);
  cmd += " WHERE ZLevelName = " + JSON.stringify(sceneToEdit);
  db.run(cmd);
  
  // update width
  cmd = "UPDATE ZLevelData SET ZWidth = ";
  cmd += JSON.stringify(sceneWidth);
  cmd += " WHERE ZLevelName = " + JSON.stringify(sceneToEdit);
  db.run(cmd);
  
  // update height
  cmd = "UPDATE ZLevelData SET ZHeight = ";
  cmd += JSON.stringify(sceneHeight);
  cmd += " WHERE ZLevelName = " + JSON.stringify(sceneToEdit);
  db.run(cmd);
  
  // update name
  cmd = "UPDATE ZLevelData SET ZLevelName = ";
  cmd += JSON.stringify(sceneName);
  cmd += " WHERE ZLevelName = " + JSON.stringify(sceneToEdit);
  db.run(cmd);
  throwSuccess("Successfully modified layer.");
  return;
}
  
function exitMenu() {
  clearTimeout(queryTimer)
  try {
  	hideIds.forEach(function(id) {
  	  document.getElementById(id).style.display = "none";
  	});
  } catch(e) {};
  document.getElementById("projectViewer").style.display = "block";
  document.getElementById("projectOptions").style.display = "block";
}
  var expanded = false;
  function expand() {
    if (!expanded) {
      document.getElementById("expand").innerHTML = " [Close]"
      document.getElementById("more").style.display = "block";
      expanded = true;
    } else {
      document.getElementById("expand").innerHTML = " [Expand]"
      document.getElementById("more").style.display = "none";
      expanded = false;
    }
  }
  
  var expandAdv = {};
  function expandAdvanced(id) {
    if (!expandAdv[id]) {
      document.getElementById(id).innerHTML = " [Close]"
      document.getElementById("adv-" + id).style.display = "block";
      expandAdv[id] = true;
    } else {
      document.getElementById(id).innerHTML = " [Expand]"
      document.getElementById("adv-" + id).style.display = "none";
      expandAdv[id] = false;
    }
  }
  
  async function inspectObject(objectID, objectName) {
    document.getElementById("objectEntries").style.display = "none";
    document.getElementById("objectInspector").style.display = "block";
    document.getElementById("objectID").innerHTML = objectID;
    document.getElementById("objectName").innerHTML = objectName;
    let object = db.exec("SELECT * from ZOBJECTDATA WHERE ZUNIQUEID = " + JSON.stringify(objectID));
    let results = {};
    let i = 0;
    object[0].columns.forEach(function(row) {
      results[row] = object[0].values[0][i];
      i++;
    });
    let object2 = db.exec("SELECT * from ZOBJECTPOSITION WHERE Z_PK = " + object[0].values[0][0]);
    let results2 = {};
    i = 0;
    object2[0].columns.forEach(function(row) {
      results2[row] = object2[0].values[0][i];
      i++;
    });
    let s = "<b style='color:#6abfff; text-decoration-line: underline;'>ZOBJECTPOSITION</b><br>";                    
    Object.keys(results2).forEach(function(key) {
      if (key == "ZGAMEOBJECTDATA") {
        gamedata = results2[key];
        return;
      }
      s += "<b style='color:#00bb78'>";
      s += key + ": ";
      s += "</b>";
      s += results2[key];
      s +="<br>"
    });
    s += "<br>";
                          
    s += "<b style='color:#ffda6e; text-decoration-line: underline;'>ZOBJECTDATA</b><br>";
    console.log(results);
    Object.keys(results).forEach(function(key) {
      if (key == "ZGAMEOBJECTDATA") {
        gamedata = results[key];
        return;
      }
      s += "<b style='color:#00bb78'>";
      s += key + ": ";
      s += "</b>";
      s += results[key];
      s +="<br>"
    });
    s += "<br>";
    s += "<b style='color:#ff7a71; text-decoration-line: underline;'>Object Gamedata</b><br>";
    gamedata = JSON.stringify(await extract(Buffer.from(gamedata)), null, "  ");
    s += "<p style='white-space:wrap; word-wrap: break-word;'>" + gamedata + "</p>";
    document.getElementById("objectData").innerHTML = s;
  }
  
  function closeObjectInspector(objectID) {
    document.getElementById("objectEntries").style.display = "block";
    document.getElementById("objectInspector").style.display = "none";
  }
  
  function selectScene(scene) {
    document.getElementById("sceneName").innerHTML = scene;
    document.getElementById("sceneSelector").style.display = "none";
    document.getElementById("sceneEditor").style.display = "block";
    document.getElementById("sceneNameInput").value = scene;
    let index = db.exec("SELECT ZLevelMode, ZSceneType, ZPreload, ZIndex, ZWidth, ZHeight, ZScale, ZCamera, ZX_Pos, ZY_Pos FROM ZLevelData WHERE ZLevelName = " + JSON.stringify(scene));
    document.getElementById("sceneMode").value = index[0].values[0][0];
    document.getElementById("sceneType").value = index[0].values[0][1];
    document.getElementById("scenePreload").value = index[0].values[0][2];
    document.getElementById("sceneIndex").value = index[0].values[0][3];
    document.getElementById("sceneWidth").value = index[0].values[0][4];
    document.getElementById("sceneHeight").value = index[0].values[0][5];
    document.getElementById("sceneZoom").value = index[0].values[0][6];
    document.getElementById("sceneCamera").value = index[0].values[0][7];
    document.getElementById("xPos").value = index[0].values[0][8];
    document.getElementById("yPos").value = index[0].values[0][9];
  }
 
  
function resetQuery() {
  document.getElementById("caseSensitive").value = "case";
  document.getElementById("searchQuery").value = "ZNAME";
  document.getElementById("searchCondition").value = "=";
  document.getElementById("limit").value = "";
  document.getElementById("query").value = "";
}
  
function performQuery() {
   
  // get object count
  document.getElementById("searchCount").innerHTML = "0 objects";
  results = "none";
  
  try {
  let objects = db.exec("SELECT ZOBJECTTYPE from ZOBJECTDATA");
  let objectCount = objects[0].values.length;
  let e = 0;
  
  // query
  let query = "";
  let upper = "";
  let upperEnd = "";
  if (document.getElementById("caseSensitive").value == "no-case") {
    let c = document.getElementById("searchQuery").value;
    if (!(c == "Z_ZINDEX" || c == "ZMASS" || c == "ZZFRICTION" || c == "ZFLIPX" || c == "ZFLIPY" || c == "ZLOCKED" || c == "ZCOLLIDABLE")) {
      upper = "UPPER("
      upperEnd = ")";
    }
  }

  query += " WHERE " + upper + document.getElementById("searchQuery").value + upperEnd;
  query += " " + document.getElementById("searchCondition").value;
  let value = document.getElementById("query").value;
  let isString = false;
  let percent = "";
  if (document.getElementById("searchCondition").value.includes("like")) {
    percent = "%";
  }
  try {
    JSON.parse(value) + 1;
  } catch(e) {
    isString = true;
  }
  if (isString) {
    if (document.getElementById("caseSensitive").value == "no-case") {
      value = value.toUpperCase();
    }
    value = JSON.stringify(percent + value + percent)
  }
  query += " " + value;
  if (document.getElementById("limit").value) {
    query += " LIMIT " + (parseInt(document.getElementById("limit").value) || 0);
  }
  
  // console.log(query)
  whereQuery = query;
  query = "SELECT ZNAME, ZUNIQUEID, ZOBJECTTYPE from ZOBJECTDATA " + query;
  
  results = db.exec(query);
  try {
  	e = results[0].values.length;
  } catch(e) {};
  
  let r = e + " entries out of " + objectCount + " objects";
  document.getElementById("searchCount").innerHTML = r;
  } catch(e) {};
}
  
  var queryTimer;
function modObjects() {
  document.getElementById("projectViewer").style.display = "none";
  document.getElementById("objectSelector").style.display = "block";
  performQuery();
  queryTimer = setInterval(function() {
    performQuery();
  }, 1000)
  
}
  
function editSceneData() {
  document.getElementById("projectViewer").style.display = "none";
  document.getElementById("sceneSelector").style.display = "block";
  // get level count
  let level = db.exec("SELECT ZLevelName from ZLevelData");
  let levels = [];
  let str = "";
  level[0].values.forEach(function(index) {
    levels.push(index[0]);
    let scene = index[0];
    str += '<a class="button" style="width:95%; margin-bottom: 6px;" onclick="selectScene(\'' + scene;
    str += "')\">" + index[0] + "</a>";
  })
  let levelCount = levels.length;
  document.getElementById("sceneList").innerHTML = str;
}
  
function viewProjectData() {
  expandAdv = {};
  document.getElementById("projectViewer").style.display = "none";
  document.getElementById("projectData").style.display = "block";
  
  // get behavior count
  let behaviors = db.exec("SELECT ZISRoot, ZName from ZBEHAVIOURDATA");
  let behaviorCount = behaviors[0].values.length;
  let rootBehaviors = 0;
  let bTypes = {};
  behaviors[0].values.forEach(function(arr) {
    rootBehaviors += parseInt(arr[0]) || 0;
    bTypes[arr[1]] = bTypes[arr[1]] || 0;
    bTypes[arr[1]]++;
  });
			
  // get object count
  let objects = db.exec("SELECT ZOBJECTTYPE from ZOBJECTDATA");
  let objectCount = objects[0].values.length;
  let oType = {};
  objects[0].values.forEach(function(arr) {
    oType[arr[0]] = oType[arr[0]] || 0;
    oType[arr[0]]++;
  });
            
  // get asset count
  let paths = db.exec("SELECT ZASSETTYPE, ZPATH from ZPATHDATA");
  let assetCount = paths[0].values.length;
  let aType = {};
  let aFiles = {};
  paths[0].values.forEach(function(arr) {
    aType[arr[0]] = aType[arr[0]] || 0;
    aType[arr[0]]++;
    aFiles[arr[0]] = aFiles[arr[0]] || [];
    aFiles[arr[0]].push(arr[1]);
  });
            
  // get layer count
  let layerData = db.exec("SELECT ZIndex, ZName from ZLAYERDATA");
  let layersCount = 0;
  let layers = {};
  layerData[0].values.forEach(function(index) {
    layers[index[0]] = index[1];
  })
  layersCount = Object.keys(layers).length;
  
  // get level count
  let level = db.exec("SELECT ZLevelName from ZLevelData");
  let levels = [];
  level[0].values.forEach(function(index) {
    levels.push(index[0]);
  })
  let levelCount = levels.length;
  
  // display
  let display = "";
  let add = function(title, end, color = "#00bb78", newline = true) {
    display += "<b style='color:" + color + "'>" + title + "</b> " + end;
    if (newline) {
      display += "<br>";
    }
  }
  add("Total Behaviors: ", behaviorCount);
  add("  ➤ Root Behaviors: ", rootBehaviors, "#a3d3a5");
  add("  ➤ Non-Root Behaviors: ", behaviorCount - rootBehaviors, "#a3d3a5");
  add("  ➤ Unique Behavior Types: ", Object.keys(bTypes).length, "#a3d3a5", false);
  display += "<a onclick='expand()' style='color:#00bb78' id='expand'> [Expand]</a> <br>"
  display += '<span id="more">';
  Object.keys(bTypes).forEach(function(behavior) {
    add("    " + behavior + ": ", bTypes[behavior], "#c1c1c1");
  });
  display += "</span>";
  
  add("Total Objects: ", objectCount);
  Object.keys(oType).forEach(function(key){
    add("  ➤ " + key + " Objects: ", oType[key], "#a3d3a5");
  })
  add("Total Assets: ", assetCount);
  Object.keys(aType).forEach(function(key){
    add("  ➤ " + key + ": ", aType[key], "#a3d3a5", false);
    display += "<a id='" + key + "' onclick='expandAdvanced(\"" + key + "\")' style='color:#00bb78'> [Expand]</a> <br>"
    display += '<span style="display: none" id="adv-' + key + '">';
    Object.keys(aFiles[key]).forEach(function(type) {
      add("    " + aFiles[key][type], "", "#c1c1c1");
  	});
    display += '</span>';
  })
  add("Total Layers: ", layersCount);
  add("  ➤ Layer 1: ", "Global", "#a3d3a5");
  add("  ➤ Layer 2: ", "Scene", "#a3d3a5");
  Object.keys(layers).forEach(function(key){
    if (key < 0) return;
    add("  ➤ Layer " + (parseInt(key) + 3) + ": ", layers[key], "#a3d3a5");
  })
  
  add("Total Scenes: ", levelCount);
  levels.forEach(function(key){
    add("  ➤ " + key, "", "#a3d3a5");
  })
  document.getElementById("projectDetails").innerHTML = display;
}
  
  const popIn = [
    {
      opacity: 0,
      transform: "scale(0, 0)"
    },
    {
      opacity: 1,
      transform: "scale(1, 1)"
    }
  ];
  const optionsPopIn = {
    duration: 400,
    easing: "cubic-bezier(0,0.5,0,1)"
  }
  
  function throwError(msg) {
    document.getElementById("error").style.display = "block";
    document.getElementById("error").style["background-color"] = "#ff5a5a";
    document.getElementById("error msg").innerHTML = msg;
    document.getElementById("error").animate(popIn, optionsPopIn);
    let str = ["[Error] [", Date.now(), "] ", msg].join("");
    logs += str + "\n";
    console.error(msg);
  }
  
  function throwSuccess(msg) {
    document.getElementById("error").style.display = "block";
    document.getElementById("error").style["background-color"] = "#00BB78";
    document.getElementById("error msg").innerHTML = msg;
    document.getElementById("error").animate(popIn, optionsPopIn);
    let str = ["[Success] [", Date.now(), "] ", msg].join("");
    logs += str + "\n";
    console.info(msg);
  }
  
  function hideAlert() {
    document.getElementById("error").style.display = "none";
  }
  
 
  const wait = function(seconds) {
  return new Promise((resolve) => {
  	setTimeout(function() {resolve("yeet")}, seconds * 1000);
  })
  
};
</script>

<!-- ANIMATIONS -->
<script>

var plane1 = "https://firebasestorage.googleapis.com/v0/b/hyperpad-discord-marketplace.appspot.com/o/animations%2Fplane%2F419BCA2F-B839-4E93-9ECD-2BBF631153F0.png?alt=media&token=b8f005ce-96df-4c3a-9f7c-408c536e13fb";
var plane2 = "https://firebasestorage.googleapis.com/v0/b/hyperpad-discord-marketplace.appspot.com/o/animations%2Fplane%2FB3702334-56B5-4022-867B-545231F5A672.png?alt=media&token=0fc2a319-9589-46a2-8457-e1ae11afdef3"
var plane3 = "https://firebasestorage.googleapis.com/v0/b/hyperpad-discord-marketplace.appspot.com/o/animations%2Fplane%2FFED2714D-5E6F-45A6-B602-83017B47E368.png?alt=media&token=5b051fb5-018c-4042-8f87-5c35cae6042e"

</script>
