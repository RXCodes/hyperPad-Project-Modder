<meta charset="utf8" />
<html>
<script src='https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.6.2/sql-wasm.js'></script>
<script>
  config = {
    locateFile: (filename, prefix) => {
      return 'https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.6.2/sql-wasm.wasm';
    }
  }
  
  var SQL;
  var db;
  async function start() {
    SQL = await initSqlJs(config)
    console.info("Initialized SQL Module!")
  }
  start();
  
</script>

</html> 

<html>
  <head>
    <meta name="viewport" content="width=320, initial-scale=1">
    <meta charset="utf-8">
    <script src="https://hyperpad-compiler.robinsonx.repl.co/jszip"></script>
    <script src="https://hyperpad-compiler.robinsonx.repl.co/lz-string"></script>
    
    <style>
      body, html {
        min-width: 100%;
        min-height: 100%;
        margin: 0;
        padding: 0;
        font-family: Helvetica 14px;
        background-color: #393939;
        overflow: hidden;
      }
      
      input[type="file"] {
        display: none;
      }
      
      .input-field {
        height: 30px;
        font-size: 20px;
        background-color: #252525;
        color: white;
        width: 95%;
        margin-left: 2.5%;
        margin-right: 2.5%;
        border-radius: 5px;
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
      }
      
       .alert {
        position: absolute;
        top: 0px;
        padding: 14px;
        background-color: #e63c3c; /* Red */
        color: white;
        font-weight: medium;
        margin-bottom: 15px;
        width: calc(100% - 44px);
        margin: 8px;
        box-shadow: 0px 5px rgba(0,0,0,.25);
        display: none;
      }

      /* The close button */
      .closebtn {
        margin-left: 15px;
        color: white;
        font-weight: bold;
        float: right;
        font-size: 22px;
        line-height: 20px;
        cursor: pointer;
        transition: 0.3s;
      }

      /* When moving the mouse over the close button */
      .closebtn:hover {
        color: black;
      }
      
      select {
        height: 30px;
        font-size: 20px;
        border-width: 0px;
        background-color: #252525;
        color: white;
        width: 95%;
        margin-left: 2.5%;
        margin-right: 2.5%;
        border-radius: 5px;
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
      }
      
      .button {
        background-color: #00bb78;
        border-radius: 5px;
        display: block;
        position: relative;
        text-decoration: none;
        color:white;
        font-family: 'Helvetica';
        text-align: center;
        font-size: 20px;
        font-weight: bold;
        padding: 5px;
        margin: auto;
        bottom: -8px;
        height: 25px; 
        text-decoration: none;
        width: 10%;
        min-width: 125px;
        overflow: hidden;
      }
      
      .lds-ring {
          margin: auto;
          position: block;
          width: 80px;
          height: 80px;
        }
        .lds-ring div {
          box-sizing: border-box;
          display: block;
          position: absolute;
          width: 60px;
          height: 60px;
          margin: 8px;
          border: 7px solid #00BB78;
          border-radius: 50%;
          animation: lds-ring 1.2s cubic-bezier(0.5, 0, 0.5, 1) infinite;
          border-color: #00BB78 transparent transparent transparent;
        }
        .lds-ring div:nth-child(1) {
          animation-delay: -0.45s;
        }
        .lds-ring div:nth-child(2) {
          animation-delay: -0.3s;
        }
        .lds-ring div:nth-child(3) {
          animation-delay: -0.15s;
        }
        @keyframes lds-ring {
          0% {
            transform: rotate(0deg);
          }
          100% {
            transform: rotate(360deg);
          }
        }
      
      canvas {
        display: none;
        height: 100%;
        margin: auto;
        background-color: transparent;
      }
      
      #more {display: none;}
      
      .more {display: none;}
      
      #importMenu {
        background-color: #5a5a5a;
        padding: 15px; 
        width: 300px;
        height: 70px;
        border-radius: 10px;
        margin: auto;
        margin-top: calc(50vh - 40px);
      }
      
      #projectData {
        display: none;
        background-color: #5a5a5a;
        padding: 15px; 
        width: 450px;
        height: 400px;
        border-radius: 10px;
        margin: auto;
        margin-top: calc(50vh - 200px);
      }
      
      #downloadMenu {
        background-color: #5a5a5a;
        padding: 15px; 
        width: 300px;
        height: 100px;
        border-radius: 10px;
        margin: auto;
        margin-top: calc(50vh - 60px);
        display: none;
      }
      
      #errorMenu {
        background-color: #5a5a5a;
        padding: 15px; 
        width: 300px;
        height: 120px;
        border-radius: 10px;
        margin: auto;
        margin-top: calc(50vh - 60px);
        display: none;
      }
      
      #projectViewer {
        background-color: #5a5a5a;
        padding: 15px; 
        width: 300px;
        height: 365;
        border-radius: 10px;
        margin: auto;
        margin-top: calc(50vh - 200px);
        display: none;
      }
      
      #behaviorOptions {
        background-color: #5a5a5a;
        padding: 15px; 
        width: 300px;
        height: 330px;
        border-radius: 10px;
        margin: auto;
        margin-top: calc(50vh - 150px);
        display: none;
      }
      
       #sceneSelector {
        background-color: #5a5a5a;
        padding: 15px; 
        width: 300px;
        height: 330px;
        border-radius: 10px;
        margin: auto;
        margin-top: calc(50vh - 150px);
        display: none;
      }
      
      #sceneEditor {
        background-color: #5a5a5a;
        padding: 15px; 
        width: 300px;
        height: 330px;
        border-radius: 10px;
        margin: auto;
        margin-top: calc(50vh - 150px);
        display: none;
      }
      
      #downgradeBehaviors {
        background-color: #5a5a5a;
        padding: 15px; 
        width: 300px;
        height: 330px;
        border-radius: 10px;
        margin: auto;
        margin-top: calc(50vh - 150px);
        display: none;
      }
      
      #objectSelector {
        background-color: #5a5a5a;
        padding: 15px; 
        width: 350px;
        height: 370px;
        border-radius: 10px;
        margin: auto;
        margin-top: calc(50vh - 200px);
        display: none;
      }
      
      #objectInspector {
        background-color: #5a5a5a;
        padding: 15px; 
        width: 300px;
        height: 330px;
        border-radius: 10px;
        margin: auto;
        margin-top: calc(50vh - 150px);
        display: none;
      }
      
      #objectEditor {
        background-color: #5a5a5a;
        padding: 15px; 
        width: 350px;
        height: 335px;
        border-radius: 10px;
        margin: auto;
        margin-top: calc(50vh - 155px);
        display: none;
      }
      
      #objectEntries {
        background-color: #5a5a5a;
        padding: 15px; 
        width: 350px;
        height: 450px;
        border-radius: 10px;
        margin: auto;
        margin-top: calc(50vh - 225px);
        display: none;
      }
      
      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }
      
      [id='limit']::placeholder { /* Chrome, Firefox, Opera, Safari 10.1+ */
  color: #ff60f7;
  opacity: 1; /* Firefox */
}

[id='limit']:-ms-input-placeholder { /* Internet Explorer 10-11 */
  color: #ff60f7;
}
ff60f7
[id='limit']::-ms-input-placeholder { /* Microsoft Edge */
  color: #ff60f7;
}
      
      #iconImg {
        animation-name: fadeIn;
        animation-duration: 1s;
        border-radius: 5px;
        margin: auto;
        overflow: hidden
      }
      
      input {
        visibility: none;
        border-width: 0px;
        height: 20px;
      }
      
      .custom-file-upload {
        background-color: #00BB78;
        border-radius: 5px;
        display: block;
        position: relative;
        text-decoration: none;
        color:white;
        font-family: 'Helvetica';
        text-align: center;
        font-size: 20px;
        font-weight: bold;
        padding: 5px;
        margin: auto;
        bottom: -8px;
        height: 25px; 
        text-decoration: none;
        width: 10%;
        min-width: 125px;
        overflow: hidden;
      }
      
      .backgroundScroll {
        padding: 8px;
        background-color: #515151;
        border-radius: 10px;
      }

      p {
        color: white;
        font-family: Helvetica;
        font-size: 15px;
        margin: auto;
        text-align: center;
      }
      h {
        color: white;
        font-family: Helvetica;
        margin: auto;
        text-align: center;
        font-size: 20px;
        width: 100%;
        font-weight: bold;
      }
      
    </style>
    <!--<link rel="stylesheet" href="style.css"/>-->
    <!--<script defer src="script.js"></script>-->
  </head>

  <body>
    
    <!-- ERROR POPUP -->
    <div class="alert" id="error" style="z-index: 99999">
  <span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span> 
 <p id="error msg" style="margin: 0px; z-index: 999">
   Error msg
      </p>
</div>
    
    
    <div id="importMenu">
      <p>
        Import your hyperPad project now! <b style="color:rgba(174,174,174,.98)">(.tap)</b>
      </p>
      
    <label class="custom-file-upload">
    <input type="file" id="file-selector" accept=".tap, .zip">
      Import File
      </label>
      
    </div>
    
    <div id="errorMenu">
        <h>Error</h>
      <div style="height: 2px; background-color: white; width: 95%; margin-bottom: 10px; margin-top: 2.5px">
        
      </div>
      <p>
        The imported file is not a hyperPad project. Please import a valid hyperPad project.
      </p>
      <a class="button" onclick="returnToMain();">Go back</a>
      
    </div>
    
    <div id="projectViewer">
      <h style="color:#00BB78" id="projectName">Project</h>
      <p style="color:#c0c0c0; text-align:left; font-size: 12px; margin-bottom: 5px" id="fileName">
        ...
      </p>
      <div style="height: 2px; background-color: white; width: 100%; margin-bottom: 10px;"></div>
      
      <div id="projectOptions">
      <p style="width: 100%; height: 20px; margin-bottom: 3px; overflow: hidden" id="projectDataText">
        What would you like to do?
      </p>

      <a class="button" style="width:95%; margin-bottom: 6px; background-color:grey">
        Manage Plugins
      </a>
      <a class="button" style="width:95%; margin-bottom: 6px; background-color:grey">
        Compress Assets
      </a>
      <a class="button" style="width:95%; margin-bottom: 6px" onclick="behaviorOptions()">
        Modify Behaviors
      </a>
      <a class="button" style="width:95%; margin-bottom: 6px" onclick="modObjects()">
        Modify Objects
      </a>
      <a class="button" style="width:95%; margin-bottom: 6px" onclick="editSceneData()">
        Edit Scene Data
      </a>
      <a class="button" style="width:95%; margin-bottom: 6px;" onclick="viewProjectData()">
        View Project Data
      </a>
      <a class="button" style="width:95%; margin-bottom: 6px;" onclick="finish()">
        Download Project
      </a>
</div>
      
        <div class="loading backgroundScroll" id="loading" style="display: none; margin-top: 20px; z-index: 99; height: 75%">
          <p style="margin-bottom: 10px">
            Compiling Project...
          </p>
    <div class="lds-ring"><div></div><div></div><div></div><div></div></div>
          <div>
            <p style="margin-top: 10px; height: 70px; overflow-y: hidden" id="currentFile">
            Compiling Project...
          </p>
            <div style="height: 45px">
              
            </div>
          <div id="progressBar" style="height: 5px; bottom: 0px; width: 100%; background-color: #2f2f2f; margin-top: 5px; border-radius: 2px;">
        <div id="progress" style="height: 5px; bottom: 0px; left: 0px; width: 0%; background-color: #00BB78; border-radius: 2px">
        </div>
      </div>
      <p id="processTooltip" style="margin: 5px">
        Loading Images...
      </p>
            </div>
</div> 
      
      <div id="icon" style="display: none; width: 100%;">
      <div style="width: 85%; background-color:#4a4a4a; border-radius: 5px; margin: auto; margin-top: 5px; overflow: hidden">
        <img style="display: none; width: 100%;" id="iconImg">
      </div>
      </div>
      <a id="download" class="button" style="display: none; text-align: center; float:left; width:45%" onclick="downloadResult()">Download</a>
      <a class="button" onclick="exitMenu();" id="downloadBack" style="display:none; float:right; width:45%">Go back</a>
    </div>
    
    
    <!-- Project data -->
    <div id="projectData">
      <h style="color:#00bb78">Project Details</h>
      <p style="color:#c0c0c0; text-align:left; font-size: 12px; margin-bottom: 5px" id="fileName2">
        Here's what we've found so far.
      </p>
      <div style="height: 2px; background-color: white; width: 100%; margin-bottom: 10px;"></div>
      <div>
        
      </div>
      
      <div style="height: 288px; overflow-y: scroll" class="backgroundScroll">
        <p id="projectDetails" style="text-align:left">
        Loading...
      </p>
      </div>
      <a class="button" style="min-width:38%; margin-bottom: 6px; float: left" onclick="getSQLite()">
        Get SQLite File
      </a>
      <a class="button" style="min-width:32%; margin-left: 7px; margin-bottom: 6px; float: left" onclick="extractJSON()">
        Extract JSON
      </a>
      <a class="button" style="min-width:20%; margin-bottom: 6px; float: right" onclick="exitMenu()">
        Close
      </a>
    </div>
    
    <!-- Select Scene -->
    <div id="sceneSelector">
      <h style="color:#00bb78">Select Scene</h>
      <p style="color:#c0c0c0; text-align:left; font-size: 12px; margin-bottom: 5px" id="fileName3">
        Here's what we've found so far.
      </p>
      <div style="height: 2px; background-color: white; width: 100%; margin-bottom: 10px;"></div>
      <div>
        <div style="height: 218px; overflow-y: scroll" class="backgroundScroll">
        <p id="sceneList" style="text-align:center">
        Loading...
      </p>
      </div>
      <a class="button" style="width:95%; margin-bottom: 6px;" onclick="exitMenu()">
        Close
      </a>
      </div>
    </div>
    
        <!-- Edit Level Data -->
    <div id="sceneEditor">
      <h style="color:#00bb78" id="sceneName">Edit Scene Data</h>
      <p style="color:#c0c0c0; text-align:left; font-size: 12px; margin-bottom: 5px" id="fileName4">
        Here's what we've found so far.
      </p>
      <div style="height: 2px; background-color: white; width: 100%; margin-bottom: 10px;"></div>
      <div>
        <div style="height: 218px; overflow-y: scroll" class="backgroundScroll">
        
          <p>
            Scene Name
          </p>
          <input type="text" class="input-field" id="sceneNameInput" style="margin-bottom: 5px">
          
          <div style="width:50%; float:left; margin-bottom: 5px">
            <p>
            Scene Mode
          </p>
          <input type="number" class="input-field" id="sceneMode" style="color:#83ffac">
          </div>
          <div style="width:50%; float:right; margin-bottom: 5px">
            <p>
            Scene Type
          </p>
            <select name="Scene Type" id="sceneType" style="color:#c4a3ff">
  <option value="0">Level</option>
  <option value="1">Overlay</option>
</select>
          </div>
          <div style="width:50%; float:left; margin-bottom: 5px">
            <p>
            Index
          </p>
          <input type="number" class="input-field" id="sceneIndex" style="color:#ffeb87">
          </div>
          <div style="width:50%; float:right; margin-bottom: 5px">
            <p>
            Preloading
          </p>
            <select name="Scene Preload" id="scenePreload" style="color:#ffafaf">
  <option value="1">Enabled</option>
  <option value="0">Disabled</option>
</select>
          </div>
          <div style="width:50%; float:left; margin-bottom: 5px">
            <p>
            Scene Width
          </p>
          <input type="number" class="input-field" id="sceneWidth" style="color:#a4d9ff">
          </div>
          <div style="width:50%; float:right; margin-bottom: 5px">
            <p>
            Scene Height
          </p>
          <input type="number" class="input-field" id="sceneHeight" style="color:#a4d9ff">
          </div>
          
          
          <div style="width:50%; float:left; margin-bottom: 5px">
            <p>
            Zoom
          </p>
          <input type="number" class="input-field" id="sceneZoom" style="color:#ffd391">
          </div>
          <div style="width:50%; float:right; margin-bottom: 5px">
            <p>
            Camera
          </p>
          <input type="number" class="input-field" id="sceneCamera" style="color:#ffb48e">
          </div>
          
          <div style="width:50%; float:left; margin-bottom: 5px">
            <p>
            X Position
          </p>
          <input type="number" class="input-field" id="xPos" style="color:#72c9cb">
          </div>
          <div style="width:50%; float:right; margin-bottom: 5px">
            <p>
            Y Position
          </p>
          <input type="number" class="input-field" id="yPos" style="color:#72c9cb">
          </div>
          
      </div>
      <a class="button" style="width:20%; margin-bottom: 6px; float: left;" onclick="exitEditMode()">
        Exit
      </a>
        <a class="button" style="width:48%; margin-bottom: 6px; float: right;" onclick="saveSceneEdit(); exitEditMode(); ">
        Save Edits
      </a>
      </div>
    </div>
    
    <!-- Object Selector -->
    <div id="objectSelector">
      <h style="color:#00bb78">Modify Objects</h>
      <p style="color:#c0c0c0; text-align:left; font-size: 12px; margin-bottom: 5px" id="fileName5">
        Here's what we've found so far.
      </p>
      <div style="height: 2px; background-color: white; width: 100%; margin-bottom: 10px;"></div>
      <div style="height: 255px; overflow-y: scroll" class="backgroundScroll">
        
        <p>
            Filter Objects
          </p>
            <select name="Query" id="searchQuery" style="color:#68ff59; margin-bottom: 5px" onchange="performQuery()">
  <option value="ZNAME">Name</option>
  <option value="ZPHYSICS_MODE">Physics Mode</option>
  <option value="ZOBJECTTYPE">Type</option>
  <option value="ZZ_INDEX">Z Index</option>
  <option value="ZFRICTION">Friction</option>
  <option value="ZMASS">Mass</option>
  <option value="ZFLIPX">X Flip</option>
  <option value="ZFLIPY">Y Flip</option>
  <option value="ZLOCKED">Is Locked</option>
  <option value="ZCOLLIDABLE">Is Collidable</option>
</select>
        
            <select name="Condition" id="searchCondition" style="color:#ffafaf; margin-bottom: 5px" onchange="performQuery()">
  <option value="=">Is Equal To</option>
  <option value="!=">Is Not Equal To</option>
  <option value="like">Includes</option>
  <option value="not like">Does Not Include</option>
  <option value=">">Is Greater Than</option>
  <option value="<">Is Less Than</option>
  <option value=">=">Is Greater Than Or Equal To</option>
  <option value="<=">Is Less Than Or Equal To</option>
</select>
        
          <input placeholder='Enter Query' type="text" class="input-field" id="query" style="margin-bottom: 5px" onchange="performQuery()">
        
         <div style="width:40%; float:left; margin-bottom: 5px">
        <p>
            Limit Count
          </p>
          <input type="number" class="input-field" style="margin-bottom: 5px" id="limit" placeholder="∞" onchange="performQuery()">
        </div>
         <div style="width:60%; float:right; margin-bottom: 5px" >
                   <p>
            Case Sensitive
          </p>
            <select name="Case Sensitive" id="caseSensitive" style="color:#ff5a5a; margin-bottom: 5px" onchange="performQuery()">
  <option value="case">True</option>
  <option value="no-case">False</option>
</select>
        </div>
        
        <p id="searchCount" style="color: #14fff9">
          0 entries out of ? objects
        </p>
        
        <a class="button" style="margin-bottom: 6px; width: 90%" onclick="showObjectEntries()">
        View Matched Entries
      </a>
      </div>
      <div>
      <a class="button" style="min-width: 75px; padding-left: -10px; padding-right: -10px; margin-bottom: 6px; float: left;" onclick="exitMenu()">
        Exit
      </a>
        <a class="button" style="min-width: 100px; margin-bottom: 6px; margin-left: 6px; margin-right: 6px; float: left;" onclick="resetQuery()">
        Reset
      </a>
        <a class="button" style="min-width: 100px; margin-bottom: 6px; float: right;" onclick="prevMenu='objectSelector'; editObject()">
        Actions
      </a>
      </div>
    </div>
    
    <!-- View Object Entries -->
    <div id="objectEntries">
      <h style="color:#00bb78">Object Entries</h>
      <p style="color:#c0c0c0; text-align:left; font-size: 12px; margin-bottom: 5px" id="objectEntryText">
        Here's what we've found so far.
      </p>
      <div style="height: 2px; background-color: white; width: 100%; margin-bottom: 10px;"></div>
      <div>
        <div style="height: 340px; overflow-y: scroll" class="backgroundScroll">
        <p id="objectList" style="text-align:left">
        Loading...
      </p>
      </div>
      <a class="button" style="width:95%; margin-bottom: 6px;" onclick="exitObjectEntries()">
        Close
      </a>
      </div>
    </div>
    
    <!-- Object Inspector -->
    <div id="objectInspector">
      <h style="color:#00bb78" id="objectName">Object Data</h>
      <p style="color:#c0c0c0; text-align:left; font-size: 12px; margin-bottom: 5px" id="objectID">
        Here's what we've found so far.
      </p>
      <div style="height: 2px; background-color: white; width: 100%; margin-bottom: 10px;"></div>
      <div>
        <div style="height: 218px; overflow-y: scroll" class="backgroundScroll">
        <p id="objectData" style="text-align:left; white-space:wrap; overflow-x: none">
        Loading...
      </p>
      </div>
      <a class="button" style="width:95%; margin-bottom: 6px;" onclick="closeObjectInspector()">
        Close
      </a>
      </div>
    </div>
    
    <!-- Objects Editor -->
    <div id="objectEditor">
      <h style="color:#00bb78">Edit Object(s)</h>
      <p style="color:#c0c0c0; text-align:left; font-size: 12px; margin-bottom: 5px" id="selectedObject">
        Here's what we've found so far.
      </p>
      <div style="height: 2px; background-color: white; width: 100%; margin-bottom: 10px;"></div>
      <div>
        <div style="height: 218px; overflow-y: scroll" class="backgroundScroll">
        <p id="edits" style="text-align:left; white-space:wrap; overflow-x: none">
        <div style="width:50%; float:left; margin-bottom: 5px">
            <p id="xPosText">
            X Position (px)
          </p>
          <input placeholder="0" type="number" class="input-field input-object" id="ZOBJECTPOSITION/ZX" textParent="xPosText" style="color:#72c9cb">
          </div>
          <div style="width:50%; float:right; margin-bottom: 5px">
            <p id="yPosText">
            Y Position (px)
          </p>
          <input placeholder="0" type="number" class="input-field input-object" id="ZOBJECTPOSITION/ZY" textParent="yPosText" style="color:#72c9cb">
          </div>
          
         <div style="width:50%; float:left; margin-bottom: 5px">
            <p id="xGravityText">
            X Gravity (m/s²)
          </p>
          <input placeholder="0" type="number" class="input-field input-object" id="ZOBJECTDATA/ZGRAVITY_X" textParent="xGravityText" style="color:#8495ff;">
          </div>
          <div style="width:50%; float:right; margin-bottom: 5px">
            <p id="yGravityText">
            Y Gravity (m/s²)
          </p>
          <input placeholder="0" type="number" class="input-field input-object" id="ZOBJECTDATA/ZGRAVITY_Y" textParent="yGravityText" style="color:#8495ff;">
          </div> 
          
        <div style="width:30%; float:left; margin-bottom: 5px; margin-left: 1.75px">
            <p id="xAnchorText">
            X Anchor (%)
          </p>
          <input isPercentage="1" placeholder="0" type="number" class="input-field input-object" id="ZOBJECTPOSITION/ZANCHORX" textParent="xAnchorText" style="color:#cba371;">
          </div>
          <div style="width:30%; float:left; margin-bottom: 5px; margin-left: 3px;">
            <p id="yAnchorText">
            Y Anchor (%)
          </p>
          <input isPercentage="1" placeholder="0" type="number" class="input-field input-object" id="ZOBJECTPOSITION/ZANCHORY" textParent="yAnchorText" style="color:#cba371">
          </div>
          <div style="width:37%; float:right; margin-bottom: 5px; margin-left: -2px; margin-right: 2px;">
            <p id="zIndexText">
            Z Index
          </p>
          <input placeholder="0" type="number" class="input-field input-object" id="ZOBJECTDATA/ZZ_INDEX" textParent="zIndexText" style="color:#fff7a6">
          </div>
        <div style="width:50%; float:left; margin-bottom: 5px">
            <p id="xScaleText">
            X Scale (%)
          </p>
          <input isPercentage="1" placeholder="0" type="number" class="input-field input-object" id="ZOBJECTDATA/ZX_SCALE" textParent="xScaleText" style="color:#eb8fc4;">
          </div>
          <div style="width:50%; float:right; margin-bottom: 5px">
            <p id="yScaleText">
            Y Scale (%)
          </p>
          <input isPercentage="1" placeholder="0" type="number" class="input-field input-object" id="ZOBJECTDATA/ZY_SCALE" textParent="yScaleText" style="color:#eb8fc4">
          </div>
          
          <div style="width:25%; float:left; margin-bottom: 5px; margin-left: 4px">
            <p id="collidableText">
            Collidable
          </p>
          <select class="input-field input-object" id="ZOBJECTDATA/ZCOLLIDABLE" textParent="collidableText" style="color:#ffe970; width: 90%; text-align: center; text-align-last:center; margin: auto; -ms-text-align-last: center; -moz-text-align-last: center">
            <option value="" hidden disabled selected>Mixed</option>
            <option value="0">False</option>
            <option value="1">True</option>
            </select>
          </div>
          <div style="width:25%; float:left; margin-bottom: 5px">
            <p id="lockedText">
            Is Locked
          </p>
          <select class="input-field input-object" id="ZOBJECTDATA/ZLOCKED" textParent="lockedText" style="color:#ffe970; width: 90%; text-align: center; text-align-last:center; margin: auto; -ms-text-align-last: center; -moz-text-align-last: center;">
            <option value="" hidden disabled selected>Mixed</option>
            <option value="0">False</option>
            <option value="1">True</option>
            </select>
          </div>
          <div style="width:25%; float:left; margin-bottom: 5px">
            <p id="xFlipText">
            X Flip
          </p>
          <select class="input-field input-object" id="ZOBJECTDATA/ZFLIPX" textParent="xFlipText" style="color:#ffb185; width: 90%; text-align: center; text-align-last:center; margin: auto; -ms-text-align-last: center; -moz-text-align-last: center;">
            <option value="" hidden disabled selected>Mixed</option>
            <option value="0">False</option>
            <option value="1">True</option>
            </select>
          </div>
          <div style="width:25%; float:right; margin-bottom: 5px; margin-right: -4px">
            <p id="yFlipText">
            Y Flip
          </p>
          <select class="input-field input-object" id="ZOBJECTDATA/ZFLIPY" textParent="yFlipText" style="color:#ffb185; width: 90%; text-align: center; text-align-last:center; margin: auto; -ms-text-align-last: center; -moz-text-align-last: center;">
            <option value="" hidden disabled selected>Mixed</option>
            <option value="0">False</option>
            <option value="1">True</option>
            </select>
          </div>
          
          <div style="width:65%; float:left; margin-bottom: 5px">
            <p id="objectTypeText">
            Object Type
          </p>
          <select class="input-field input-object" id="ZOBJECTDATA/ZOBJECTTYPE" placeholder="Mixed" textParent="objectTypeText" style="color:#ff6000">
            <option value="" hidden disabled selected>Mixed</option>
           <option value="Empty">Empty Object</option>
            <option value="Graphic">Graphic</option>
            <option value="9slice">9 Slice Graphic</option>
            <option value="TTFLabel">TTF Label</option>
            <option value="BMLabel">BM Label</option>
            <option value="LifeIndicator">Life Indicator</option>
            <option value="HealthBar">Health Bar</option>
            <option value="Joystick">Joystick</option>
            <option value="Particle">Particle Effect</option>
            <option value="PauseButton">Pause Button</option>
            <option value="World">Global World Object</option>
            <option value="Ad">Advertisement</option>
            </select>
          </div>
          <div style="width:35%; float:right; margin-bottom: 5px">
            <p id="physicsModeText">
            Physics Mode
          </p>
          <select class="input-field input-object" id="ZOBJECTDATA/ZPHYSICS_MODE" placeholder="Mixed" textParent="physicsModeText" style="color:#eb84cf">
            <option value="" hidden disabled selected>Mixed</option>
            <option value="Kinematic">Wall</option>
            <option value="Dynamic">Physics</option>
            <option value="Scenery">Scenery</option>
            </select>
          </div>
          
       <div style="width:50%; float:left; margin-bottom: 5px">
            <p id="rotationText">
            Rotation (°)
          </p>
          <input placeholder="0" type="number" class="input-field input-object" id="ZOBJECTDATA/ZROTATION" textParent="rotationText" style="color:#b790eb">
          </div>
          <div style="width:50%; float:right; margin-bottom: 5px">
            <p id="densityText">
            Density
          </p>
          <input placeholder="0" type="number" class="input-field input-object" id="ZOBJECTDATA/ZDENSITY" textParent="densityText" style="color:#85cdeb">
          </div>
          
       <div style="width:50%; float:left; margin-bottom: 5px">
            <p id="massText">
            Mass (kg)
          </p>
          <input placeholder="0" type="number" class="input-field input-object" id="ZOBJECTDATA/ZMASS" textParent="massText" style="color:#b790eb">
          </div>
          <div style="width:50%; float:right; margin-bottom: 5px">
            <p id="frictionText">
            Friction (%)
          </p>
          <input isPercentage="1" placeholder="0" type="number" class="input-field input-object" id="ZOBJECTDATA/ZFRICTION" textParent="frictionText" style="color:#eba2a2">
          </div>
          
       <div style="width:50%; float:left; margin-bottom: 5px">
            <p id="restitutionText">
            Restitution (%)
          </p>
          <input isPercentage="1" placeholder="0" type="number" class="input-field input-object" id="ZOBJECTDATA/ZRESTITUTION" textParent="restitutionText" style="color:#b790eb">
          </div>
          <div style="width:50%; float:right; margin-bottom: 5px">
            <p id="linearDampingText">
            Linear Damping
          </p>
          <input placeholder="0" type="number" class="input-field input-object" id="ZOBJECTDATA/ZLINEARDAMPING" textParent="linearDampingText" style="color:#eba2a2">
          </div>
        
      </div>
      <a class="button" style="min-width:90px; margin-bottom: 6px; float: left" onclick="openMenu();">
        Close
      </a>
        <a class="button" style="min-width:100px; background-color: #ff6363; margin-bottom: 6px; margin-left: 6px; float: left" onclick="executeDelete(); openMenu();">
        Delete
      </a>
        <a class="button" style="min-width:100px; margin-bottom: 6px; margin-left: 6px; float: right" onclick="executeApply(); openMenu();">
        Apply
      </a>
      </div>
    </div>
    
    <!-- Behavior options -->
    <div id="behaviorOptions">
      <h style="color:#00bb78">Modify Behaviors</h>
      <p style="color:#c0c0c0; text-align:left; font-size: 12px; margin-bottom: 5px" id="fileName7">
        Here's what we've found so far.
      </p>
      <div style="height: 2px; background-color: white; width: 100%; margin-bottom: 10px;"></div>
      <div>
        <div style="height: 218px; overflow-y: scroll" class="backgroundScroll">
          
        <a class="button" onclick="prevMenu = 'behaviorOptions'; downgrade();" style="width:95%; margin-bottom: 6px;">
        Downgrade to Version
      </a>
        <a class="button" style="background-color:grey; width:95%; margin-bottom: 6px;" onclick="">
        Format All Behaviors
      </a>
         <a class="button" style="background-color:grey; width:95%; margin-bottom: 6px;" onclick="">
        Remove Global behaviors
      </a>
         <a class="button" style="background-color:grey; width:95%; margin-bottom: 6px;" onclick="">
        Transfer Behaviors
      </a>
         <a class="button" style="background-color:grey; width:95%; margin-bottom: 6px;" onclick="">
        Modify Behaviors
      </a>
    
      </div>
      <a class="button" style="width:95%; margin-bottom: 6px;" onclick="exitMenu()">
        Close
      </a>
      </div>
    </div>
    
    <!-- Downgrade behaviors -->
    <div id="downgradeBehaviors">
      <h style="color:#00bb78">Downgrade Behaviors</h>
      <p style="color:#c0c0c0; text-align:left; font-size: 12px; margin-bottom: 5px" id="fileName8">
        Here's what we've found so far.
      </p>
      <div style="height: 2px; background-color: white; width: 100%; margin-bottom: 10px;"></div>
      <div>
        <div style="height: 218px; overflow-y: scroll" class="backgroundScroll">
        <p>
          Target Version
        </p>
        <input placeholder="Please enter version" value="1.27" type="number" class="input-field" id="targetVersion" style="color:#00bb78">
        
        <p style="color: #bebebe">
          hyperPad viewer currently supports v1.27 and below. v1.27 is recommended for hyperPad viewer.
        </p>
          <br>
          <p>
          Target ZNAME <b style="color:#bebebe">(Advanced)</b>
        </p>
        <input placeholder="All" value="" type="text" class="input-field" id="targetZName" style="color:#00bb78">
          <p style="color: #bebebe">
          Leave blank to check all behaviors.
        </p>
        </div>
        
      <a class="button" style="width:95px; float:left; margin-bottom: 6px;" onclick="openMenu()">
        Close
      </a>
        <a class="button" style="min-width:147px; margin-bottom: 6px; margin-left: 6px; float: right" onclick="downgradeAction();">
        Downgrade
      </a>
      </div>
    </div>
    
  </body>
</html>

<!-- download functionality -->
<script src="https://cdn.jsdelivr.net/npm/web-streams-polyfill@2.0.2/dist/ponyfill.min.js"></script>
    <!-- includes blob.stream() polyfill -->
    <script src="https://cdn.jsdelivr.net/gh/eligrey/Blob.js/Blob.js"></script>
    <script src="https://jimmywarting.github.io/StreamSaver.js/StreamSaver.js"></script>
    
<!-- import -->

<script>
  const appear = [
    { transform: 'scale(0.05)', opacity: 0},
    { transform: 'scale(1)', opacity: 1}
  ]
  document.getElementById("importMenu").animate(appear, {duration: 300, transition: "ease-out"});
  function returnToMain() {
    document.getElementById("importMenu").style.display = "block";
    document.getElementById("errorMenu").style.display = "none";
    document.getElementById("importMenu").animate(appear, {duration: 300, transition: "ease-out"});
  }
  
  const fileSelector = document.getElementById('file-selector');
  var project = new JSZip();
  var fileExist = {};
  var scenes = {};
  
  // file data
  var extensions = {};
  var file = "";
  var startTime = 0;
  fileSelector.addEventListener('change', (event) => {
    fileExist = {};
    startTime = Date.now();
    
    // Closure to capture the file information.
    function handleFile(f) {
		file = f;
      	scenes = {};
        var dateBefore = new Date();
        project.loadAsync(f)                                   // 1) read the Blob
        .then(function(zip) {
            var dateAfter = new Date();
            
            zip.forEach(function (relativePath, zipEntry) {  // 2) print entries
              fileExist[zipEntry.name] = true;
              extensions[zipEntry.name.split(".").pop()] = true;
              if (zipEntry.name.startsWith("levels/")) {
                console.info(zipEntry.name);
              }
            });
          
          onImport(dateAfter - dateBefore);
        }, function (e) {
            console.error(f.name + ": " + e.message);
        });
    }
    
    var files = event.target.files;
  	for (var i = 0; i < files.length; i++) {
      handleFile(files[i]);
  	}
    
    function onImport(time) {
      let fileName = fileSelector.files[0].name;
      let size = (Math.round((fileSelector.files[0].size) / 100000) / 10) + "MB";
      time = time + "ms";
      console.info(fileName, size, time);
      
      // validation
      let success = true;
      
      function check(file) {
        if (!fileExist[file]) {
          success = false;
          console.error(file);
        }
      }
      check("gameDetails.plist");
      check("objectDock.plist");
      check("icon.png");
      
      // success?
      document.getElementById("importMenu").style.display = "none";
      if (success) {
        
        var gameDetails = "";
        
        function getKey(content, key) {
          let first = content.split("<key>" + key + "</key>")[1];
          let second = first.split("<string>")[1];
          let third = second.split("</string>")[0];
          return third;
        }
        
		project.file("gameDetails.plist").async("string")
		  .then(function(content) {
          	gameDetails = content;
          	document.getElementById("projectViewer").style.display = "block";
            document.getElementById("projectViewer").animate(appear, {duration: 300, transition: "ease-out"});
        	document.getElementById("projectName").innerHTML = getKey(content, "gameName");
          let fileHeader = fileName + 
 "<b style='color:#989898'> (" + size + ")</b>";
        	document.getElementById("fileName").innerHTML = fileHeader;
          document.getElementById("fileName2").innerHTML = fileHeader;
          document.getElementById("fileName3").innerHTML = fileHeader;
          document.getElementById("fileName4").innerHTML = fileHeader;
          document.getElementById("fileName5").innerHTML = fileHeader;
        //  document.getElementById("fileName6").innerHTML = fileHeader;
          document.getElementById("fileName7").innerHTML = fileHeader;
          document.getElementById("fileName8").innerHTML = fileHeader;
		});
        
        project.file("levels/Level 1/Level.sqlite").async("uint8array")
          .then(function(content) {
            console.log("loaded");
            db = new SQL.Database(content);
        });
        
        let entries = Object.keys(fileExist);
        
      } else {
        document.getElementById("errorMenu").style.display = "block";
        console.error("Failed to import");
      }
    }
    
  });
</script>

<script>
  
  var blobFile;
  async function finish() {
    try {
          console.log("finish");
          document.getElementById("loading").style.display = "block";
          document.getElementById("download").style.display = "none";
    	  document.getElementById("projectOptions").style.display = "none";
    	  document.getElementById("downloadBack").style.display = "none";
          document.getElementById("loading").style.display = "block";
          document.getElementById("icon").style.display = "none";
    	  try {
            project.file("levels/Level 1/Level.sqlite", db.export());
          } catch(e) {
            throwError("Failed to compile project, please try again");
            exitMenu()
          }
    	  project.file("Log.txt", "This project was edited by hyperPad Project Modder");
          project.file("icon@2x.png").async("base64")
          .then(function(content) {
            document.getElementById("iconImg").src = "data:image/png;base64," + content;
            document.getElementById("iconImg").style.display = "block";
          });
          console.log(extensions);
      	  console.log(JSON.stringify(project.generateAsync({type: "blob"})))
      	  let fileName = document.getElementById("currentFile");
          let percentage = document.getElementById("processTooltip");
          let progress = document.getElementById("progress");
      	  let s = 0;
    	  project.generateAsync({type : "uint8array"}, function(onUpdate) {
            
            // on update
            let e = "<b style=\"color:#00bb78\">";
            e += "Processing File:</b><br>";
            e += onUpdate.currentFile || "Completing process...";
            fileName.innerHTML = e;
            s += 1;
            percentage.innerHTML = Math.round(onUpdate.percent) + "% (" + s + " updates)";
            progress.style.width = onUpdate.percent + "%";

          })
            .then(function (file) {
            document.getElementById("loading").style.display = "none";
            document.getElementById("download").style.display = "block";
            document.getElementById("icon").style.display = "block";
            document.getElementById("downloadBack").style.display = "block";
            console.log("project download")
            blobFile = file;
          });
    
        } catch(e) {console.log(e)}
  }
        
</script>

<script>
var results;
var whereQuery;
var prevMenu;
var hideIds = ["projectData", "errorMenu", "icon", "download", "downloadBack", "sceneEditor", "sceneSelector", "objectSelector", "objectEntries", "objectEditor", "behaviorOptions", "downgradeBehaviors"];
function exitEditMode() {
  exitMenu();
  editSceneData();
}
  
function downloadFile(text, fileName) {
        const fileStream = streamSaver.createWriteStream(fileName, {
          size: text.size // Makes the procentage visiable in the download
        })

        // One quick alternetive way if you don't want the hole blob.js thing:
        // const readableStream = new Response(
        //   Blob || String || ArrayBuffer || ArrayBufferView
        // ).body
        const readableStream = new Response(text).body;

        // more optimized pipe version
        // (Safari may have pipeTo but it's useless without the WritableStream)
        if (window.WritableStream && readableStream.pipeTo) {
          return readableStream.pipeTo(fileStream)
            .then(() => {
            console.log('done writing');
          })
        }

        // Write (pipe) manually
        window.writer = fileStream.getWriter()

        const reader = readableStream.getReader()
        const pump = () => reader.read()
          .then(res => res.done
            ? writer.close()
            : writer.write(res.value).then(pump))

        pump()
}
  
function getSQLite() {
  let exp = db.export();
  downloadFile(exp, "Level.sqlite")
}
  
function extractJSON() {
  let output = {};
  let tables = ["Zbehaviourdata", "zcameradata", "zcollisiondata", "zeditordata", "zlayerdata", "zleveldata", "zobjectdata", "zobjectposition", "zpathdata", "zprojectdata", "ztiledata", "ztileselectordata", "z_5objects", "z_metadata", "z_modelcache", "z_primarykey"];
  tables.forEach(function(key) {
    try {
      output[key] = db.exec("SELECT * FROM " + key)[0] || {};
    } catch(e) {
      console.error(e);
    }
  })
  console.log(output);
  downloadFile(output, "Project.json")
}
  
function openMenu() {
  clearTimeout(editTimer);
  hideIds.forEach(function(id) {
    try {
      document.getElementById(id).style.display = "none";
    } catch(e) {};
  })
  document.getElementById(prevMenu).style.display = "block";
  if (prevMenu == "objectEntries") {
    showObjectEntries();
  }
}
  
function behaviorOptions() {
  document.getElementById("behaviorOptions").style.display = "block";
  document.getElementById("projectViewer").style.display = "none";
}
  
function downgrade() {
  document.getElementById("behaviorOptions").style.display = "none";
  document.getElementById("downgradeBehaviors").style.display = "block";
}
  
async function downloadResult() {
  // Saving a blob is as simple as the fetch example, you just get the
      // readableStream from the blob by calling blob.stream() to get a
      // readableStream and then pipe it
  		document.getElementById("download").innerHTML = "Downloading";
  		file = blobFile
        const fileStream = streamSaver.createWriteStream('export.tap', {
          size: file.size // Makes the procentage visiable in the download
        })

        // One quick alternetive way if you don't want the hole blob.js thing:
        // const readableStream = new Response(
        //   Blob || String || ArrayBuffer || ArrayBufferView
        // ).body
        const readableStream = new Response(file).body;

        // more optimized pipe version
        // (Safari may have pipeTo but it's useless without the WritableStream)
        if (window.WritableStream && readableStream.pipeTo) {
          return readableStream.pipeTo(fileStream)
            .then(() => {
            console.log('done writing');
            document.getElementById("download").innerHTML = "Done!";
          })
        }

        // Write (pipe) manually
        window.writer = fileStream.getWriter()

        const reader = readableStream.getReader()
        const pump = () => reader.read()
          .then(res => res.done
            ? writer.close()
            : writer.write(res.value).then(pump))

        pump()
}
  
function downgradeAction() {
  let startTime = Date.now();
  let version = document.getElementById("targetVersion").value;
  let zname = document.getElementById("targetZName").value;
  let pass = true;
  try {
    JSON.parse(version) + 1;
  } catch(e) {
    throwError("Provided target version is not a valid number")
    pass = false;
  }
  if (!pass) return;
  if (version < 0) {
    throwError("Provided target version cannot be negative")
    pass = false;
    return;
  }
  if (!pass) return;
  
  // search behaviors
  let cmd = "SELECT ZNAME FROM ZBEHAVIOURDATA;"
  if (zname) {
    cmd = "SELECT ZNAME FROM ZBEHAVIOURDATA WHERE ZNAME LIKE " + JSON.stringify(zname + "%");
  }
  let count = 0;
  let updated = 0;
  let d = db.exec(cmd);
  if (d.length == 0) {
    throwError("No behaviors were found with the provided inputs")
    return;
  }
  behaviors = {};
  d[0].values.forEach(function(behavior) {
    count++;
    
    let ver = behavior[0].split(" v");
    if (ver.length <= 1) {
      return;
    }
    ver = ver[ver.length - 1];
    if (parseFloat(version) >= parseFloat(ver)) {
      return;
    }
    updated++;
    behaviors[behavior[0]] = ver;
  });
  
  Object.keys(behaviors).forEach(function(key) {
    let name = key.replace(" v" + behaviors[key], "");
    let cmd = "UPDATE ZBEHAVIOURDATA SET ZNAME = " + JSON.stringify(name);
    cmd += " WHERE ZNAME = " + JSON.stringify(key);
    db.run(cmd);
    console.log(cmd)
  });
  
  let delta = Date.now() - startTime;
  throwSuccess("Successfully downgraded " + updated + " out of " + count + " behaviors (" + delta + "ms)");
  
  if (pass) {
   openMenu();
  }
}
  
var selectedObject;
var editingObjects = [];
  
function executeDelete() {
  let objectsDestroyed = 0;
  try {
  let cmd = "";
  if (selectedObject !== "selected") {
    cmd = "SELECT Z_PK from ZOBJECTDATA WHERE ZUNIQUEID = " + JSON.stringify(selectedObject) + ";";
    cmd += "DELETE from ZOBJECTDATA WHERE ZUNIQUEID = " + JSON.stringify(selectedObject);
    try {
      let index = db.exec(cmd);
      cmd = "DELETE from ZOBJECTPOSITION WHERE Z_PK = " + index[0].values[0];
      db.run(cmd);
      objectsDestroyed++;
    } catch(e) {throwError("Failed to destroy object: " + e)};
  } else {
    results[0].values.forEach(function(index) {
      cmd = "DELETE from ZOBJECTDATA WHERE ZUNIQUEID = " + JSON.stringify(index[1]);
      try {
        db.exec(cmd);
        objectsDestroyed++;
      } catch(e) {};
    })
  }
  } catch(e) {throwError("Failed to destroy objects(s): " + e)};
  
  if (objectsDestroyed == 1) {
    throwSuccess("Successfully destroyed 1 object");
  }
  if (objectsDestroyed > 1) {
    throwSuccess("Successfully destroyed " + objectsDestroyed + " objects")
  }
  
} 

function executeApply() {
  let modCount = Object.keys(modifications).length;
  let objectCount = editingObjects.length;
  let startTime = Date.now();
  let writes = 0;
  let errors = 0;
  editingObjects.forEach(function(objectID) {
    
  	try {
    
    // get z_pk
    cmd = "SELECT Z_PK from ZOBJECTDATA WHERE ZUNIQUEID = " + JSON.stringify(objectID);
    let index = db.exec(cmd);
    let ZPK = index[0].values[0][0];
      
    // loop through each mod
    Object.keys(modifications).forEach(function(mod) {
      let select = mod.split("/")[0];
      let edit = mod.split("/")[1];
      let setTo = modifications[mod]
      let cmd;
      try {
        JSON.parse(setTo) + 1;
      } catch(e) {
        setTo = JSON.stringify(setTo);
      }
      if (select == "ZOBJECTDATA") {
        cmd = "UPDATE ZOBJECTDATA SET " + edit;
        cmd += " = " + setTo;
        cmd += " WHERE ZUNIQUEID = " + JSON.stringify(objectID);
        db.run(cmd);
      } 
      if (select == "ZOBJECTPOSITION") {
        cmd = "UPDATE ZOBJECTPOSITION SET " + edit;
        cmd += " = " + setTo;
        cmd += " WHERE Z_PK = " + ZPK;
        db.run(cmd);
      }
      writes++;
    })
      
    } catch(e) {
      console.error(e);
      errors++;
    };
    
  })
  let delta = Date.now() - startTime;
    throwSuccess("Successfully modified " + modCount + " properties on " + objectCount + " objects - " + writes + " writes (" + delta + "ms) (" + errors + " errors)");
 
}
  
var editTimer;
var modifications = {};  
  
function editObject(objectID = "selected") {
  let data = {};
  let varied = {};
  modifications = {};
  clearTimeout(editTimer);
  modifications = {};
  editTimer = setInterval(function() {
    document.querySelectorAll('.input-object').forEach(function(element) {
      if (!element.getAttribute("textParent")) return;
      // console.log(element.getAttribute("textParent"))
      document.getElementById(element.getAttribute("textParent")).style.color = "white";
      if (varied[element.id] && element.value !== "") {
        document.getElementById(element.getAttribute("textParent")).style.color = "#00bb78";
        modifications[element.id] = element.value;
      }
      
      if (!varied[element.id] && (data[element.id].toString() !== element.value.toString())) {
        // console.log(data[element.id], element.value)
        document.getElementById(element.getAttribute("textParent")).style.color = "#00bb78";
        modifications[element.id] = element.value;
      }
      
    });
  }, 100)
  
  // initialize input fields
  document.querySelectorAll('.input-object').forEach(function(element) {
    element.setAttribute("value", "?");
    element.setAttribute("placeholder", "0");
    element.value = "?";
    element.placehodler = "0";
  });
  document.getElementById("ZOBJECTDATA/ZPHYSICS_MODE").value = "";
  document.getElementById("ZOBJECTDATA/ZOBJECTTYPE").value = "";
  document.getElementById("ZOBJECTDATA/ZCOLLIDABLE").value = "";
  document.getElementById("ZOBJECTDATA/ZLOCKED").value = "";
  document.getElementById("ZOBJECTDATA/ZFLIPX").value = "";
  document.getElementById("ZOBJECTDATA/ZFLIPY").value = "";
  
  selectedObject = objectID;
  editingObjects = [];
  if (objectID !== "selected") {
    editingObjects.push(objectID);
  }
  document.getElementById("objectSelector").style.display = "none";
  document.getElementById("objectEntries").style.display = "none";
  document.getElementById("objectEditor").style.display = "block";
  let fileHeader = "No object selected."
  document.getElementById("selectedObject").innerHTML = fileHeader;
  if (objectID == "selected") {
    
    if (!results[0]) {
      throwError("Failed to load object data: No object is selected")
    }
    
    let entryCount = results[0].values.length;
    results[0].values.forEach(function(index) {
      editingObjects.push(index[1])
    })
 	
    fileHeader = "Editing " + entryCount + " entries -> " +
 "<b style='color:#989898'> Querying " + document.getElementById("searchQuery").value + "</b>";
  } else {
    fileHeader = "<b style='color:#989898'>Object ID: </b>" + objectID;
  }
  document.getElementById("selectedObject").innerHTML = fileHeader;
  
  // load data
  
  editingObjects.forEach(function(objectID) {
    
    try {
    
    cmd = "SELECT * from ZOBJECTDATA WHERE ZUNIQUEID = " + JSON.stringify(objectID);
    let index = db.exec(cmd);
      let i = 0;
      
    index[0].columns.forEach(function(key) {
      let id = "ZOBJECTDATA/" + key;
      try {
        let value = index[0].values[0][i];
        let element = document.getElementById(id)
        if (element.getAttribute("isPercentage") || element.isPercentage) {
          value = value * 100;
        }
        
        if (data[id] == undefined) {
          data[id] = value;
        } else if (data[id] !== value || varied[id]) {
          
          value = "";
          varied[id] = true;
          element.setAttribute("placeholder", "Mixed");
          element.placeholder = "Mixed";
        }
        element.setAttribute("value", value);
        element.value = value;
      } catch(e) {};
      i++;
    });
    cmd = "SELECT * from ZOBJECTPOSITION WHERE Z_PK = " + index[0].values[0][0];
    // console.log(cmd);
    db.run(cmd);
    index = db.exec(cmd);
    i = 0;
    index[0].columns.forEach(function(key) {
      let id = "ZOBJECTPOSITION/" + key;
      try {
        let value = index[0].values[0][i];
        let element = document.getElementById(id)
        if (element.getAttribute("isPercentage") || element.isPercentage) {
          value = value * 100;
        }
        // console.log(data[id])
        if (data[id] == undefined) {
          data[id] = value;
          console.log(value)
        } else if (data[id] !== value || varied[id]) {
          value = "";
          varied[id] = true;
          element.setAttribute("placeholder", "Mixed");
          element.placeholder = "Mixed";
        }
        element.setAttribute("value", value);
        element.value = value;
      } catch(e) {};
      i++;
    });
      
    } catch(e) {};
     
  });
  
}
  
function showObjectEntries() {
  let fileHeader = 0 + " entries -> " +
 "<b style='color:#989898'> Querying " + document.getElementById("searchQuery").value + "</b>";
  document.getElementById("objectEntryText").innerHTML = fileHeader;
  document.getElementById("objectList").innerHTML = "No results to display."
  performQuery();
  document.getElementById("objectSelector").style.display = "none";
  document.getElementById("objectEntries").style.display = "block"; 
  let o = "";
  let entryCount = results[0].values.length;
  fileHeader = entryCount + " entries -> " +
 "<b style='color:#989898'> Querying " + document.getElementById("searchQuery").value + "</b>";
  document.getElementById("objectEntryText").innerHTML = fileHeader;
  prevMenu = "objectEntries";
  results[0].values.forEach(function(entry) {
    o += "<b style='color: #00bb78'>" + entry[0] + "</b>";
    o += "<span style='color: #c2c2c2'> (" + entry[2] + ") </span><br>";
    o += entry[1] + "<br>";
    o += "<a style='color: #edd465' onclick='inspectObject(\"";
    o += entry[1] + "\",\"" + entry[0] + "\")'> [Inspect Object] </a>";
    o += "<a style='color: #ff6060' onclick='editObject(\"";
    o += entry[1] + "\")'> [Actions] </a> <br>";
    o += "<br>";
  })
  document.getElementById("objectList").innerHTML = o;
}
  
function exitObjectEntries() {
  document.getElementById("objectSelector").style.display = "block";
  document.getElementById("objectEntries").style.display = "none";
  clearTimeout(editTimer);
}
  
function saveSceneEdit() {
  let sceneToEdit = document.getElementById("sceneName").innerHTML;
  let sceneName = document.getElementById("sceneNameInput").value;
  let sceneMode = document.getElementById("sceneMode").value;
  let sceneType = document.getElementById("sceneType").value;
  let scenePreload = document.getElementById("scenePreload").value;
  let sceneIndex = document.getElementById("sceneIndex").value;
  let sceneWidth = document.getElementById("sceneWidth").value;
  let sceneHeight = document.getElementById("sceneHeight").value;
  let cmd;
  
  // update mode
  cmd = "UPDATE ZLevelData SET ZLevelMode = ";
  cmd += JSON.stringify(sceneMode);
  cmd += " WHERE ZLevelName = " + JSON.stringify(sceneToEdit);
  db.run(cmd);
  
  // update type
  cmd = "UPDATE ZLevelData SET ZSceneType = ";
  cmd += JSON.stringify(sceneType);
  cmd += " WHERE ZLevelName = " + JSON.stringify(sceneToEdit);
  db.run(cmd);
  
  // update zoom
  cmd = "UPDATE ZLevelData SET ZScale = ";
  cmd += JSON.stringify(document.getElementById("sceneZoom").value);
  cmd += " WHERE ZLevelName = " + JSON.stringify(sceneToEdit);
  db.run(cmd);
  
  // update camera
  cmd = "UPDATE ZLevelData SET ZCamera = ";
  cmd += JSON.stringify(document.getElementById("sceneCamera").value);
  cmd += " WHERE ZLevelName = " + JSON.stringify(sceneToEdit);
  db.run(cmd);
  
  // update x pos
  cmd = "UPDATE ZLevelData SET ZX_POS = ";
  cmd += JSON.stringify(document.getElementById("xPos").value);
  cmd += " WHERE ZLevelName = " + JSON.stringify(sceneToEdit);
  db.run(cmd);
  
  // update y pos
  cmd = "UPDATE ZLevelData SET ZY_POS = ";
  cmd += JSON.stringify(document.getElementById("yPos").value);
  cmd += " WHERE ZLevelName = " + JSON.stringify(sceneToEdit);
  db.run(cmd);
  
  // update preload
  cmd = "UPDATE ZLevelData SET ZPreload = ";
  cmd += JSON.stringify(scenePreload);
  cmd += " WHERE ZLevelName = " + JSON.stringify(sceneToEdit);
  db.run(cmd);
  
  // update index
  cmd = "UPDATE ZLevelData SET ZIndex = ";
  cmd += JSON.stringify(sceneIndex);
  cmd += " WHERE ZLevelName = " + JSON.stringify(sceneToEdit);
  db.run(cmd);
  
  // update width
  cmd = "UPDATE ZLevelData SET ZWidth = ";
  cmd += JSON.stringify(sceneWidth);
  cmd += " WHERE ZLevelName = " + JSON.stringify(sceneToEdit);
  db.run(cmd);
  
  // update height
  cmd = "UPDATE ZLevelData SET ZHeight = ";
  cmd += JSON.stringify(sceneHeight);
  cmd += " WHERE ZLevelName = " + JSON.stringify(sceneToEdit);
  db.run(cmd);
  
  // update name
  cmd = "UPDATE ZLevelData SET ZLevelName = ";
  cmd += JSON.stringify(sceneName);
  cmd += " WHERE ZLevelName = " + JSON.stringify(sceneToEdit);
  db.run(cmd);
  return;
}
  
function exitMenu() {
  clearTimeout(queryTimer)
  document.getElementById("projectViewer").style.display = "block";
  document.getElementById("projectOptions").style.display = "block";
  hideIds.forEach(function(id) {
    document.getElementById(id).style.display = "none";
  });
}
  var expanded = false;
  function expand() {
    if (!expanded) {
      document.getElementById("expand").innerHTML = " [Close]"
      document.getElementById("more").style.display = "block";
      expanded = true;
    } else {
      document.getElementById("expand").innerHTML = " [Expand]"
      document.getElementById("more").style.display = "none";
      expanded = false;
    }
  }
  
  var expandAdv = {};
  function expandAdvanced(id) {
    if (!expandAdv[id]) {
      document.getElementById(id).innerHTML = " [Close]"
      document.getElementById("adv-" + id).style.display = "block";
      expandAdv[id] = true;
    } else {
      document.getElementById(id).innerHTML = " [Expand]"
      document.getElementById("adv-" + id).style.display = "none";
      expandAdv[id] = false;
    }
  }
  
  function inspectObject(objectID, objectName) {
    document.getElementById("objectEntries").style.display = "none";
    document.getElementById("objectInspector").style.display = "block";
    document.getElementById("objectID").innerHTML = objectID;
    document.getElementById("objectName").innerHTML = objectName;
    let object = db.exec("SELECT * from ZOBJECTDATA WHERE ZUNIQUEID = " + JSON.stringify(objectID));
    let results = {};
    let i = 0;
    object[0].columns.forEach(function(row) {
      results[row] = object[0].values[0][i];
      i++;
    });
    let object2 = db.exec("SELECT * from ZOBJECTPOSITION WHERE Z_PK = " + object[0].values[0][0]);
    let results2 = {};
    i = 0;
    object2[0].columns.forEach(function(row) {
      results2[row] = object2[0].values[0][i];
      i++;
    });
    let s = "<b style='color:#6abfff; text-decoration-line: underline;'>ZOBJECTPOSITION</b><br>";                    
    Object.keys(results2).forEach(function(key) {
      if (key == "ZGAMEOBJECTDATA") {
        gamedata = results2[key];
        return;
      }
      s += "<b style='color:#00bb78'>";
      s += key + ": ";
      s += "</b>";
      s += results2[key];
      s +="<br>"
    });
    s += "<br>";
                          
    s += "<b style='color:#ffda6e; text-decoration-line: underline;'>ZOBJECTDATA</b><br>";
    console.log(results);
    let gameData = "";
    Object.keys(results).forEach(function(key) {
      if (key == "ZGAMEOBJECTDATA") {
        gamedata = results[key];
        return;
      }
      s += "<b style='color:#00bb78'>";
      s += key + ": ";
      s += "</b>";
      s += results[key];
      s +="<br>"
    });
    s += "<br>";
    s += "<b style='color:#ff7a71; text-decoration-line: underline;'>Object Gamedata</b><br>";
    s += "<p style='white-space:wrap; word-wrap: break-word;'>" + gamedata + "</p>";
    document.getElementById("objectData").innerHTML = s;
  }
  
  function closeObjectInspector(objectID) {
    document.getElementById("objectEntries").style.display = "block";
    document.getElementById("objectInspector").style.display = "none";
  }
  
  function selectScene(scene) {
    document.getElementById("sceneName").innerHTML = scene;
    document.getElementById("sceneSelector").style.display = "none";
    document.getElementById("sceneEditor").style.display = "block";
    document.getElementById("sceneNameInput").value = scene;
    let index = db.exec("SELECT ZLevelMode, ZSceneType, ZPreload, ZIndex, ZWidth, ZHeight, ZScale, ZCamera, ZX_Pos, ZY_Pos FROM ZLevelData WHERE ZLevelName = " + JSON.stringify(scene));
    document.getElementById("sceneMode").value = index[0].values[0][0];
    document.getElementById("sceneType").value = index[0].values[0][1];
    document.getElementById("scenePreload").value = index[0].values[0][2];
    document.getElementById("sceneIndex").value = index[0].values[0][3];
    document.getElementById("sceneWidth").value = index[0].values[0][4];
    document.getElementById("sceneHeight").value = index[0].values[0][5];
    document.getElementById("sceneZoom").value = index[0].values[0][6];
    document.getElementById("sceneCamera").value = index[0].values[0][7];
    document.getElementById("xPos").value = index[0].values[0][8];
    document.getElementById("yPos").value = index[0].values[0][9];
  }
 
  
function resetQuery() {
  document.getElementById("caseSensitive").value = "case";
  document.getElementById("searchQuery").value = "ZNAME";
  document.getElementById("searchCondition").value = "=";
  document.getElementById("limit").value = "";
  document.getElementById("query").value = "";
}
  
function performQuery() {
   
  // get object count
  document.getElementById("searchCount").innerHTML = "0 objects";
  results = "none";
  
  try {
  let objects = db.exec("SELECT ZOBJECTTYPE from ZOBJECTDATA");
  let objectCount = objects[0].values.length;
  let e = 0;
  
  // query
  let query = "";
  let upper = "";
  let upperEnd = "";
  if (document.getElementById("caseSensitive").value == "no-case") {
    let c = document.getElementById("searchQuery").value;
    if (!(c == "Z_ZINDEX" || c == "ZMASS" || c == "ZZFRICTION" || c == "ZFLIPX" || c == "ZFLIPY" || c == "ZLOCKED" || c == "ZCOLLIDABLE")) {
      upper = "UPPER("
      upperEnd = ")";
    }
  }

  query += " WHERE " + upper + document.getElementById("searchQuery").value + upperEnd;
  query += " " + document.getElementById("searchCondition").value;
  let value = document.getElementById("query").value;
  let isString = false;
  let percent = "";
  if (document.getElementById("searchCondition").value.includes("like")) {
    percent = "%";
  }
  try {
    JSON.parse(value) + 1;
  } catch(e) {
    isString = true;
  }
  if (isString) {
    if (document.getElementById("caseSensitive").value == "no-case") {
      value = value.toUpperCase();
    }
    value = JSON.stringify(percent + value + percent)
  }
  query += " " + value;
  if (document.getElementById("limit").value) {
    query += " LIMIT " + (parseInt(document.getElementById("limit").value) || 0);
  }
  
  // console.log(query)
  whereQuery = query;
  query = "SELECT ZNAME, ZUNIQUEID, ZOBJECTTYPE from ZOBJECTDATA " + query;
  
  results = db.exec(query);
  try {
  	e = results[0].values.length;
  } catch(e) {};
  
  let r = e + " entries out of " + objectCount + " objects";
  document.getElementById("searchCount").innerHTML = r;
  } catch(e) {};
}
  
  var queryTimer;
function modObjects() {
  document.getElementById("projectViewer").style.display = "none";
  document.getElementById("objectSelector").style.display = "block";
  performQuery();
  queryTimer = setInterval(function() {
    performQuery();
  }, 1000)
  
}
  
function editSceneData() {
  document.getElementById("projectViewer").style.display = "none";
  document.getElementById("sceneSelector").style.display = "block";
  // get level count
  let level = db.exec("SELECT ZLevelName from ZLevelData");
  let levels = [];
  let str = "";
  level[0].values.forEach(function(index) {
    levels.push(index[0]);
    let scene = index[0];
    str += '<a class="button" style="width:95%; margin-bottom: 6px;" onclick="selectScene(\'' + scene;
    str += "')\">" + index[0] + "</a>";
  })
  let levelCount = levels.length;
  document.getElementById("sceneList").innerHTML = str;
}
  
function viewProjectData() {
  expandAdv = {};
  document.getElementById("projectViewer").style.display = "none";
  document.getElementById("projectData").style.display = "block";
  
  // get behavior count
  let behaviors = db.exec("SELECT ZISRoot, ZName from ZBEHAVIOURDATA");
  let behaviorCount = behaviors[0].values.length;
  let rootBehaviors = 0;
  let bTypes = {};
  behaviors[0].values.forEach(function(arr) {
    rootBehaviors += parseInt(arr[0]) || 0;
    bTypes[arr[1]] = bTypes[arr[1]] || 0;
    bTypes[arr[1]]++;
  });
			
  // get object count
  let objects = db.exec("SELECT ZOBJECTTYPE from ZOBJECTDATA");
  let objectCount = objects[0].values.length;
  let oType = {};
  objects[0].values.forEach(function(arr) {
    oType[arr[0]] = oType[arr[0]] || 0;
    oType[arr[0]]++;
  });
            
  // get asset count
  let paths = db.exec("SELECT ZASSETTYPE, ZPATH from ZPATHDATA");
  let assetCount = paths[0].values.length;
  let aType = {};
  let aFiles = {};
  paths[0].values.forEach(function(arr) {
    aType[arr[0]] = aType[arr[0]] || 0;
    aType[arr[0]]++;
    aFiles[arr[0]] = aFiles[arr[0]] || [];
    aFiles[arr[0]].push(arr[1]);
  });
            
  // get layer count
  let layerData = db.exec("SELECT ZIndex, ZName from ZLAYERDATA");
  let layersCount = 0;
  let layers = {};
  layerData[0].values.forEach(function(index) {
    layers[index[0]] = index[1];
  })
  layersCount = Object.keys(layers).length;
  
  // get level count
  let level = db.exec("SELECT ZLevelName from ZLevelData");
  let levels = [];
  level[0].values.forEach(function(index) {
    levels.push(index[0]);
  })
  let levelCount = levels.length;
  
  // display
  let display = "";
  let add = function(title, end, color = "#00bb78", newline = true) {
    display += "<b style='color:" + color + "'>" + title + "</b> " + end;
    if (newline) {
      display += "<br>";
    }
  }
  add("Total Behaviors: ", behaviorCount);
  add("  ➤ Root Behaviors: ", rootBehaviors, "#a3d3a5");
  add("  ➤ Non-Root Behaviors: ", behaviorCount - rootBehaviors, "#a3d3a5");
  add("  ➤ Unique Behavior Types: ", Object.keys(bTypes).length, "#a3d3a5", false);
  display += "<a onclick='expand()' style='color:#00bb78' id='expand'> [Expand]</a> <br>"
  display += '<span id="more">';
  Object.keys(bTypes).forEach(function(behavior) {
    add("    " + behavior + ": ", bTypes[behavior], "#c1c1c1");
  });
  display += "</span>";
  
  add("Total Objects: ", objectCount);
  Object.keys(oType).forEach(function(key){
    add("  ➤ " + key + " Objects: ", oType[key], "#a3d3a5");
  })
  add("Total Assets: ", assetCount);
  Object.keys(aType).forEach(function(key){
    add("  ➤ " + key + ": ", aType[key], "#a3d3a5", false);
    display += "<a id='" + key + "' onclick='expandAdvanced(\"" + key + "\")' style='color:#00bb78'> [Expand]</a> <br>"
    display += '<span style="display: none" id="adv-' + key + '">';
    Object.keys(aFiles[key]).forEach(function(type) {
      add("    " + aFiles[key][type], "", "#c1c1c1");
  	});
    display += '</span>';
  })
  add("Total Layers: ", layersCount);
  add("  ➤ Layer 1: ", "Global", "#a3d3a5");
  add("  ➤ Layer 2: ", "Scene", "#a3d3a5");
  Object.keys(layers).forEach(function(key){
    if (key < 0) return;
    add("  ➤ Layer " + (parseInt(key) + 3) + ": ", layers[key], "#a3d3a5");
  })
  
  add("Total Scenes: ", levelCount);
  levels.forEach(function(key){
    add("  ➤ " + key, "", "#a3d3a5");
  })
  document.getElementById("projectDetails").innerHTML = display;
}
  
  const popIn = [
    {
      opacity: 0,
      transform: "scale(0, 0)"
    },
    {
      opacity: 1,
      transform: "scale(1, 1)"
    }
  ];
  const optionsPopIn = {
    duration: 400,
    easing: "cubic-bezier(0,0.5,0,1)"
  }
  
  function throwError(msg) {
    document.getElementById("error").style.display = "block";
    document.getElementById("error").style["background-color"] = "#ff5a5a";
    document.getElementById("error msg").innerHTML = msg;
    document.getElementById("error").animate(popIn, optionsPopIn);
    console.error(msg);
  }
  
  function throwSuccess(msg) {
    document.getElementById("error").style.display = "block";
    document.getElementById("error").style["background-color"] = "#00BB78";
    document.getElementById("error msg").innerHTML = msg;
    document.getElementById("error").animate(popIn, optionsPopIn);
    console.info(msg);
  }
</script>
